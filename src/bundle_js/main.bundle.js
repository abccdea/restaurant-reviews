"use strict";!function(){function i(n){return new Promise(function(e,t){n.onsuccess=function(){e(n.result)},n.onerror=function(){t(n.error)}})}function a(n,r,o){var a,e=new Promise(function(e,t){i(a=n[r].apply(n,o)).then(e,t)});return e.request=a,e}function e(e,n,t){t.forEach(function(t){Object.defineProperty(e.prototype,t,{get:function(){return this[n][t]},set:function(e){this[n][t]=e}})})}function t(t,n,r,e){e.forEach(function(e){e in r.prototype&&(t.prototype[e]=function(){return a(this[n],e,arguments)})})}function n(t,n,r,e){e.forEach(function(e){e in r.prototype&&(t.prototype[e]=function(){return this[n][e].apply(this[n],arguments)})})}function r(e,r,t,n){n.forEach(function(n){n in t.prototype&&(e.prototype[n]=function(){return e=this[r],(t=a(e,n,arguments)).then(function(e){if(e)return new s(e,t.request)});var e,t})})}function o(e){this._index=e}function s(e,t){this._cursor=e,this._request=t}function u(e){this._store=e}function c(n){this._tx=n,this.complete=new Promise(function(e,t){n.oncomplete=function(){e()},n.onerror=function(){t(n.error)},n.onabort=function(){t(n.error)}})}function l(e,t,n){this._db=e,this.oldVersion=t,this.transaction=new c(n)}function f(e){this._db=e}e(o,"_index",["name","keyPath","multiEntry","unique"]),t(o,"_index",IDBIndex,["get","getKey","getAll","getAllKeys","count"]),r(o,"_index",IDBIndex,["openCursor","openKeyCursor"]),e(s,"_cursor",["direction","key","primaryKey","value"]),t(s,"_cursor",IDBCursor,["update","delete"]),["advance","continue","continuePrimaryKey"].forEach(function(n){n in IDBCursor.prototype&&(s.prototype[n]=function(){var t=this,e=arguments;return Promise.resolve().then(function(){return t._cursor[n].apply(t._cursor,e),i(t._request).then(function(e){if(e)return new s(e,t._request)})})})}),u.prototype.createIndex=function(){return new o(this._store.createIndex.apply(this._store,arguments))},u.prototype.index=function(){return new o(this._store.index.apply(this._store,arguments))},e(u,"_store",["name","keyPath","indexNames","autoIncrement"]),t(u,"_store",IDBObjectStore,["put","add","delete","clear","get","getAll","getKey","getAllKeys","count"]),r(u,"_store",IDBObjectStore,["openCursor","openKeyCursor"]),n(u,"_store",IDBObjectStore,["deleteIndex"]),c.prototype.objectStore=function(){return new u(this._tx.objectStore.apply(this._tx,arguments))},e(c,"_tx",["objectStoreNames","mode"]),n(c,"_tx",IDBTransaction,["abort"]),l.prototype.createObjectStore=function(){return new u(this._db.createObjectStore.apply(this._db,arguments))},e(l,"_db",["name","version","objectStoreNames"]),n(l,"_db",IDBDatabase,["deleteObjectStore","close"]),f.prototype.transaction=function(){return new c(this._db.transaction.apply(this._db,arguments))},e(f,"_db",["name","version","objectStoreNames"]),n(f,"_db",IDBDatabase,["close"]),["openCursor","openKeyCursor"].forEach(function(a){[u,o].forEach(function(e){a in e.prototype&&(e.prototype[a.replace("open","iterate")]=function(){var e,t=(e=arguments,Array.prototype.slice.call(e)),n=t[t.length-1],r=this._store||this._index,o=r[a].apply(r,t.slice(0,-1));o.onsuccess=function(){n(o.result)}})})}),[o,u].forEach(function(e){e.prototype.getAll||(e.prototype.getAll=function(e,n){var r=this,o=[];return new Promise(function(t){r.iterateCursor(e,function(e){e?(o.push(e.value),void 0===n||o.length!=n?e.continue():t(o)):t(o)})})})});var d={open:function(e,t,n){var r=a(indexedDB,"open",[e,t]),o=r.request;return o&&(o.onupgradeneeded=function(e){n&&n(new l(o.result,e.oldVersion,o.transaction))}),r.then(function(e){return new f(e)})},delete:function(e){return a(indexedDB,"deleteDatabase",[e])}};"undefined"!=typeof module?(module.exports=d,module.exports.default=module.exports):self.idb=d}();var _createClass=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var map,DBHelper=function(){function i(){_classCallCheck(this,i)}return _createClass(i,null,[{key:"openIdb",value:function(){return idb.open("db",2,function(e){switch(e.oldVersion){case 0:e.createObjectStore("restaurants-store",{keyPath:"id"});case 1:e.createObjectStore("reviews-store",{keyPath:"id"}).createIndex("by-restaurant","restaurant_id")}})}},{key:"getCachedRestaurants",value:function(){return i.openIdb().then(function(e){if(e)return e.transaction("restaurants-store").objectStore("restaurants-store").getAll()})}},{key:"getCachedReviews",value:function(t){return i.openIdb().then(function(e){if(e)return e.transaction("reviews-store").objectStore("reviews-store").index("by-restaurant").getAll(t)})}},{key:"fetchRestaurants",value:function(t){i.getCachedRestaurants().then(function(e){if(0<e.length)return t(null,e)}),fetch(i.DATABASE_URL+"restaurants").then(function(e){return e.json()}).then(function(n){return i.openIdb().then(function(e){if(e){var t=e.transaction("restaurants-store","readwrite").objectStore("restaurants-store");n.forEach(function(e){t.put(e)})}}),t(null,n)}).catch(function(e){return t(e,null)})}},{key:"fetchReviews",value:function(e,t){i.getCachedReviews(e).then(function(e){if(0<e.length)return t(null,e.reverse())}),fetch(i.DATABASE_URL+"reviews/?restaurant_id="+e).then(function(e){return e.json()}).then(function(n){return i.openIdb().then(function(e){if(e){var t=e.transaction("reviews-store","readwrite").objectStore("reviews-store");n.forEach(function(e){t.put(e)})}}),t(null,n.reverse())}).catch(function(e){return t(e,null)})}},{key:"fetchRestaurantById",value:function(r,o){i.fetchRestaurants(function(e,t){if(e)o(e,null);else{var n=t.find(function(e){return e.id==r});n?o(null,n):o("Restaurant does not exist",null)}})}},{key:"fetchRestaurantByCuisine",value:function(r,o){i.fetchRestaurants(function(e,t){if(e)o(e,null);else{var n=t.filter(function(e){return e.cuisine_type==r});o(null,n)}})}},{key:"fetchRestaurantByNeighborhood",value:function(r,o){i.fetchRestaurants(function(e,t){if(e)o(e,null);else{var n=t.filter(function(e){return e.neighborhood==r});o(null,n)}})}},{key:"fetchRestaurantByCuisineAndNeighborhood",value:function(r,o,a){i.fetchRestaurants(function(e,t){if(e)a(e,null);else{var n=t;"all"!=r&&(n=n.filter(function(e){return e.cuisine_type==r})),"all"!=o&&(n=n.filter(function(e){return e.neighborhood==o})),a(null,n)}})}},{key:"fetchNeighborhoods",value:function(o){i.fetchRestaurants(function(e,n){if(e)o(e,null);else{var r=n.map(function(e,t){return n[t].neighborhood}),t=r.filter(function(e,t){return r.indexOf(e)==t});o(null,t)}})}},{key:"fetchCuisines",value:function(o){i.fetchRestaurants(function(e,n){if(e)o(e,null);else{var r=n.map(function(e,t){return n[t].cuisine_type}),t=r.filter(function(e,t){return r.indexOf(e)==t});o(null,t)}})}},{key:"urlForRestaurant",value:function(e){return"./restaurant.html?id="+e.id}},{key:"imageUrlForRestaurant",value:function(e){return"/img/"+e.photograph}},{key:"mapMarkerForRestaurant",value:function(e,t){return new google.maps.Marker({position:e.latlng,title:e.name,url:i.urlForRestaurant(e),map:t,animation:google.maps.Animation.DROP})}},{key:"changeFavoriteStateForRestaurant",value:function(n,r,t){fetch("http://localhost:1337/restaurants/"+n+"/?is_favorite="+r,{method:"PUT"}).then(function(e){i.openIdb().then(function(e){var t=e.transaction("restaurants-store","readwrite").objectStore("restaurants-store");t.get(n).then(function(e){e.is_favorite=r,t.put(e)})}),t(null,"favorite status updated successfully")}).catch(function(e){t("failed to update favorite status",null)})}},{key:"addReview",value:function(e){if(navigator.onLine){var t={restaurant_id:parseInt(e.restaurantId),name:e.name,rating:parseInt(e.rating),comments:e.comments,createdAt:parseInt(e.createdAt)};fetch("http://localhost:1337/reviews",{method:"POST",body:JSON.stringify(t),headers:new Headers({"Content-Type":"application/json"})}).then(function(e){console.log("review added successfully to the server")}).catch(function(e){console.log(e)})}else i.sendWhenOnline(e)}},{key:"sendWhenOnline",value:function(e){localStorage.setItem("offlineReviewData",JSON.stringify(e)),window.addEventListener("online",function(e){var t=JSON.parse(localStorage.getItem("offlineReviewData"));null!==t&&(i.addReview(t),localStorage.removeItem("offlineReviewData"))})}},{key:"DATABASE_URL",get:function(){return"http://localhost:1337/"}}]),i}(),restaurants=void 0,neighborhoods=void 0,cuisines=void 0,markers=[];window.addEventListener("offline",function(e){window.siiimpleToast.alert("No Internet Connection!")}),document.addEventListener("DOMContentLoaded",function(e){initMap(),fetchNeighborhoods(),fetchCuisines()});var fetchNeighborhoods=function(){DBHelper.fetchNeighborhoods(function(e,t){e?console.error(e):(self.neighborhoods=t,fillNeighborhoodsHTML())})},fillNeighborhoodsHTML=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.neighborhoods,n=document.getElementById("neighborhoods-select");n.innerHTML="";var t=document.createElement("option");t.innerHTML="All Neighborhoods",t.value="all",n.append(t),e.forEach(function(e){var t=document.createElement("option");t.innerHTML=e,t.value=e,n.append(t)})},fetchCuisines=function(){DBHelper.fetchCuisines(function(e,t){e?console.error(e):(self.cuisines=t,fillCuisinesHTML())})},fillCuisinesHTML=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.cuisines,n=document.getElementById("cuisines-select");n.innerHTML="";var t=document.createElement("option");t.innerHTML="All Cuisines",t.value="all",n.append(t),e.forEach(function(e){var t=document.createElement("option");t.innerHTML=e,t.value=e,n.append(t)})},initMap=function(){self.map=new google.maps.Map(document.getElementById("map"),{zoom:12,center:{lat:40.722216,lng:-73.987501},scrollwheel:!1}),updateRestaurants()},updateRestaurants=function(){var e=document.getElementById("cuisines-select"),t=document.getElementById("neighborhoods-select"),n=e.selectedIndex,r=t.selectedIndex,o=e[n].value,a=t[r].value;DBHelper.fetchRestaurantByCuisineAndNeighborhood(o,a,function(e,t){e?console.error(e):(resetRestaurants(t),fillRestaurantsHTML())})},resetRestaurants=function(e){self.restaurants=[],document.getElementById("restaurants-list").innerHTML="",self.markers&&self.markers.forEach(function(e){return e.setMap(null)}),self.markers=[],self.restaurants=e},fillRestaurantsHTML=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.restaurants,t=document.getElementById("restaurants-list"),n=document.createComment("");e.forEach(function(e){t.append(createRestaurantHTML(e)),t.append(n)}),addMarkersToMap()},createRestaurantHTML=function(n){var e=document.createElement("li"),r=document.createElement("button");r.innerHTML="❤",r.classList.add("favButton"),changeFavStatus(r,n.is_favorite),r.onclick=function(){"true"===n.is_favorite?n.is_favorite="false":"false"===n.is_favorite&&(n.is_favorite="true"),DBHelper.changeFavoriteStateForRestaurant(n.id,n.is_favorite,function(e,t){e?console.log(e):(console.log(t),changeFavStatus(r,n.is_favorite))})},e.append(r);var t=document.createElement("img");t.className="restaurant-img";var o=DBHelper.imageUrlForRestaurant(n),a="webp";t.src=o+"-800_2x."+a,t.setAttribute("srcset",o+"-800_2x."+a+" 800w, "+o+"-400_1x."+a+" 400w"),t.setAttribute("sizes","(max-width: 500px) 90vw, (max-width: 880px) 80vw, (max-width: 1205px) 40vw, (min-width: 1206px) 30vw"),t.setAttribute("alt",n.name+" Restaurant"),e.append(t);var i=document.createElement("div");i.className="restaurant-text-area",e.append(i);var s=document.createElement("h1");s.innerHTML=n.name,i.append(s);var u=document.createElement("p");u.innerHTML=n.neighborhood,i.append(u);var c=document.createElement("p");c.innerHTML=n.address,i.append(c);var l=document.createElement("a");return l.innerHTML="View Details",l.href=DBHelper.urlForRestaurant(n),l.setAttribute("role","button"),l.setAttribute("aria-label","View Restaurant Details"),i.append(l),e},addMarkersToMap=function(){(0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.restaurants).forEach(function(e){var t=DBHelper.mapMarkerForRestaurant(e,self.map);google.maps.event.addListener(t,"click",function(){window.location.href=t.url}),self.markers.push(t)})},changeFavStatus=function(e,t){"true"===t?(e.classList.remove("notFav"),e.classList.add("fav"),e.setAttribute("aria-label","mark as favorite")):"false"===t&&(e.classList.remove("fav"),e.classList.add("notFav"),e.setAttribute("aria-label","remove as favorite"))};
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImlkYi5qcyIsImRiaGVscGVyLmpzIiwibWFpbi5qcyJdLCJuYW1lcyI6WyJwcm9taXNpZnlSZXF1ZXN0IiwicmVxdWVzdCIsIlByb21pc2UiLCJyZXNvbHZlIiwicmVqZWN0Iiwib25zdWNjZXNzIiwicmVzdWx0Iiwib25lcnJvciIsImVycm9yIiwicHJvbWlzaWZ5UmVxdWVzdENhbGwiLCJvYmoiLCJtZXRob2QiLCJhcmdzIiwicCIsImFwcGx5IiwidGhlbiIsInByb3h5UHJvcGVydGllcyIsIlByb3h5Q2xhc3MiLCJ0YXJnZXRQcm9wIiwicHJvcGVydGllcyIsImZvckVhY2giLCJwcm9wIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJwcm90b3R5cGUiLCJnZXQiLCJ0aGlzIiwic2V0IiwidmFsIiwicHJveHlSZXF1ZXN0TWV0aG9kcyIsIkNvbnN0cnVjdG9yIiwiYXJndW1lbnRzIiwicHJveHlNZXRob2RzIiwicHJveHlDdXJzb3JSZXF1ZXN0TWV0aG9kcyIsInZhbHVlIiwiQ3Vyc29yIiwiSW5kZXgiLCJpbmRleCIsIl9pbmRleCIsImN1cnNvciIsIl9jdXJzb3IiLCJfcmVxdWVzdCIsIk9iamVjdFN0b3JlIiwic3RvcmUiLCJfc3RvcmUiLCJUcmFuc2FjdGlvbiIsImlkYlRyYW5zYWN0aW9uIiwiX3R4IiwiY29tcGxldGUiLCJvbmNvbXBsZXRlIiwib25hYm9ydCIsIlVwZ3JhZGVEQiIsImRiIiwib2xkVmVyc2lvbiIsInRyYW5zYWN0aW9uIiwiX2RiIiwiREIiLCJJREJJbmRleCIsIklEQkN1cnNvciIsIm1ldGhvZE5hbWUiLCJjcmVhdGVJbmRleCIsIklEQk9iamVjdFN0b3JlIiwib2JqZWN0U3RvcmUiLCJJREJUcmFuc2FjdGlvbiIsImNyZWF0ZU9iamVjdFN0b3JlIiwiSURCRGF0YWJhc2UiLCJmdW5jTmFtZSIsInJlcGxhY2UiLCJhcnIiLCJBcnJheSIsInNsaWNlIiwiY2FsbCIsImNhbGxiYWNrIiwibGVuZ3RoIiwibmF0aXZlT2JqZWN0IiwiZ2V0QWxsIiwicXVlcnkiLCJjb3VudCIsImluc3RhbmNlIiwiaXRlbXMiLCJpdGVyYXRlQ3Vyc29yIiwicHVzaCIsInVuZGVmaW5lZCIsImNvbnRpbnVlIiwiZXhwIiwib3BlbiIsIm5hbWUiLCJ2ZXJzaW9uIiwidXBncmFkZUNhbGxiYWNrIiwiaW5kZXhlZERCIiwib251cGdyYWRlbmVlZGVkIiwiZXZlbnQiLCJkZWxldGUiLCJtb2R1bGUiLCJleHBvcnRzIiwiZGVmYXVsdCIsInNlbGYiLCJpZGIiLCJfY3JlYXRlQ2xhc3MiLCJkZWZpbmVQcm9wZXJ0aWVzIiwidGFyZ2V0IiwicHJvcHMiLCJpIiwiZGVzY3JpcHRvciIsImVudW1lcmFibGUiLCJjb25maWd1cmFibGUiLCJ3cml0YWJsZSIsImtleSIsInByb3RvUHJvcHMiLCJzdGF0aWNQcm9wcyIsIl9jbGFzc0NhbGxDaGVjayIsIlR5cGVFcnJvciIsIm1hcCIsIkRCSGVscGVyIiwidXBncmFkZURiIiwia2V5UGF0aCIsIm9wZW5JZGIiLCJpZCIsImdldENhY2hlZFJlc3RhdXJhbnRzIiwicmVzdGF1cmFudHMiLCJmZXRjaCIsIkRBVEFCQVNFX1VSTCIsInJlc3BvbnNlIiwianNvbiIsInJlc3RhdXJhbnRTdG9yZSIsInJlc3RhdXJhbnQiLCJwdXQiLCJjYXRjaCIsImVyciIsImdldENhY2hlZFJldmlld3MiLCJyZXZpZXdzIiwicmV2ZXJzZSIsInJldmlldyIsImZldGNoUmVzdGF1cmFudHMiLCJmaW5kIiwiciIsImN1aXNpbmUiLCJyZXN1bHRzIiwiZmlsdGVyIiwiY3Vpc2luZV90eXBlIiwibmVpZ2hib3Job29kIiwibmVpZ2hib3Job29kcyIsInYiLCJ1bmlxdWVOZWlnaGJvcmhvb2RzIiwiaW5kZXhPZiIsImN1aXNpbmVzIiwidW5pcXVlQ3Vpc2luZXMiLCJwaG90b2dyYXBoIiwiZ29vZ2xlIiwibWFwcyIsIk1hcmtlciIsInBvc2l0aW9uIiwibGF0bG5nIiwidGl0bGUiLCJ1cmwiLCJ1cmxGb3JSZXN0YXVyYW50IiwiYW5pbWF0aW9uIiwiQW5pbWF0aW9uIiwiRFJPUCIsImlzRmF2b3JpdGUiLCJyZXMiLCJyZXN0YXVyYW50c1N0b3JlIiwiaXNfZmF2b3JpdGUiLCJuYXZpZ2F0b3IiLCJvbkxpbmUiLCJyZXZpZXdQYXJhbWV0ZXJzIiwicmVzdGF1cmFudF9pZCIsInBhcnNlSW50IiwicmVzdGF1cmFudElkIiwicmF0aW5nIiwiY29tbWVudHMiLCJjcmVhdGVkQXQiLCJib2R5IiwiSlNPTiIsInN0cmluZ2lmeSIsImhlYWRlcnMiLCJIZWFkZXJzIiwiQ29udGVudC1UeXBlIiwiY29uc29sZSIsImxvZyIsInNlbmRXaGVuT25saW5lIiwib2ZmbGluZVJldmlldyIsImxvY2FsU3RvcmFnZSIsInNldEl0ZW0iLCJ3aW5kb3ciLCJhZGRFdmVudExpc3RlbmVyIiwicGFyc2UiLCJnZXRJdGVtIiwiYWRkUmV2aWV3IiwicmVtb3ZlSXRlbSIsIm1hcmtlcnMiLCJzaWlpbXBsZVRvYXN0IiwiYWxlcnQiLCJkb2N1bWVudCIsImluaXRNYXAiLCJmZXRjaE5laWdoYm9yaG9vZHMiLCJmZXRjaEN1aXNpbmVzIiwiZmlsbE5laWdoYm9yaG9vZHNIVE1MIiwic2VsZWN0IiwiZ2V0RWxlbWVudEJ5SWQiLCJpbm5lckhUTUwiLCJvcHRpb24iLCJjcmVhdGVFbGVtZW50IiwiYXBwZW5kIiwiZmlsbEN1aXNpbmVzSFRNTCIsIk1hcCIsInpvb20iLCJjZW50ZXIiLCJsYXQiLCJsbmciLCJzY3JvbGx3aGVlbCIsInVwZGF0ZVJlc3RhdXJhbnRzIiwiY1NlbGVjdCIsIm5TZWxlY3QiLCJjSW5kZXgiLCJzZWxlY3RlZEluZGV4IiwibkluZGV4IiwiZmV0Y2hSZXN0YXVyYW50QnlDdWlzaW5lQW5kTmVpZ2hib3Job29kIiwicmVzZXRSZXN0YXVyYW50cyIsImZpbGxSZXN0YXVyYW50c0hUTUwiLCJtIiwic2V0TWFwIiwidWwiLCJjb21tZW50IiwiY3JlYXRlQ29tbWVudCIsImNyZWF0ZVJlc3RhdXJhbnRIVE1MIiwiYWRkTWFya2Vyc1RvTWFwIiwibGkiLCJmYXZCdXR0b24iLCJjbGFzc0xpc3QiLCJhZGQiLCJjaGFuZ2VGYXZTdGF0dXMiLCJvbmNsaWNrIiwiY2hhbmdlRmF2b3JpdGVTdGF0ZUZvclJlc3RhdXJhbnQiLCJzdWNjZXNzIiwiaW1hZ2UiLCJjbGFzc05hbWUiLCJpbWFnZVVybE5hbWUiLCJpbWFnZVVybEZvclJlc3RhdXJhbnQiLCJpbWFnZVR5cGUiLCJzcmMiLCJzZXRBdHRyaWJ1dGUiLCJkaXYiLCJhZGRyZXNzIiwibW9yZSIsImhyZWYiLCJtYXJrZXIiLCJtYXBNYXJrZXJGb3JSZXN0YXVyYW50IiwiYWRkTGlzdGVuZXIiLCJsb2NhdGlvbiIsImZhdkJ0biIsImlzRmF2IiwicmVtb3ZlIl0sIm1hcHBpbmdzIjoiQUFBQSxjQUVBLFdBS0EsU0FBQUEsRUFBQUMsR0FDQSxPQUFBLElBQUFDLFFBQUEsU0FBQUMsRUFBQUMsR0FDQUgsRUFBQUksVUFBQSxXQUNBRixFQUFBRixFQUFBSyxTQUdBTCxFQUFBTSxRQUFBLFdBQ0FILEVBQUFILEVBQUFPLFVBS0EsU0FBQUMsRUFBQUMsRUFBQUMsRUFBQUMsR0FDQSxJQUFBWCxFQUNBWSxFQUFBLElBQUFYLFFBQUEsU0FBQUMsRUFBQUMsR0FFQUosRUFEQUMsRUFBQVMsRUFBQUMsR0FBQUcsTUFBQUosRUFBQUUsSUFDQUcsS0FBQVosRUFBQUMsS0FJQSxPQURBUyxFQUFBWixRQUFBQSxFQUNBWSxFQVdBLFNBQUFHLEVBQUFDLEVBQUFDLEVBQUFDLEdBQ0FBLEVBQUFDLFFBQUEsU0FBQUMsR0FDQUMsT0FBQUMsZUFBQU4sRUFBQU8sVUFBQUgsRUFBQSxDQUNBSSxJQUFBLFdBQ0EsT0FBQUMsS0FBQVIsR0FBQUcsSUFFQU0sSUFBQSxTQUFBQyxHQUNBRixLQUFBUixHQUFBRyxHQUFBTyxPQU1BLFNBQUFDLEVBQUFaLEVBQUFDLEVBQUFZLEVBQUFYLEdBQ0FBLEVBQUFDLFFBQUEsU0FBQUMsR0FDQUEsS0FBQVMsRUFBQU4sWUFDQVAsRUFBQU8sVUFBQUgsR0FBQSxXQUNBLE9BQUFaLEVBQUFpQixLQUFBUixHQUFBRyxFQUFBVSxlQUtBLFNBQUFDLEVBQUFmLEVBQUFDLEVBQUFZLEVBQUFYLEdBQ0FBLEVBQUFDLFFBQUEsU0FBQUMsR0FDQUEsS0FBQVMsRUFBQU4sWUFDQVAsRUFBQU8sVUFBQUgsR0FBQSxXQUNBLE9BQUFLLEtBQUFSLEdBQUFHLEdBQUFQLE1BQUFZLEtBQUFSLEdBQUFhLGVBS0EsU0FBQUUsRUFBQWhCLEVBQUFDLEVBQUFZLEVBQUFYLEdBQ0FBLEVBQUFDLFFBQUEsU0FBQUMsR0FDQUEsS0FBQVMsRUFBQU4sWUFDQVAsRUFBQU8sVUFBQUgsR0FBQSxXQUNBLE9BM0NBWCxFQTJDQWdCLEtBQUFSLElBMUNBTCxFQUFBSixFQUFBQyxFQTBDQVcsRUFBQVUsWUF6Q0FoQixLQUFBLFNBQUFtQixHQUNBLEdBQUFBLEVBQ0EsT0FBQSxJQUFBQyxFQUFBRCxFQUFBckIsRUFBQVosV0FKQSxJQUFBUyxFQUNBRyxNQStDQSxTQUFBdUIsRUFBQUMsR0FDQVgsS0FBQVksT0FBQUQsRUFTQSxTQUFBRixFQUFBSSxFQUFBdEMsR0FDQXlCLEtBQUFjLFFBQUFELEVBQ0FiLEtBQUFlLFNBQUF4QyxFQXVCQSxTQUFBeUMsRUFBQUMsR0FDQWpCLEtBQUFrQixPQUFBRCxFQW1CQSxTQUFBRSxFQUFBQyxHQUNBcEIsS0FBQXFCLElBQUFELEVBQ0FwQixLQUFBc0IsU0FBQSxJQUFBOUMsUUFBQSxTQUFBQyxFQUFBQyxHQUNBMEMsRUFBQUcsV0FBQSxXQUNBOUMsS0FFQTJDLEVBQUF2QyxRQUFBLFdBQ0FILEVBQUEwQyxFQUFBdEMsUUFFQXNDLEVBQUFJLFFBQUEsV0FDQTlDLEVBQUEwQyxFQUFBdEMsVUFhQSxTQUFBMkMsRUFBQUMsRUFBQUMsRUFBQUMsR0FDQTVCLEtBQUE2QixJQUFBSCxFQUNBMUIsS0FBQTJCLFdBQUFBLEVBQ0EzQixLQUFBNEIsWUFBQSxJQUFBVCxFQUFBUyxHQVdBLFNBQUFFLEVBQUFKLEdBQ0ExQixLQUFBNkIsSUFBQUgsRUF6RkFwQyxFQUFBb0IsRUFBQSxTQUFBLENBQUEsT0FBQSxVQUFBLGFBQUEsV0FFQVAsRUFBQU8sRUFBQSxTQUFBcUIsU0FBQSxDQUFBLE1BQUEsU0FBQSxTQUFBLGFBQUEsVUFFQXhCLEVBQUFHLEVBQUEsU0FBQXFCLFNBQUEsQ0FBQSxhQUFBLGtCQU9BekMsRUFBQW1CLEVBQUEsVUFBQSxDQUFBLFlBQUEsTUFBQSxhQUFBLFVBRUFOLEVBQUFNLEVBQUEsVUFBQXVCLFVBQUEsQ0FBQSxTQUFBLFdBR0EsQ0FBQSxVQUFBLFdBQUEsc0JBQUF0QyxRQUFBLFNBQUF1QyxHQUNBQSxLQUFBRCxVQUFBbEMsWUFDQVcsRUFBQVgsVUFBQW1DLEdBQUEsV0FDQSxJQUFBcEIsRUFBQWIsS0FDQWQsRUFBQW1CLFVBQ0EsT0FBQTdCLFFBQUFDLFVBQUFZLEtBQUEsV0FFQSxPQURBd0IsRUFBQUMsUUFBQW1CLEdBQUE3QyxNQUFBeUIsRUFBQUMsUUFBQTVCLEdBQ0FaLEVBQUF1QyxFQUFBRSxVQUFBMUIsS0FBQSxTQUFBbUIsR0FDQSxHQUFBQSxFQUNBLE9BQUEsSUFBQUMsRUFBQUQsRUFBQUssRUFBQUUsa0JBVUFDLEVBQUFsQixVQUFBb0MsWUFBQSxXQUNBLE9BQUEsSUFBQXhCLEVBQUFWLEtBQUFrQixPQUFBZ0IsWUFBQTlDLE1BQUFZLEtBQUFrQixPQUFBYixhQUdBVyxFQUFBbEIsVUFBQWEsTUFBQSxXQUNBLE9BQUEsSUFBQUQsRUFBQVYsS0FBQWtCLE9BQUFQLE1BQUF2QixNQUFBWSxLQUFBa0IsT0FBQWIsYUFHQWYsRUFBQTBCLEVBQUEsU0FBQSxDQUFBLE9BQUEsVUFBQSxhQUFBLGtCQUVBYixFQUFBYSxFQUFBLFNBQUFtQixlQUFBLENBQUEsTUFBQSxNQUFBLFNBQUEsUUFBQSxNQUFBLFNBQUEsU0FBQSxhQUFBLFVBRUE1QixFQUFBUyxFQUFBLFNBQUFtQixlQUFBLENBQUEsYUFBQSxrQkFFQTdCLEVBQUFVLEVBQUEsU0FBQW1CLGVBQUEsQ0FBQSxnQkFpQkFoQixFQUFBckIsVUFBQXNDLFlBQUEsV0FDQSxPQUFBLElBQUFwQixFQUFBaEIsS0FBQXFCLElBQUFlLFlBQUFoRCxNQUFBWSxLQUFBcUIsSUFBQWhCLGFBR0FmLEVBQUE2QixFQUFBLE1BQUEsQ0FBQSxtQkFBQSxTQUVBYixFQUFBYSxFQUFBLE1BQUFrQixlQUFBLENBQUEsVUFRQVosRUFBQTNCLFVBQUF3QyxrQkFBQSxXQUNBLE9BQUEsSUFBQXRCLEVBQUFoQixLQUFBNkIsSUFBQVMsa0JBQUFsRCxNQUFBWSxLQUFBNkIsSUFBQXhCLGFBR0FmLEVBQUFtQyxFQUFBLE1BQUEsQ0FBQSxPQUFBLFVBQUEscUJBRUFuQixFQUFBbUIsRUFBQSxNQUFBYyxZQUFBLENBQUEsb0JBQUEsVUFNQVQsRUFBQWhDLFVBQUE4QixZQUFBLFdBQ0EsT0FBQSxJQUFBVCxFQUFBbkIsS0FBQTZCLElBQUFELFlBQUF4QyxNQUFBWSxLQUFBNkIsSUFBQXhCLGFBR0FmLEVBQUF3QyxFQUFBLE1BQUEsQ0FBQSxPQUFBLFVBQUEscUJBRUF4QixFQUFBd0IsRUFBQSxNQUFBUyxZQUFBLENBQUEsVUFJQSxDQUFBLGFBQUEsaUJBQUE3QyxRQUFBLFNBQUE4QyxHQUNBLENBQUF4QixFQUFBTixHQUFBaEIsUUFBQSxTQUFBVSxHQUVBb0MsS0FBQXBDLEVBQUFOLFlBRUFNLEVBQUFOLFVBQUEwQyxFQUFBQyxRQUFBLE9BQUEsWUFBQSxXQUNBLElBM0xBQyxFQTJMQXhELEdBM0xBd0QsRUEyTEFyQyxVQTFMQXNDLE1BQUE3QyxVQUFBOEMsTUFBQUMsS0FBQUgsSUEyTEFJLEVBQUE1RCxFQUFBQSxFQUFBNkQsT0FBQSxHQUNBQyxFQUFBaEQsS0FBQWtCLFFBQUFsQixLQUFBWSxPQUNBckMsRUFBQXlFLEVBQUFSLEdBQUFwRCxNQUFBNEQsRUFBQTlELEVBQUEwRCxNQUFBLEdBQUEsSUFDQXJFLEVBQUFJLFVBQUEsV0FDQW1FLEVBQUF2RSxFQUFBSyxlQU9BLENBQUE4QixFQUFBTSxHQUFBdEIsUUFBQSxTQUFBVSxHQUNBQSxFQUFBTixVQUFBbUQsU0FDQTdDLEVBQUFOLFVBQUFtRCxPQUFBLFNBQUFDLEVBQUFDLEdBQ0EsSUFBQUMsRUFBQXBELEtBQ0FxRCxFQUFBLEdBRUEsT0FBQSxJQUFBN0UsUUFBQSxTQUFBQyxHQUNBMkUsRUFBQUUsY0FBQUosRUFBQSxTQUFBckMsR0FDQUEsR0FJQXdDLEVBQUFFLEtBQUExQyxFQUFBTCxZQUVBZ0QsSUFBQUwsR0FBQUUsRUFBQU4sUUFBQUksRUFJQXRDLEVBQUE0QyxXQUhBaEYsRUFBQTRFLElBTkE1RSxFQUFBNEUsV0FlQSxJQUFBSyxFQUFBLENBQ0FDLEtBQUEsU0FBQUMsRUFBQUMsRUFBQUMsR0FDQSxJQUFBM0UsRUFBQUosRUFBQWdGLFVBQUEsT0FBQSxDQUFBSCxFQUFBQyxJQUNBdEYsRUFBQVksRUFBQVosUUFVQSxPQVJBQSxJQUNBQSxFQUFBeUYsZ0JBQUEsU0FBQUMsR0FDQUgsR0FDQUEsRUFBQSxJQUFBckMsRUFBQWxELEVBQUFLLE9BQUFxRixFQUFBdEMsV0FBQXBELEVBQUFxRCxnQkFLQXpDLEVBQUFFLEtBQUEsU0FBQXFDLEdBQ0EsT0FBQSxJQUFBSSxFQUFBSixNQUdBd0MsT0FBQSxTQUFBTixHQUNBLE9BQUE3RSxFQUFBZ0YsVUFBQSxpQkFBQSxDQUFBSCxNQUlBLG9CQUFBTyxRQUNBQSxPQUFBQyxRQUFBVixFQUNBUyxPQUFBQyxRQUFBQyxRQUFBRixPQUFBQyxTQUVBRSxLQUFBQyxJQUFBYixFQTFQQSxHQ0FBLElBQUFjLGFBQUEsV0FBQSxTQUFBQyxFQUFBQyxFQUFBQyxHQUFBLElBQUEsSUFBQUMsRUFBQSxFQUFBQSxFQUFBRCxFQUFBNUIsT0FBQTZCLElBQUEsQ0FBQSxJQUFBQyxFQUFBRixFQUFBQyxHQUFBQyxFQUFBQyxXQUFBRCxFQUFBQyxhQUFBLEVBQUFELEVBQUFFLGNBQUEsRUFBQSxVQUFBRixJQUFBQSxFQUFBRyxVQUFBLEdBQUFwRixPQUFBQyxlQUFBNkUsRUFBQUcsRUFBQUksSUFBQUosSUFBQSxPQUFBLFNBQUF6RSxFQUFBOEUsRUFBQUMsR0FBQSxPQUFBRCxHQUFBVCxFQUFBckUsRUFBQU4sVUFBQW9GLEdBQUFDLEdBQUFWLEVBQUFyRSxFQUFBK0UsR0FBQS9FLEdBQUEsR0FFQSxTQUFBZ0YsZ0JBQUFoQyxFQUFBaEQsR0FBQSxLQUFBZ0QsYUFBQWhELEdBQUEsTUFBQSxJQUFBaUYsVUFBQSxxQ0FNQSxJQ0xBQyxJREtBQyxTQUFBLFdBQ0EsU0FBQUEsSUFDQUgsZ0JBQUFwRixLQUFBdUYsR0EwV0EsT0F2V0FmLGFBQUFlLEVBQUEsS0FBQSxDQUFBLENBQ0FOLElBQUEsVUFDQXpFLE1BQUEsV0FDQSxPQUFBK0QsSUFBQVosS0FBQSxLQUFBLEVBQUEsU0FBQTZCLEdBQ0EsT0FBQUEsRUFBQTdELFlBQ0EsS0FBQSxFQUNBNkQsRUFBQWxELGtCQUFBLG9CQUFBLENBQ0FtRCxRQUFBLE9BRUEsS0FBQSxFQUNBRCxFQUFBbEQsa0JBQUEsZ0JBQUEsQ0FDQW1ELFFBQUEsT0FFQXZELFlBQUEsZ0JBQUEsc0JBSUEsQ0FDQStDLElBQUEsdUJBQ0F6RSxNQUFBLFdBQ0EsT0FBQStFLEVBQUFHLFVBQUFyRyxLQUFBLFNBQUFxQyxHQUNBLEdBQUFBLEVBRUEsT0FEQUEsRUFBQUUsWUFBQSxxQkFBQVEsWUFBQSxxQkFDQWEsYUFHQSxDQUNBZ0MsSUFBQSxtQkFDQXpFLE1BQUEsU0FBQW1GLEdBQ0EsT0FBQUosRUFBQUcsVUFBQXJHLEtBQUEsU0FBQXFDLEdBQ0EsR0FBQUEsRUFHQSxPQUZBQSxFQUFBRSxZQUFBLGlCQUFBUSxZQUFBLGlCQUNBekIsTUFBQSxpQkFDQXNDLE9BQUEwQyxPQVFBLENBQ0FWLElBQUEsbUJBQ0F6RSxNQUFBLFNBQUFzQyxHQUVBeUMsRUFBQUssdUJBQUF2RyxLQUFBLFNBQUF3RyxHQUNBLEdBQUEsRUFBQUEsRUFBQTlDLE9BQ0EsT0FBQUQsRUFBQSxLQUFBK0MsS0FLQUMsTUFBQVAsRUFBQVEsYUFBQSxlQUFBMUcsS0FBQSxTQUFBMkcsR0FDQSxPQUFBQSxFQUFBQyxTQUNBNUcsS0FBQSxTQUFBd0csR0FTQSxPQVJBTixFQUFBRyxVQUFBckcsS0FBQSxTQUFBcUMsR0FDQSxHQUFBQSxFQUFBLENBQ0EsSUFDQXdFLEVBREF4RSxFQUFBRSxZQUFBLG9CQUFBLGFBQ0FRLFlBQUEscUJBQ0F5RCxFQUFBbkcsUUFBQSxTQUFBeUcsR0FDQUQsRUFBQUUsSUFBQUQsUUFHQXJELEVBQUEsS0FBQStDLEtBQ0FRLE1BQUEsU0FBQUMsR0FDQSxPQUFBeEQsRUFBQXdELEVBQUEsVUFRQSxDQUNBckIsSUFBQSxlQUNBekUsTUFBQSxTQUFBbUYsRUFBQTdDLEdBRUF5QyxFQUFBZ0IsaUJBQUFaLEdBQUF0RyxLQUFBLFNBQUFtSCxHQUNBLEdBQUEsRUFBQUEsRUFBQXpELE9BQ0EsT0FBQUQsRUFBQSxLQUFBMEQsRUFBQUMsYUFLQVgsTUFBQVAsRUFBQVEsYUFBQSwwQkFBQUosR0FBQXRHLEtBQUEsU0FBQTJHLEdBQ0EsT0FBQUEsRUFBQUMsU0FDQTVHLEtBQUEsU0FBQW1ILEdBU0EsT0FSQWpCLEVBQUFHLFVBQUFyRyxLQUFBLFNBQUFxQyxHQUNBLEdBQUFBLEVBQUEsQ0FDQSxJQUNBVCxFQURBUyxFQUFBRSxZQUFBLGdCQUFBLGFBQ0FRLFlBQUEsaUJBQ0FvRSxFQUFBOUcsUUFBQSxTQUFBZ0gsR0FDQXpGLEVBQUFtRixJQUFBTSxRQUdBNUQsRUFBQSxLQUFBMEQsRUFBQUMsYUFDQUosTUFBQSxTQUFBQyxHQUNBLE9BQUF4RCxFQUFBd0QsRUFBQSxVQVFBLENBQ0FyQixJQUFBLHNCQUNBekUsTUFBQSxTQUFBbUYsRUFBQTdDLEdBRUF5QyxFQUFBb0IsaUJBQUEsU0FBQTdILEVBQUErRyxHQUNBLEdBQUEvRyxFQUNBZ0UsRUFBQWhFLEVBQUEsVUFDQSxDQUNBLElBQUFxSCxFQUFBTixFQUFBZSxLQUFBLFNBQUFDLEdBQ0EsT0FBQUEsRUFBQWxCLElBQUFBLElBRUFRLEVBR0FyRCxFQUFBLEtBQUFxRCxHQUdBckQsRUFBQSw0QkFBQSxXQVVBLENBQ0FtQyxJQUFBLDJCQUNBekUsTUFBQSxTQUFBc0csRUFBQWhFLEdBRUF5QyxFQUFBb0IsaUJBQUEsU0FBQTdILEVBQUErRyxHQUNBLEdBQUEvRyxFQUNBZ0UsRUFBQWhFLEVBQUEsVUFDQSxDQUVBLElBQUFpSSxFQUFBbEIsRUFBQW1CLE9BQUEsU0FBQUgsR0FDQSxPQUFBQSxFQUFBSSxjQUFBSCxJQUVBaEUsRUFBQSxLQUFBaUUsUUFTQSxDQUNBOUIsSUFBQSxnQ0FDQXpFLE1BQUEsU0FBQTBHLEVBQUFwRSxHQUVBeUMsRUFBQW9CLGlCQUFBLFNBQUE3SCxFQUFBK0csR0FDQSxHQUFBL0csRUFDQWdFLEVBQUFoRSxFQUFBLFVBQ0EsQ0FFQSxJQUFBaUksRUFBQWxCLEVBQUFtQixPQUFBLFNBQUFILEdBQ0EsT0FBQUEsRUFBQUssY0FBQUEsSUFFQXBFLEVBQUEsS0FBQWlFLFFBU0EsQ0FDQTlCLElBQUEsMENBQ0F6RSxNQUFBLFNBQUFzRyxFQUFBSSxFQUFBcEUsR0FFQXlDLEVBQUFvQixpQkFBQSxTQUFBN0gsRUFBQStHLEdBQ0EsR0FBQS9HLEVBQ0FnRSxFQUFBaEUsRUFBQSxVQUNBLENBQ0EsSUFBQWlJLEVBQUFsQixFQUNBLE9BQUFpQixJQUVBQyxFQUFBQSxFQUFBQyxPQUFBLFNBQUFILEdBQ0EsT0FBQUEsRUFBQUksY0FBQUgsS0FHQSxPQUFBSSxJQUVBSCxFQUFBQSxFQUFBQyxPQUFBLFNBQUFILEdBQ0EsT0FBQUEsRUFBQUssY0FBQUEsS0FHQXBFLEVBQUEsS0FBQWlFLFFBU0EsQ0FDQTlCLElBQUEscUJBQ0F6RSxNQUFBLFNBQUFzQyxHQUVBeUMsRUFBQW9CLGlCQUFBLFNBQUE3SCxFQUFBK0csR0FDQSxHQUFBL0csRUFDQWdFLEVBQUFoRSxFQUFBLFVBQ0EsQ0FFQSxJQUFBcUksRUFBQXRCLEVBQUFQLElBQUEsU0FBQThCLEVBQUF4QyxHQUNBLE9BQUFpQixFQUFBakIsR0FBQXNDLGVBR0FHLEVBQUFGLEVBQUFILE9BQUEsU0FBQUksRUFBQXhDLEdBQ0EsT0FBQXVDLEVBQUFHLFFBQUFGLElBQUF4QyxJQUVBOUIsRUFBQSxLQUFBdUUsUUFTQSxDQUNBcEMsSUFBQSxnQkFDQXpFLE1BQUEsU0FBQXNDLEdBRUF5QyxFQUFBb0IsaUJBQUEsU0FBQTdILEVBQUErRyxHQUNBLEdBQUEvRyxFQUNBZ0UsRUFBQWhFLEVBQUEsVUFDQSxDQUVBLElBQUF5SSxFQUFBMUIsRUFBQVAsSUFBQSxTQUFBOEIsRUFBQXhDLEdBQ0EsT0FBQWlCLEVBQUFqQixHQUFBcUMsZUFHQU8sRUFBQUQsRUFBQVAsT0FBQSxTQUFBSSxFQUFBeEMsR0FDQSxPQUFBMkMsRUFBQUQsUUFBQUYsSUFBQXhDLElBRUE5QixFQUFBLEtBQUEwRSxRQVNBLENBQ0F2QyxJQUFBLG1CQUNBekUsTUFBQSxTQUFBMkYsR0FDQSxNQUFBLHdCQUFBQSxFQUFBUixLQU9BLENBQ0FWLElBQUEsd0JBQ0F6RSxNQUFBLFNBQUEyRixHQUNBLE1BQUEsUUFBQUEsRUFBQXNCLGFBT0EsQ0FDQXhDLElBQUEseUJBQ0F6RSxNQUFBLFNBQUEyRixFQUFBYixHQVFBLE9BUEEsSUFBQW9DLE9BQUFDLEtBQUFDLE9BQUEsQ0FDQUMsU0FBQTFCLEVBQUEyQixPQUNBQyxNQUFBNUIsRUFBQXZDLEtBQ0FvRSxJQUFBekMsRUFBQTBDLGlCQUFBOUIsR0FDQWIsSUFBQUEsRUFDQTRDLFVBQUFSLE9BQUFDLEtBQUFRLFVBQUFDLFNBSUEsQ0FDQW5ELElBQUEsbUNBQ0F6RSxNQUFBLFNBQUFtRixFQUFBMEMsRUFBQXZGLEdBQ0FnRCxNQUFBLHFDQUFBSCxFQUFBLGlCQUFBMEMsRUFBQSxDQUNBcEosT0FBQSxRQUNBSSxLQUFBLFNBQUFpSixHQUNBL0MsRUFBQUcsVUFBQXJHLEtBQUEsU0FBQXFDLEdBQ0EsSUFDQTZHLEVBREE3RyxFQUFBRSxZQUFBLG9CQUFBLGFBQ0FRLFlBQUEscUJBQ0FtRyxFQUFBeEksSUFBQTRGLEdBQUF0RyxLQUFBLFNBQUE4RyxHQUNBQSxFQUFBcUMsWUFBQUgsRUFDQUUsRUFBQW5DLElBQUFELE9BR0FyRCxFQUFBLEtBQUEsMENBQ0F1RCxNQUFBLFNBQUFDLEdBQ0F4RCxFQUFBLG1DQUFBLFVBR0EsQ0FDQW1DLElBQUEsWUFDQXpFLE1BQUEsU0FBQWtHLEdBRUEsR0FBQStCLFVBQUFDLE9BQUEsQ0FJQSxJQUFBQyxFQUFBLENBQ0FDLGNBQUFDLFNBQUFuQyxFQUFBb0MsY0FDQWxGLEtBQUE4QyxFQUFBOUMsS0FDQW1GLE9BQUFGLFNBQUFuQyxFQUFBcUMsUUFDQUMsU0FBQXRDLEVBQUFzQyxTQUNBQyxVQUFBSixTQUFBbkMsRUFBQXVDLFlBR0FuRCxNQUFBLGdDQUFBLENBQ0E3RyxPQUFBLE9BQ0FpSyxLQUFBQyxLQUFBQyxVQUFBVCxHQUNBVSxRQUFBLElBQUFDLFFBQUEsQ0FDQUMsZUFBQSx1QkFFQWxLLEtBQUEsU0FBQTJHLEdBQ0F3RCxRQUFBQyxJQUFBLDZDQUNBcEQsTUFBQSxTQUFBdkgsR0FDQTBLLFFBQUFDLElBQUEzSyxVQXBCQXlHLEVBQUFtRSxlQUFBaEQsS0F1QkEsQ0FDQXpCLElBQUEsaUJBQ0F6RSxNQUFBLFNBQUFtSixHQUNBQyxhQUFBQyxRQUFBLG9CQUFBVixLQUFBQyxVQUFBTyxJQUNBRyxPQUFBQyxpQkFBQSxTQUFBLFNBQUE5RixHQUNBLElBQUF5QyxFQUFBeUMsS0FBQWEsTUFBQUosYUFBQUssUUFBQSxzQkFDQSxPQUFBdkQsSUFDQW5CLEVBQUEyRSxVQUFBeEQsR0FDQWtELGFBQUFPLFdBQUEsMEJBSUEsQ0FDQWxGLElBQUEsZUFPQWxGLElBQUEsV0FFQSxNQUFBLDZCQUlBd0YsRUE1V0EsR0NSQU0saUJBQUEsRUFDQXNCLG1CQUFBLEVBQ0FJLGNBQUEsRUFFQTZDLFFBQUEsR0FFQU4sT0FBQUMsaUJBQUEsVUFBQSxTQUFBOUYsR0FDQTZGLE9BQUFPLGNBQUFDLE1BQUEsNkJBTUFDLFNBQUFSLGlCQUFBLG1CQUFBLFNBQUE5RixHQUNBdUcsVUFDQUMscUJBQ0FDLGtCQU1BLElBQUFELG1CQUFBLFdBQ0FsRixTQUFBa0YsbUJBQUEsU0FBQTNMLEVBQUFxSSxHQUNBckksRUFFQTBLLFFBQUExSyxNQUFBQSxJQUVBd0YsS0FBQTZDLGNBQUFBLEVBQ0F3RCw0QkFRQUEsc0JBQUEsV0FDQSxJQUFBeEQsRUFBQSxFQUFBOUcsVUFBQTBDLGFBQUFTLElBQUFuRCxVQUFBLEdBQUFBLFVBQUEsR0FBQWlFLEtBQUE2QyxjQUVBeUQsRUFBQUwsU0FBQU0sZUFBQSx3QkFDQUQsRUFBQUUsVUFBQSxHQUNBLElBQUFDLEVBQUFSLFNBQUFTLGNBQUEsVUFDQUQsRUFBQUQsVUFBQSxvQkFDQUMsRUFBQXZLLE1BQUEsTUFDQW9LLEVBQUFLLE9BQUFGLEdBQ0E1RCxFQUFBekgsUUFBQSxTQUFBd0gsR0FDQSxJQUFBNkQsRUFBQVIsU0FBQVMsY0FBQSxVQUNBRCxFQUFBRCxVQUFBNUQsRUFDQTZELEVBQUF2SyxNQUFBMEcsRUFDQTBELEVBQUFLLE9BQUFGLE1BT0FMLGNBQUEsV0FDQW5GLFNBQUFtRixjQUFBLFNBQUE1TCxFQUFBeUksR0FDQXpJLEVBRUEwSyxRQUFBMUssTUFBQUEsSUFFQXdGLEtBQUFpRCxTQUFBQSxFQUNBMkQsdUJBUUFBLGlCQUFBLFdBQ0EsSUFBQTNELEVBQUEsRUFBQWxILFVBQUEwQyxhQUFBUyxJQUFBbkQsVUFBQSxHQUFBQSxVQUFBLEdBQUFpRSxLQUFBaUQsU0FFQXFELEVBQUFMLFNBQUFNLGVBQUEsbUJBQ0FELEVBQUFFLFVBQUEsR0FDQSxJQUFBQyxFQUFBUixTQUFBUyxjQUFBLFVBQ0FELEVBQUFELFVBQUEsZUFDQUMsRUFBQXZLLE1BQUEsTUFDQW9LLEVBQUFLLE9BQUFGLEdBQ0F4RCxFQUFBN0gsUUFBQSxTQUFBb0gsR0FDQSxJQUFBaUUsRUFBQVIsU0FBQVMsY0FBQSxVQUNBRCxFQUFBRCxVQUFBaEUsRUFDQWlFLEVBQUF2SyxNQUFBc0csRUFDQThELEVBQUFLLE9BQUFGLE1BT0FQLFFBQUEsV0FLQWxHLEtBQUFnQixJQUFBLElBQUFvQyxPQUFBQyxLQUFBd0QsSUFBQVosU0FBQU0sZUFBQSxPQUFBLENBQ0FPLEtBQUEsR0FDQUMsT0FOQSxDQUNBQyxJQUFBLFVBQ0FDLEtBQUEsV0FLQUMsYUFBQSxJQUVBQyxxQkFNQUEsa0JBQUEsV0FDQSxJQUFBQyxFQUFBbkIsU0FBQU0sZUFBQSxtQkFDQWMsRUFBQXBCLFNBQUFNLGVBQUEsd0JBRUFlLEVBQUFGLEVBQUFHLGNBQ0FDLEVBQUFILEVBQUFFLGNBRUEvRSxFQUFBNEUsRUFBQUUsR0FBQXBMLE1BQ0EwRyxFQUFBeUUsRUFBQUcsR0FBQXRMLE1BRUErRSxTQUFBd0csd0NBQUFqRixFQUFBSSxFQUFBLFNBQUFwSSxFQUFBK0csR0FDQS9HLEVBRUEwSyxRQUFBMUssTUFBQUEsSUFFQWtOLGlCQUFBbkcsR0FDQW9HLDBCQVFBRCxpQkFBQSxTQUFBbkcsR0FFQXZCLEtBQUF1QixZQUFBLEdBQ0EwRSxTQUFBTSxlQUFBLG9CQUNBQyxVQUFBLEdBR0F4RyxLQUFBOEYsU0FDQTlGLEtBQUE4RixRQUFBMUssUUFBQSxTQUFBd00sR0FDQSxPQUFBQSxFQUFBQyxPQUFBLFFBR0E3SCxLQUFBOEYsUUFBQSxHQUNBOUYsS0FBQXVCLFlBQUFBLEdBTUFvRyxvQkFBQSxXQUNBLElBQUFwRyxFQUFBLEVBQUF4RixVQUFBMEMsYUFBQVMsSUFBQW5ELFVBQUEsR0FBQUEsVUFBQSxHQUFBaUUsS0FBQXVCLFlBRUF1RyxFQUFBN0IsU0FBQU0sZUFBQSxvQkFDQXdCLEVBQUE5QixTQUFBK0IsY0FBQSxJQUNBekcsRUFBQW5HLFFBQUEsU0FBQXlHLEdBQ0FpRyxFQUFBbkIsT0FBQXNCLHFCQUFBcEcsSUFDQWlHLEVBQUFuQixPQUFBb0IsS0FFQUcsbUJBTUFELHFCQUFBLFNBQUFwRyxHQUNBLElBQUFzRyxFQUFBbEMsU0FBQVMsY0FBQSxNQUVBMEIsRUFBQW5DLFNBQUFTLGNBQUEsVUFDQTBCLEVBQUE1QixVQUFBLElBQ0E0QixFQUFBQyxVQUFBQyxJQUFBLGFBQ0FDLGdCQUFBSCxFQUFBdkcsRUFBQXFDLGFBQ0FrRSxFQUFBSSxRQUFBLFdBQ0EsU0FBQTNHLEVBQUFxQyxZQUNBckMsRUFBQXFDLFlBQUEsUUFDQSxVQUFBckMsRUFBQXFDLGNBQ0FyQyxFQUFBcUMsWUFBQSxRQUVBakQsU0FBQXdILGlDQUFBNUcsRUFBQVIsR0FBQVEsRUFBQXFDLFlBQUEsU0FBQTFKLEVBQUFrTyxHQUNBbE8sRUFDQTBLLFFBQUFDLElBQUEzSyxJQUVBMEssUUFBQUMsSUFBQXVELEdBQ0FILGdCQUFBSCxFQUFBdkcsRUFBQXFDLGlCQUlBaUUsRUFBQXhCLE9BQUF5QixHQUVBLElBQUFPLEVBQUExQyxTQUFBUyxjQUFBLE9BQ0FpQyxFQUFBQyxVQUFBLGlCQUNBLElBQ0FDLEVBREE1SCxTQUFBNkgsc0JBQUFqSCxHQUVBa0gsRUFBQSxPQUNBSixFQUFBSyxJQUFBSCxFQUFBLFdBQUFFLEVBQ0FKLEVBQUFNLGFBQUEsU0FBQUosRUFBQSxXQUFBRSxFQUFBLFVBQUFGLEVBQUEsV0FBQUUsRUFBQSxTQUNBSixFQUFBTSxhQUFBLFFBQUEsd0dBQ0FOLEVBQUFNLGFBQUEsTUFBQXBILEVBQUF2QyxLQUFBLGVBQ0E2SSxFQUFBeEIsT0FBQWdDLEdBRUEsSUFBQU8sRUFBQWpELFNBQUFTLGNBQUEsT0FDQXdDLEVBQUFOLFVBQUEsdUJBQ0FULEVBQUF4QixPQUFBdUMsR0FFQSxJQUFBNUosRUFBQTJHLFNBQUFTLGNBQUEsTUFDQXBILEVBQUFrSCxVQUFBM0UsRUFBQXZDLEtBQ0E0SixFQUFBdkMsT0FBQXJILEdBRUEsSUFBQXNELEVBQUFxRCxTQUFBUyxjQUFBLEtBQ0E5RCxFQUFBNEQsVUFBQTNFLEVBQUFlLGFBQ0FzRyxFQUFBdkMsT0FBQS9ELEdBRUEsSUFBQXVHLEVBQUFsRCxTQUFBUyxjQUFBLEtBQ0F5QyxFQUFBM0MsVUFBQTNFLEVBQUFzSCxRQUNBRCxFQUFBdkMsT0FBQXdDLEdBRUEsSUFBQUMsRUFBQW5ELFNBQUFTLGNBQUEsS0FPQSxPQU5BMEMsRUFBQTVDLFVBQUEsZUFDQTRDLEVBQUFDLEtBQUFwSSxTQUFBMEMsaUJBQUE5QixHQUNBdUgsRUFBQUgsYUFBQSxPQUFBLFVBQ0FHLEVBQUFILGFBQUEsYUFBQSwyQkFDQUMsRUFBQXZDLE9BQUF5QyxHQUVBakIsR0FNQUQsZ0JBQUEsWUFDQSxFQUFBbk0sVUFBQTBDLGFBQUFTLElBQUFuRCxVQUFBLEdBQUFBLFVBQUEsR0FBQWlFLEtBQUF1QixhQUVBbkcsUUFBQSxTQUFBeUcsR0FFQSxJQUFBeUgsRUFBQXJJLFNBQUFzSSx1QkFBQTFILEVBQUE3QixLQUFBZ0IsS0FDQW9DLE9BQUFDLEtBQUExRCxNQUFBNkosWUFBQUYsRUFBQSxRQUFBLFdBQ0E5RCxPQUFBaUUsU0FBQUosS0FBQUMsRUFBQTVGLE1BRUExRCxLQUFBOEYsUUFBQTdHLEtBQUFxSyxNQUlBZixnQkFBQSxTQUFBbUIsRUFBQUMsR0FDQSxTQUFBQSxHQUNBRCxFQUFBckIsVUFBQXVCLE9BQUEsVUFDQUYsRUFBQXJCLFVBQUFDLElBQUEsT0FDQW9CLEVBQUFULGFBQUEsYUFBQSxxQkFDQSxVQUFBVSxJQUNBRCxFQUFBckIsVUFBQXVCLE9BQUEsT0FDQUYsRUFBQXJCLFVBQUFDLElBQUEsVUFDQW9CLEVBQUFULGFBQUEsYUFBQSIsImZpbGUiOiJtYWluLmJ1bmRsZS5qcyIsInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcblxuKGZ1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gdG9BcnJheShhcnIpIHtcbiAgICByZXR1cm4gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJyKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHByb21pc2lmeVJlcXVlc3QocmVxdWVzdCkge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICByZXF1ZXN0Lm9uc3VjY2VzcyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmVzb2x2ZShyZXF1ZXN0LnJlc3VsdCk7XG4gICAgICB9O1xuXG4gICAgICByZXF1ZXN0Lm9uZXJyb3IgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJlamVjdChyZXF1ZXN0LmVycm9yKTtcbiAgICAgIH07XG4gICAgfSk7XG4gIH1cblxuICBmdW5jdGlvbiBwcm9taXNpZnlSZXF1ZXN0Q2FsbChvYmosIG1ldGhvZCwgYXJncykge1xuICAgIHZhciByZXF1ZXN0O1xuICAgIHZhciBwID0gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgcmVxdWVzdCA9IG9ialttZXRob2RdLmFwcGx5KG9iaiwgYXJncyk7XG4gICAgICBwcm9taXNpZnlSZXF1ZXN0KHJlcXVlc3QpLnRoZW4ocmVzb2x2ZSwgcmVqZWN0KTtcbiAgICB9KTtcblxuICAgIHAucmVxdWVzdCA9IHJlcXVlc3Q7XG4gICAgcmV0dXJuIHA7XG4gIH1cblxuICBmdW5jdGlvbiBwcm9taXNpZnlDdXJzb3JSZXF1ZXN0Q2FsbChvYmosIG1ldGhvZCwgYXJncykge1xuICAgIHZhciBwID0gcHJvbWlzaWZ5UmVxdWVzdENhbGwob2JqLCBtZXRob2QsIGFyZ3MpO1xuICAgIHJldHVybiBwLnRoZW4oZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICBpZiAoIXZhbHVlKSByZXR1cm47XG4gICAgICByZXR1cm4gbmV3IEN1cnNvcih2YWx1ZSwgcC5yZXF1ZXN0KTtcbiAgICB9KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHByb3h5UHJvcGVydGllcyhQcm94eUNsYXNzLCB0YXJnZXRQcm9wLCBwcm9wZXJ0aWVzKSB7XG4gICAgcHJvcGVydGllcy5mb3JFYWNoKGZ1bmN0aW9uIChwcm9wKSB7XG4gICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoUHJveHlDbGFzcy5wcm90b3R5cGUsIHByb3AsIHtcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7XG4gICAgICAgICAgcmV0dXJuIHRoaXNbdGFyZ2V0UHJvcF1bcHJvcF07XG4gICAgICAgIH0sXG4gICAgICAgIHNldDogZnVuY3Rpb24gc2V0KHZhbCkge1xuICAgICAgICAgIHRoaXNbdGFyZ2V0UHJvcF1bcHJvcF0gPSB2YWw7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH0pO1xuICB9XG5cbiAgZnVuY3Rpb24gcHJveHlSZXF1ZXN0TWV0aG9kcyhQcm94eUNsYXNzLCB0YXJnZXRQcm9wLCBDb25zdHJ1Y3RvciwgcHJvcGVydGllcykge1xuICAgIHByb3BlcnRpZXMuZm9yRWFjaChmdW5jdGlvbiAocHJvcCkge1xuICAgICAgaWYgKCEocHJvcCBpbiBDb25zdHJ1Y3Rvci5wcm90b3R5cGUpKSByZXR1cm47XG4gICAgICBQcm94eUNsYXNzLnByb3RvdHlwZVtwcm9wXSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHByb21pc2lmeVJlcXVlc3RDYWxsKHRoaXNbdGFyZ2V0UHJvcF0sIHByb3AsIGFyZ3VtZW50cyk7XG4gICAgICB9O1xuICAgIH0pO1xuICB9XG5cbiAgZnVuY3Rpb24gcHJveHlNZXRob2RzKFByb3h5Q2xhc3MsIHRhcmdldFByb3AsIENvbnN0cnVjdG9yLCBwcm9wZXJ0aWVzKSB7XG4gICAgcHJvcGVydGllcy5mb3JFYWNoKGZ1bmN0aW9uIChwcm9wKSB7XG4gICAgICBpZiAoIShwcm9wIGluIENvbnN0cnVjdG9yLnByb3RvdHlwZSkpIHJldHVybjtcbiAgICAgIFByb3h5Q2xhc3MucHJvdG90eXBlW3Byb3BdID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gdGhpc1t0YXJnZXRQcm9wXVtwcm9wXS5hcHBseSh0aGlzW3RhcmdldFByb3BdLCBhcmd1bWVudHMpO1xuICAgICAgfTtcbiAgICB9KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHByb3h5Q3Vyc29yUmVxdWVzdE1ldGhvZHMoUHJveHlDbGFzcywgdGFyZ2V0UHJvcCwgQ29uc3RydWN0b3IsIHByb3BlcnRpZXMpIHtcbiAgICBwcm9wZXJ0aWVzLmZvckVhY2goZnVuY3Rpb24gKHByb3ApIHtcbiAgICAgIGlmICghKHByb3AgaW4gQ29uc3RydWN0b3IucHJvdG90eXBlKSkgcmV0dXJuO1xuICAgICAgUHJveHlDbGFzcy5wcm90b3R5cGVbcHJvcF0gPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBwcm9taXNpZnlDdXJzb3JSZXF1ZXN0Q2FsbCh0aGlzW3RhcmdldFByb3BdLCBwcm9wLCBhcmd1bWVudHMpO1xuICAgICAgfTtcbiAgICB9KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIEluZGV4KGluZGV4KSB7XG4gICAgdGhpcy5faW5kZXggPSBpbmRleDtcbiAgfVxuXG4gIHByb3h5UHJvcGVydGllcyhJbmRleCwgJ19pbmRleCcsIFsnbmFtZScsICdrZXlQYXRoJywgJ211bHRpRW50cnknLCAndW5pcXVlJ10pO1xuXG4gIHByb3h5UmVxdWVzdE1ldGhvZHMoSW5kZXgsICdfaW5kZXgnLCBJREJJbmRleCwgWydnZXQnLCAnZ2V0S2V5JywgJ2dldEFsbCcsICdnZXRBbGxLZXlzJywgJ2NvdW50J10pO1xuXG4gIHByb3h5Q3Vyc29yUmVxdWVzdE1ldGhvZHMoSW5kZXgsICdfaW5kZXgnLCBJREJJbmRleCwgWydvcGVuQ3Vyc29yJywgJ29wZW5LZXlDdXJzb3InXSk7XG5cbiAgZnVuY3Rpb24gQ3Vyc29yKGN1cnNvciwgcmVxdWVzdCkge1xuICAgIHRoaXMuX2N1cnNvciA9IGN1cnNvcjtcbiAgICB0aGlzLl9yZXF1ZXN0ID0gcmVxdWVzdDtcbiAgfVxuXG4gIHByb3h5UHJvcGVydGllcyhDdXJzb3IsICdfY3Vyc29yJywgWydkaXJlY3Rpb24nLCAna2V5JywgJ3ByaW1hcnlLZXknLCAndmFsdWUnXSk7XG5cbiAgcHJveHlSZXF1ZXN0TWV0aG9kcyhDdXJzb3IsICdfY3Vyc29yJywgSURCQ3Vyc29yLCBbJ3VwZGF0ZScsICdkZWxldGUnXSk7XG5cbiAgLy8gcHJveHkgJ25leHQnIG1ldGhvZHNcbiAgWydhZHZhbmNlJywgJ2NvbnRpbnVlJywgJ2NvbnRpbnVlUHJpbWFyeUtleSddLmZvckVhY2goZnVuY3Rpb24gKG1ldGhvZE5hbWUpIHtcbiAgICBpZiAoIShtZXRob2ROYW1lIGluIElEQkN1cnNvci5wcm90b3R5cGUpKSByZXR1cm47XG4gICAgQ3Vyc29yLnByb3RvdHlwZVttZXRob2ROYW1lXSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHZhciBjdXJzb3IgPSB0aGlzO1xuICAgICAgdmFyIGFyZ3MgPSBhcmd1bWVudHM7XG4gICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCkudGhlbihmdW5jdGlvbiAoKSB7XG4gICAgICAgIGN1cnNvci5fY3Vyc29yW21ldGhvZE5hbWVdLmFwcGx5KGN1cnNvci5fY3Vyc29yLCBhcmdzKTtcbiAgICAgICAgcmV0dXJuIHByb21pc2lmeVJlcXVlc3QoY3Vyc29yLl9yZXF1ZXN0KS50aGVuKGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgICAgIGlmICghdmFsdWUpIHJldHVybjtcbiAgICAgICAgICByZXR1cm4gbmV3IEN1cnNvcih2YWx1ZSwgY3Vyc29yLl9yZXF1ZXN0KTtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9O1xuICB9KTtcblxuICBmdW5jdGlvbiBPYmplY3RTdG9yZShzdG9yZSkge1xuICAgIHRoaXMuX3N0b3JlID0gc3RvcmU7XG4gIH1cblxuICBPYmplY3RTdG9yZS5wcm90b3R5cGUuY3JlYXRlSW5kZXggPSBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIG5ldyBJbmRleCh0aGlzLl9zdG9yZS5jcmVhdGVJbmRleC5hcHBseSh0aGlzLl9zdG9yZSwgYXJndW1lbnRzKSk7XG4gIH07XG5cbiAgT2JqZWN0U3RvcmUucHJvdG90eXBlLmluZGV4ID0gZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiBuZXcgSW5kZXgodGhpcy5fc3RvcmUuaW5kZXguYXBwbHkodGhpcy5fc3RvcmUsIGFyZ3VtZW50cykpO1xuICB9O1xuXG4gIHByb3h5UHJvcGVydGllcyhPYmplY3RTdG9yZSwgJ19zdG9yZScsIFsnbmFtZScsICdrZXlQYXRoJywgJ2luZGV4TmFtZXMnLCAnYXV0b0luY3JlbWVudCddKTtcblxuICBwcm94eVJlcXVlc3RNZXRob2RzKE9iamVjdFN0b3JlLCAnX3N0b3JlJywgSURCT2JqZWN0U3RvcmUsIFsncHV0JywgJ2FkZCcsICdkZWxldGUnLCAnY2xlYXInLCAnZ2V0JywgJ2dldEFsbCcsICdnZXRLZXknLCAnZ2V0QWxsS2V5cycsICdjb3VudCddKTtcblxuICBwcm94eUN1cnNvclJlcXVlc3RNZXRob2RzKE9iamVjdFN0b3JlLCAnX3N0b3JlJywgSURCT2JqZWN0U3RvcmUsIFsnb3BlbkN1cnNvcicsICdvcGVuS2V5Q3Vyc29yJ10pO1xuXG4gIHByb3h5TWV0aG9kcyhPYmplY3RTdG9yZSwgJ19zdG9yZScsIElEQk9iamVjdFN0b3JlLCBbJ2RlbGV0ZUluZGV4J10pO1xuXG4gIGZ1bmN0aW9uIFRyYW5zYWN0aW9uKGlkYlRyYW5zYWN0aW9uKSB7XG4gICAgdGhpcy5fdHggPSBpZGJUcmFuc2FjdGlvbjtcbiAgICB0aGlzLmNvbXBsZXRlID0gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgaWRiVHJhbnNhY3Rpb24ub25jb21wbGV0ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmVzb2x2ZSgpO1xuICAgICAgfTtcbiAgICAgIGlkYlRyYW5zYWN0aW9uLm9uZXJyb3IgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJlamVjdChpZGJUcmFuc2FjdGlvbi5lcnJvcik7XG4gICAgICB9O1xuICAgICAgaWRiVHJhbnNhY3Rpb24ub25hYm9ydCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmVqZWN0KGlkYlRyYW5zYWN0aW9uLmVycm9yKTtcbiAgICAgIH07XG4gICAgfSk7XG4gIH1cblxuICBUcmFuc2FjdGlvbi5wcm90b3R5cGUub2JqZWN0U3RvcmUgPSBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIG5ldyBPYmplY3RTdG9yZSh0aGlzLl90eC5vYmplY3RTdG9yZS5hcHBseSh0aGlzLl90eCwgYXJndW1lbnRzKSk7XG4gIH07XG5cbiAgcHJveHlQcm9wZXJ0aWVzKFRyYW5zYWN0aW9uLCAnX3R4JywgWydvYmplY3RTdG9yZU5hbWVzJywgJ21vZGUnXSk7XG5cbiAgcHJveHlNZXRob2RzKFRyYW5zYWN0aW9uLCAnX3R4JywgSURCVHJhbnNhY3Rpb24sIFsnYWJvcnQnXSk7XG5cbiAgZnVuY3Rpb24gVXBncmFkZURCKGRiLCBvbGRWZXJzaW9uLCB0cmFuc2FjdGlvbikge1xuICAgIHRoaXMuX2RiID0gZGI7XG4gICAgdGhpcy5vbGRWZXJzaW9uID0gb2xkVmVyc2lvbjtcbiAgICB0aGlzLnRyYW5zYWN0aW9uID0gbmV3IFRyYW5zYWN0aW9uKHRyYW5zYWN0aW9uKTtcbiAgfVxuXG4gIFVwZ3JhZGVEQi5wcm90b3R5cGUuY3JlYXRlT2JqZWN0U3RvcmUgPSBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIG5ldyBPYmplY3RTdG9yZSh0aGlzLl9kYi5jcmVhdGVPYmplY3RTdG9yZS5hcHBseSh0aGlzLl9kYiwgYXJndW1lbnRzKSk7XG4gIH07XG5cbiAgcHJveHlQcm9wZXJ0aWVzKFVwZ3JhZGVEQiwgJ19kYicsIFsnbmFtZScsICd2ZXJzaW9uJywgJ29iamVjdFN0b3JlTmFtZXMnXSk7XG5cbiAgcHJveHlNZXRob2RzKFVwZ3JhZGVEQiwgJ19kYicsIElEQkRhdGFiYXNlLCBbJ2RlbGV0ZU9iamVjdFN0b3JlJywgJ2Nsb3NlJ10pO1xuXG4gIGZ1bmN0aW9uIERCKGRiKSB7XG4gICAgdGhpcy5fZGIgPSBkYjtcbiAgfVxuXG4gIERCLnByb3RvdHlwZS50cmFuc2FjdGlvbiA9IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gbmV3IFRyYW5zYWN0aW9uKHRoaXMuX2RiLnRyYW5zYWN0aW9uLmFwcGx5KHRoaXMuX2RiLCBhcmd1bWVudHMpKTtcbiAgfTtcblxuICBwcm94eVByb3BlcnRpZXMoREIsICdfZGInLCBbJ25hbWUnLCAndmVyc2lvbicsICdvYmplY3RTdG9yZU5hbWVzJ10pO1xuXG4gIHByb3h5TWV0aG9kcyhEQiwgJ19kYicsIElEQkRhdGFiYXNlLCBbJ2Nsb3NlJ10pO1xuXG4gIC8vIEFkZCBjdXJzb3IgaXRlcmF0b3JzXG4gIC8vIFRPRE86IHJlbW92ZSB0aGlzIG9uY2UgYnJvd3NlcnMgZG8gdGhlIHJpZ2h0IHRoaW5nIHdpdGggcHJvbWlzZXNcbiAgWydvcGVuQ3Vyc29yJywgJ29wZW5LZXlDdXJzb3InXS5mb3JFYWNoKGZ1bmN0aW9uIChmdW5jTmFtZSkge1xuICAgIFtPYmplY3RTdG9yZSwgSW5kZXhdLmZvckVhY2goZnVuY3Rpb24gKENvbnN0cnVjdG9yKSB7XG4gICAgICAvLyBEb24ndCBjcmVhdGUgaXRlcmF0ZUtleUN1cnNvciBpZiBvcGVuS2V5Q3Vyc29yIGRvZXNuJ3QgZXhpc3QuXG4gICAgICBpZiAoIShmdW5jTmFtZSBpbiBDb25zdHJ1Y3Rvci5wcm90b3R5cGUpKSByZXR1cm47XG5cbiAgICAgIENvbnN0cnVjdG9yLnByb3RvdHlwZVtmdW5jTmFtZS5yZXBsYWNlKCdvcGVuJywgJ2l0ZXJhdGUnKV0gPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBhcmdzID0gdG9BcnJheShhcmd1bWVudHMpO1xuICAgICAgICB2YXIgY2FsbGJhY2sgPSBhcmdzW2FyZ3MubGVuZ3RoIC0gMV07XG4gICAgICAgIHZhciBuYXRpdmVPYmplY3QgPSB0aGlzLl9zdG9yZSB8fCB0aGlzLl9pbmRleDtcbiAgICAgICAgdmFyIHJlcXVlc3QgPSBuYXRpdmVPYmplY3RbZnVuY05hbWVdLmFwcGx5KG5hdGl2ZU9iamVjdCwgYXJncy5zbGljZSgwLCAtMSkpO1xuICAgICAgICByZXF1ZXN0Lm9uc3VjY2VzcyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICBjYWxsYmFjayhyZXF1ZXN0LnJlc3VsdCk7XG4gICAgICAgIH07XG4gICAgICB9O1xuICAgIH0pO1xuICB9KTtcblxuICAvLyBwb2x5ZmlsbCBnZXRBbGxcbiAgW0luZGV4LCBPYmplY3RTdG9yZV0uZm9yRWFjaChmdW5jdGlvbiAoQ29uc3RydWN0b3IpIHtcbiAgICBpZiAoQ29uc3RydWN0b3IucHJvdG90eXBlLmdldEFsbCkgcmV0dXJuO1xuICAgIENvbnN0cnVjdG9yLnByb3RvdHlwZS5nZXRBbGwgPSBmdW5jdGlvbiAocXVlcnksIGNvdW50KSB7XG4gICAgICB2YXIgaW5zdGFuY2UgPSB0aGlzO1xuICAgICAgdmFyIGl0ZW1zID0gW107XG5cbiAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSkge1xuICAgICAgICBpbnN0YW5jZS5pdGVyYXRlQ3Vyc29yKHF1ZXJ5LCBmdW5jdGlvbiAoY3Vyc29yKSB7XG4gICAgICAgICAgaWYgKCFjdXJzb3IpIHtcbiAgICAgICAgICAgIHJlc29sdmUoaXRlbXMpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpdGVtcy5wdXNoKGN1cnNvci52YWx1ZSk7XG5cbiAgICAgICAgICBpZiAoY291bnQgIT09IHVuZGVmaW5lZCAmJiBpdGVtcy5sZW5ndGggPT0gY291bnQpIHtcbiAgICAgICAgICAgIHJlc29sdmUoaXRlbXMpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH1cbiAgICAgICAgICBjdXJzb3IuY29udGludWUoKTtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9O1xuICB9KTtcblxuICB2YXIgZXhwID0ge1xuICAgIG9wZW46IGZ1bmN0aW9uIG9wZW4obmFtZSwgdmVyc2lvbiwgdXBncmFkZUNhbGxiYWNrKSB7XG4gICAgICB2YXIgcCA9IHByb21pc2lmeVJlcXVlc3RDYWxsKGluZGV4ZWREQiwgJ29wZW4nLCBbbmFtZSwgdmVyc2lvbl0pO1xuICAgICAgdmFyIHJlcXVlc3QgPSBwLnJlcXVlc3Q7XG5cbiAgICAgIGlmIChyZXF1ZXN0KSB7XG4gICAgICAgIHJlcXVlc3Qub251cGdyYWRlbmVlZGVkID0gZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgICAgaWYgKHVwZ3JhZGVDYWxsYmFjaykge1xuICAgICAgICAgICAgdXBncmFkZUNhbGxiYWNrKG5ldyBVcGdyYWRlREIocmVxdWVzdC5yZXN1bHQsIGV2ZW50Lm9sZFZlcnNpb24sIHJlcXVlc3QudHJhbnNhY3Rpb24pKTtcbiAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBwLnRoZW4oZnVuY3Rpb24gKGRiKSB7XG4gICAgICAgIHJldHVybiBuZXcgREIoZGIpO1xuICAgICAgfSk7XG4gICAgfSxcbiAgICBkZWxldGU6IGZ1bmN0aW9uIF9kZWxldGUobmFtZSkge1xuICAgICAgcmV0dXJuIHByb21pc2lmeVJlcXVlc3RDYWxsKGluZGV4ZWREQiwgJ2RlbGV0ZURhdGFiYXNlJywgW25hbWVdKTtcbiAgICB9XG4gIH07XG5cbiAgaWYgKHR5cGVvZiBtb2R1bGUgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgbW9kdWxlLmV4cG9ydHMgPSBleHA7XG4gICAgbW9kdWxlLmV4cG9ydHMuZGVmYXVsdCA9IG1vZHVsZS5leHBvcnRzO1xuICB9IGVsc2Uge1xuICAgIHNlbGYuaWRiID0gZXhwO1xuICB9XG59KSgpOyIsIid1c2Ugc3RyaWN0JztcblxudmFyIF9jcmVhdGVDbGFzcyA9IGZ1bmN0aW9uICgpIHsgZnVuY3Rpb24gZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIHByb3BzKSB7IGZvciAodmFyIGkgPSAwOyBpIDwgcHJvcHMubGVuZ3RoOyBpKyspIHsgdmFyIGRlc2NyaXB0b3IgPSBwcm9wc1tpXTsgZGVzY3JpcHRvci5lbnVtZXJhYmxlID0gZGVzY3JpcHRvci5lbnVtZXJhYmxlIHx8IGZhbHNlOyBkZXNjcmlwdG9yLmNvbmZpZ3VyYWJsZSA9IHRydWU7IGlmIChcInZhbHVlXCIgaW4gZGVzY3JpcHRvcikgZGVzY3JpcHRvci53cml0YWJsZSA9IHRydWU7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGRlc2NyaXB0b3Iua2V5LCBkZXNjcmlwdG9yKTsgfSB9IHJldHVybiBmdW5jdGlvbiAoQ29uc3RydWN0b3IsIHByb3RvUHJvcHMsIHN0YXRpY1Byb3BzKSB7IGlmIChwcm90b1Byb3BzKSBkZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLnByb3RvdHlwZSwgcHJvdG9Qcm9wcyk7IGlmIChzdGF0aWNQcm9wcykgZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvciwgc3RhdGljUHJvcHMpOyByZXR1cm4gQ29uc3RydWN0b3I7IH07IH0oKTtcblxuZnVuY3Rpb24gX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3RvcikgeyBpZiAoIShpbnN0YW5jZSBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKFwiQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uXCIpOyB9IH1cblxuLyoqXG4gKiBDb21tb24gZGF0YWJhc2UgaGVscGVyIGZ1bmN0aW9ucy5cbiAqL1xuXG52YXIgREJIZWxwZXIgPSBmdW5jdGlvbiAoKSB7XG5cdGZ1bmN0aW9uIERCSGVscGVyKCkge1xuXHRcdF9jbGFzc0NhbGxDaGVjayh0aGlzLCBEQkhlbHBlcik7XG5cdH1cblxuXHRfY3JlYXRlQ2xhc3MoREJIZWxwZXIsIG51bGwsIFt7XG5cdFx0a2V5OiAnb3BlbklkYicsXG5cdFx0dmFsdWU6IGZ1bmN0aW9uIG9wZW5JZGIoKSB7XG5cdFx0XHRyZXR1cm4gaWRiLm9wZW4oJ2RiJywgMiwgZnVuY3Rpb24gKHVwZ3JhZGVEYikge1xuXHRcdFx0XHRzd2l0Y2ggKHVwZ3JhZGVEYi5vbGRWZXJzaW9uKSB7XG5cdFx0XHRcdFx0Y2FzZSAwOlxuXHRcdFx0XHRcdFx0dXBncmFkZURiLmNyZWF0ZU9iamVjdFN0b3JlKCdyZXN0YXVyYW50cy1zdG9yZScsIHtcblx0XHRcdFx0XHRcdFx0a2V5UGF0aDogJ2lkJ1xuXHRcdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0Y2FzZSAxOlxuXHRcdFx0XHRcdFx0dmFyIHJldmlld3NTdG9yZSA9IHVwZ3JhZGVEYi5jcmVhdGVPYmplY3RTdG9yZSgncmV2aWV3cy1zdG9yZScsIHtcblx0XHRcdFx0XHRcdFx0a2V5UGF0aDogJ2lkJ1xuXHRcdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0XHRyZXZpZXdzU3RvcmUuY3JlYXRlSW5kZXgoJ2J5LXJlc3RhdXJhbnQnLCAncmVzdGF1cmFudF9pZCcpO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblx0XHR9XG5cdH0sIHtcblx0XHRrZXk6ICdnZXRDYWNoZWRSZXN0YXVyYW50cycsXG5cdFx0dmFsdWU6IGZ1bmN0aW9uIGdldENhY2hlZFJlc3RhdXJhbnRzKCkge1xuXHRcdFx0cmV0dXJuIERCSGVscGVyLm9wZW5JZGIoKS50aGVuKGZ1bmN0aW9uIChkYikge1xuXHRcdFx0XHRpZiAoIWRiKSByZXR1cm47XG5cdFx0XHRcdHZhciByZXN0YXVyYW50c1N0b3JlID0gZGIudHJhbnNhY3Rpb24oJ3Jlc3RhdXJhbnRzLXN0b3JlJykub2JqZWN0U3RvcmUoJ3Jlc3RhdXJhbnRzLXN0b3JlJyk7XG5cdFx0XHRcdHJldHVybiByZXN0YXVyYW50c1N0b3JlLmdldEFsbCgpO1xuXHRcdFx0fSk7XG5cdFx0fVxuXHR9LCB7XG5cdFx0a2V5OiAnZ2V0Q2FjaGVkUmV2aWV3cycsXG5cdFx0dmFsdWU6IGZ1bmN0aW9uIGdldENhY2hlZFJldmlld3MoaWQpIHtcblx0XHRcdHJldHVybiBEQkhlbHBlci5vcGVuSWRiKCkudGhlbihmdW5jdGlvbiAoZGIpIHtcblx0XHRcdFx0aWYgKCFkYikgcmV0dXJuO1xuXHRcdFx0XHR2YXIgcmV2aWV3c1N0b3JlID0gZGIudHJhbnNhY3Rpb24oJ3Jldmlld3Mtc3RvcmUnKS5vYmplY3RTdG9yZSgncmV2aWV3cy1zdG9yZScpO1xuXHRcdFx0XHR2YXIgcmVzdGF1cmFudFJldmlld3MgPSByZXZpZXdzU3RvcmUuaW5kZXgoJ2J5LXJlc3RhdXJhbnQnKTtcblx0XHRcdFx0cmV0dXJuIHJlc3RhdXJhbnRSZXZpZXdzLmdldEFsbChpZCk7XG5cdFx0XHR9KTtcblx0XHR9XG5cblx0XHQvKipcbiAgICogRmV0Y2ggYWxsIHJlc3RhdXJhbnRzLlxuICAgKi9cblxuXHR9LCB7XG5cdFx0a2V5OiAnZmV0Y2hSZXN0YXVyYW50cycsXG5cdFx0dmFsdWU6IGZ1bmN0aW9uIGZldGNoUmVzdGF1cmFudHMoY2FsbGJhY2spIHtcblx0XHRcdC8vIGdldCBkYXRhIGZyb20gaWRiIGlmIHRoZXJlIGFyZSBkYXRhXG5cdFx0XHREQkhlbHBlci5nZXRDYWNoZWRSZXN0YXVyYW50cygpLnRoZW4oZnVuY3Rpb24gKHJlc3RhdXJhbnRzKSB7XG5cdFx0XHRcdGlmIChyZXN0YXVyYW50cy5sZW5ndGggPiAwKSB7XG5cdFx0XHRcdFx0cmV0dXJuIGNhbGxiYWNrKG51bGwsIHJlc3RhdXJhbnRzKTtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cblx0XHRcdC8vIGZldGNoIGRhdGEgZnJvbSB0aGUgbmV0d29yayBhbmQgdXBkYXRlIHRoZSBpZGJcblx0XHRcdGZldGNoKERCSGVscGVyLkRBVEFCQVNFX1VSTCArICdyZXN0YXVyYW50cycpLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG5cdFx0XHRcdHJldHVybiByZXNwb25zZS5qc29uKCk7XG5cdFx0XHR9KS50aGVuKGZ1bmN0aW9uIChyZXN0YXVyYW50cykge1xuXHRcdFx0XHREQkhlbHBlci5vcGVuSWRiKCkudGhlbihmdW5jdGlvbiAoZGIpIHtcblx0XHRcdFx0XHRpZiAoIWRiKSByZXR1cm47XG5cdFx0XHRcdFx0dmFyIHR4ID0gZGIudHJhbnNhY3Rpb24oJ3Jlc3RhdXJhbnRzLXN0b3JlJywgJ3JlYWR3cml0ZScpO1xuXHRcdFx0XHRcdHZhciByZXN0YXVyYW50U3RvcmUgPSB0eC5vYmplY3RTdG9yZSgncmVzdGF1cmFudHMtc3RvcmUnKTtcblx0XHRcdFx0XHRyZXN0YXVyYW50cy5mb3JFYWNoKGZ1bmN0aW9uIChyZXN0YXVyYW50KSB7XG5cdFx0XHRcdFx0XHRyZXN0YXVyYW50U3RvcmUucHV0KHJlc3RhdXJhbnQpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9KTtcblx0XHRcdFx0cmV0dXJuIGNhbGxiYWNrKG51bGwsIHJlc3RhdXJhbnRzKTtcblx0XHRcdH0pLmNhdGNoKGZ1bmN0aW9uIChlcnIpIHtcblx0XHRcdFx0cmV0dXJuIGNhbGxiYWNrKGVyciwgbnVsbCk7XG5cdFx0XHR9KTtcblx0XHR9XG5cblx0XHQvKipcbiAgICogRmV0Y2ggcmVzdGF1cmFudCByZXZpZXdzLlxuICAgKi9cblxuXHR9LCB7XG5cdFx0a2V5OiAnZmV0Y2hSZXZpZXdzJyxcblx0XHR2YWx1ZTogZnVuY3Rpb24gZmV0Y2hSZXZpZXdzKGlkLCBjYWxsYmFjaykge1xuXHRcdFx0Ly8gZ2V0IGRhdGEgZnJvbSBpZGIgaWYgdGhlcmUgYXJlIGRhdGFcblx0XHRcdERCSGVscGVyLmdldENhY2hlZFJldmlld3MoaWQpLnRoZW4oZnVuY3Rpb24gKHJldmlld3MpIHtcblx0XHRcdFx0aWYgKHJldmlld3MubGVuZ3RoID4gMCkge1xuXHRcdFx0XHRcdHJldHVybiBjYWxsYmFjayhudWxsLCByZXZpZXdzLnJldmVyc2UoKSk7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXG5cdFx0XHQvLyBmZXRjaCBkYXRhIGZyb20gdGhlIG5ldHdvcmsgYW5kIHVwZGF0ZSB0aGUgaWRiXG5cdFx0XHRmZXRjaChEQkhlbHBlci5EQVRBQkFTRV9VUkwgKyAncmV2aWV3cy8/cmVzdGF1cmFudF9pZD0nICsgaWQpLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG5cdFx0XHRcdHJldHVybiByZXNwb25zZS5qc29uKCk7XG5cdFx0XHR9KS50aGVuKGZ1bmN0aW9uIChyZXZpZXdzKSB7XG5cdFx0XHRcdERCSGVscGVyLm9wZW5JZGIoKS50aGVuKGZ1bmN0aW9uIChkYikge1xuXHRcdFx0XHRcdGlmICghZGIpIHJldHVybjtcblx0XHRcdFx0XHR2YXIgdHggPSBkYi50cmFuc2FjdGlvbigncmV2aWV3cy1zdG9yZScsICdyZWFkd3JpdGUnKTtcblx0XHRcdFx0XHR2YXIgc3RvcmUgPSB0eC5vYmplY3RTdG9yZSgncmV2aWV3cy1zdG9yZScpO1xuXHRcdFx0XHRcdHJldmlld3MuZm9yRWFjaChmdW5jdGlvbiAocmV2aWV3KSB7XG5cdFx0XHRcdFx0XHRzdG9yZS5wdXQocmV2aWV3KTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fSk7XG5cdFx0XHRcdHJldHVybiBjYWxsYmFjayhudWxsLCByZXZpZXdzLnJldmVyc2UoKSk7XG5cdFx0XHR9KS5jYXRjaChmdW5jdGlvbiAoZXJyKSB7XG5cdFx0XHRcdHJldHVybiBjYWxsYmFjayhlcnIsIG51bGwpO1xuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0LyoqXG4gICAqIEZldGNoIGEgcmVzdGF1cmFudCBieSBpdHMgSUQuXG4gICAqL1xuXG5cdH0sIHtcblx0XHRrZXk6ICdmZXRjaFJlc3RhdXJhbnRCeUlkJyxcblx0XHR2YWx1ZTogZnVuY3Rpb24gZmV0Y2hSZXN0YXVyYW50QnlJZChpZCwgY2FsbGJhY2spIHtcblx0XHRcdC8vIGZldGNoIGFsbCByZXN0YXVyYW50cyB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZy5cblx0XHRcdERCSGVscGVyLmZldGNoUmVzdGF1cmFudHMoZnVuY3Rpb24gKGVycm9yLCByZXN0YXVyYW50cykge1xuXHRcdFx0XHRpZiAoZXJyb3IpIHtcblx0XHRcdFx0XHRjYWxsYmFjayhlcnJvciwgbnVsbCk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dmFyIHJlc3RhdXJhbnQgPSByZXN0YXVyYW50cy5maW5kKGZ1bmN0aW9uIChyKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gci5pZCA9PSBpZDtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHRpZiAocmVzdGF1cmFudCkge1xuXHRcdFx0XHRcdFx0Ly8gR290IHRoZSByZXN0YXVyYW50XG5cblx0XHRcdFx0XHRcdGNhbGxiYWNrKG51bGwsIHJlc3RhdXJhbnQpO1xuXHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHQvLyBSZXN0YXVyYW50IGRvZXMgbm90IGV4aXN0IGluIHRoZSBkYXRhYmFzZVxuXHRcdFx0XHRcdFx0Y2FsbGJhY2soJ1Jlc3RhdXJhbnQgZG9lcyBub3QgZXhpc3QnLCBudWxsKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdC8qKlxuICAgKiBGZXRjaCByZXN0YXVyYW50cyBieSBhIGN1aXNpbmUgdHlwZSB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZy5cbiAgICovXG5cblx0fSwge1xuXHRcdGtleTogJ2ZldGNoUmVzdGF1cmFudEJ5Q3Vpc2luZScsXG5cdFx0dmFsdWU6IGZ1bmN0aW9uIGZldGNoUmVzdGF1cmFudEJ5Q3Vpc2luZShjdWlzaW5lLCBjYWxsYmFjaykge1xuXHRcdFx0Ly8gRmV0Y2ggYWxsIHJlc3RhdXJhbnRzICB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZ1xuXHRcdFx0REJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50cyhmdW5jdGlvbiAoZXJyb3IsIHJlc3RhdXJhbnRzKSB7XG5cdFx0XHRcdGlmIChlcnJvcikge1xuXHRcdFx0XHRcdGNhbGxiYWNrKGVycm9yLCBudWxsKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHQvLyBGaWx0ZXIgcmVzdGF1cmFudHMgdG8gaGF2ZSBvbmx5IGdpdmVuIGN1aXNpbmUgdHlwZVxuXHRcdFx0XHRcdHZhciByZXN1bHRzID0gcmVzdGF1cmFudHMuZmlsdGVyKGZ1bmN0aW9uIChyKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gci5jdWlzaW5lX3R5cGUgPT0gY3Vpc2luZTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHRjYWxsYmFjayhudWxsLCByZXN1bHRzKTtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0LyoqXG4gICAqIEZldGNoIHJlc3RhdXJhbnRzIGJ5IGEgbmVpZ2hib3Job29kIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxuICAgKi9cblxuXHR9LCB7XG5cdFx0a2V5OiAnZmV0Y2hSZXN0YXVyYW50QnlOZWlnaGJvcmhvb2QnLFxuXHRcdHZhbHVlOiBmdW5jdGlvbiBmZXRjaFJlc3RhdXJhbnRCeU5laWdoYm9yaG9vZChuZWlnaGJvcmhvb2QsIGNhbGxiYWNrKSB7XG5cdFx0XHQvLyBGZXRjaCBhbGwgcmVzdGF1cmFudHNcblx0XHRcdERCSGVscGVyLmZldGNoUmVzdGF1cmFudHMoZnVuY3Rpb24gKGVycm9yLCByZXN0YXVyYW50cykge1xuXHRcdFx0XHRpZiAoZXJyb3IpIHtcblx0XHRcdFx0XHRjYWxsYmFjayhlcnJvciwgbnVsbCk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Ly8gRmlsdGVyIHJlc3RhdXJhbnRzIHRvIGhhdmUgb25seSBnaXZlbiBuZWlnaGJvcmhvb2Rcblx0XHRcdFx0XHR2YXIgcmVzdWx0cyA9IHJlc3RhdXJhbnRzLmZpbHRlcihmdW5jdGlvbiAocikge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIubmVpZ2hib3Job29kID09IG5laWdoYm9yaG9vZDtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHRjYWxsYmFjayhudWxsLCByZXN1bHRzKTtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0LyoqXG4gICAqIEZldGNoIHJlc3RhdXJhbnRzIGJ5IGEgY3Vpc2luZSBhbmQgYSBuZWlnaGJvcmhvb2Qgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXG4gICAqL1xuXG5cdH0sIHtcblx0XHRrZXk6ICdmZXRjaFJlc3RhdXJhbnRCeUN1aXNpbmVBbmROZWlnaGJvcmhvb2QnLFxuXHRcdHZhbHVlOiBmdW5jdGlvbiBmZXRjaFJlc3RhdXJhbnRCeUN1aXNpbmVBbmROZWlnaGJvcmhvb2QoY3Vpc2luZSwgbmVpZ2hib3Job29kLCBjYWxsYmFjaykge1xuXHRcdFx0Ly8gRmV0Y2ggYWxsIHJlc3RhdXJhbnRzXG5cdFx0XHREQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRzKGZ1bmN0aW9uIChlcnJvciwgcmVzdGF1cmFudHMpIHtcblx0XHRcdFx0aWYgKGVycm9yKSB7XG5cdFx0XHRcdFx0Y2FsbGJhY2soZXJyb3IsIG51bGwpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHZhciByZXN1bHRzID0gcmVzdGF1cmFudHM7XG5cdFx0XHRcdFx0aWYgKGN1aXNpbmUgIT0gJ2FsbCcpIHtcblx0XHRcdFx0XHRcdC8vIGZpbHRlciBieSBjdWlzaW5lXG5cdFx0XHRcdFx0XHRyZXN1bHRzID0gcmVzdWx0cy5maWx0ZXIoZnVuY3Rpb24gKHIpIHtcblx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuY3Vpc2luZV90eXBlID09IGN1aXNpbmU7XG5cdFx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0aWYgKG5laWdoYm9yaG9vZCAhPSAnYWxsJykge1xuXHRcdFx0XHRcdFx0Ly8gZmlsdGVyIGJ5IG5laWdoYm9yaG9vZFxuXHRcdFx0XHRcdFx0cmVzdWx0cyA9IHJlc3VsdHMuZmlsdGVyKGZ1bmN0aW9uIChyKSB7XG5cdFx0XHRcdFx0XHRcdHJldHVybiByLm5laWdoYm9yaG9vZCA9PSBuZWlnaGJvcmhvb2Q7XG5cdFx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0Y2FsbGJhY2sobnVsbCwgcmVzdWx0cyk7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdC8qKlxuICAgKiBGZXRjaCBhbGwgbmVpZ2hib3Job29kcyB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZy5cbiAgICovXG5cblx0fSwge1xuXHRcdGtleTogJ2ZldGNoTmVpZ2hib3Job29kcycsXG5cdFx0dmFsdWU6IGZ1bmN0aW9uIGZldGNoTmVpZ2hib3Job29kcyhjYWxsYmFjaykge1xuXHRcdFx0Ly8gRmV0Y2ggYWxsIHJlc3RhdXJhbnRzXG5cdFx0XHREQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRzKGZ1bmN0aW9uIChlcnJvciwgcmVzdGF1cmFudHMpIHtcblx0XHRcdFx0aWYgKGVycm9yKSB7XG5cdFx0XHRcdFx0Y2FsbGJhY2soZXJyb3IsIG51bGwpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdC8vIEdldCBhbGwgbmVpZ2hib3Job29kcyBmcm9tIGFsbCByZXN0YXVyYW50c1xuXHRcdFx0XHRcdHZhciBuZWlnaGJvcmhvb2RzID0gcmVzdGF1cmFudHMubWFwKGZ1bmN0aW9uICh2LCBpKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmVzdGF1cmFudHNbaV0ubmVpZ2hib3Job29kO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdC8vIFJlbW92ZSBkdXBsaWNhdGVzIGZyb20gbmVpZ2hib3Job29kc1xuXHRcdFx0XHRcdHZhciB1bmlxdWVOZWlnaGJvcmhvb2RzID0gbmVpZ2hib3Job29kcy5maWx0ZXIoZnVuY3Rpb24gKHYsIGkpIHtcblx0XHRcdFx0XHRcdHJldHVybiBuZWlnaGJvcmhvb2RzLmluZGV4T2YodikgPT0gaTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHRjYWxsYmFjayhudWxsLCB1bmlxdWVOZWlnaGJvcmhvb2RzKTtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0LyoqXG4gICAqIEZldGNoIGFsbCBjdWlzaW5lcyB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZy5cbiAgICovXG5cblx0fSwge1xuXHRcdGtleTogJ2ZldGNoQ3Vpc2luZXMnLFxuXHRcdHZhbHVlOiBmdW5jdGlvbiBmZXRjaEN1aXNpbmVzKGNhbGxiYWNrKSB7XG5cdFx0XHQvLyBGZXRjaCBhbGwgcmVzdGF1cmFudHNcblx0XHRcdERCSGVscGVyLmZldGNoUmVzdGF1cmFudHMoZnVuY3Rpb24gKGVycm9yLCByZXN0YXVyYW50cykge1xuXHRcdFx0XHRpZiAoZXJyb3IpIHtcblx0XHRcdFx0XHRjYWxsYmFjayhlcnJvciwgbnVsbCk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Ly8gR2V0IGFsbCBjdWlzaW5lcyBmcm9tIGFsbCByZXN0YXVyYW50c1xuXHRcdFx0XHRcdHZhciBjdWlzaW5lcyA9IHJlc3RhdXJhbnRzLm1hcChmdW5jdGlvbiAodiwgaSkge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHJlc3RhdXJhbnRzW2ldLmN1aXNpbmVfdHlwZTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHQvLyBSZW1vdmUgZHVwbGljYXRlcyBmcm9tIGN1aXNpbmVzXG5cdFx0XHRcdFx0dmFyIHVuaXF1ZUN1aXNpbmVzID0gY3Vpc2luZXMuZmlsdGVyKGZ1bmN0aW9uICh2LCBpKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gY3Vpc2luZXMuaW5kZXhPZih2KSA9PSBpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdGNhbGxiYWNrKG51bGwsIHVuaXF1ZUN1aXNpbmVzKTtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0LyoqXG4gICAqIFJlc3RhdXJhbnQgcGFnZSBVUkwuXG4gICAqL1xuXG5cdH0sIHtcblx0XHRrZXk6ICd1cmxGb3JSZXN0YXVyYW50Jyxcblx0XHR2YWx1ZTogZnVuY3Rpb24gdXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KSB7XG5cdFx0XHRyZXR1cm4gJy4vcmVzdGF1cmFudC5odG1sP2lkPScgKyByZXN0YXVyYW50LmlkO1xuXHRcdH1cblxuXHRcdC8qKlxuICAgKiBSZXN0YXVyYW50IGltYWdlIFVSTC5cbiAgICovXG5cblx0fSwge1xuXHRcdGtleTogJ2ltYWdlVXJsRm9yUmVzdGF1cmFudCcsXG5cdFx0dmFsdWU6IGZ1bmN0aW9uIGltYWdlVXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KSB7XG5cdFx0XHRyZXR1cm4gJy9pbWcvJyArIHJlc3RhdXJhbnQucGhvdG9ncmFwaDtcblx0XHR9XG5cblx0XHQvKipcbiAgICogTWFwIG1hcmtlciBmb3IgYSByZXN0YXVyYW50LlxuICAgKi9cblxuXHR9LCB7XG5cdFx0a2V5OiAnbWFwTWFya2VyRm9yUmVzdGF1cmFudCcsXG5cdFx0dmFsdWU6IGZ1bmN0aW9uIG1hcE1hcmtlckZvclJlc3RhdXJhbnQocmVzdGF1cmFudCwgbWFwKSB7XG5cdFx0XHR2YXIgbWFya2VyID0gbmV3IGdvb2dsZS5tYXBzLk1hcmtlcih7XG5cdFx0XHRcdHBvc2l0aW9uOiByZXN0YXVyYW50LmxhdGxuZyxcblx0XHRcdFx0dGl0bGU6IHJlc3RhdXJhbnQubmFtZSxcblx0XHRcdFx0dXJsOiBEQkhlbHBlci51cmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpLFxuXHRcdFx0XHRtYXA6IG1hcCxcblx0XHRcdFx0YW5pbWF0aW9uOiBnb29nbGUubWFwcy5BbmltYXRpb24uRFJPUFxuXHRcdFx0fSk7XG5cdFx0XHRyZXR1cm4gbWFya2VyO1xuXHRcdH1cblx0fSwge1xuXHRcdGtleTogJ2NoYW5nZUZhdm9yaXRlU3RhdGVGb3JSZXN0YXVyYW50Jyxcblx0XHR2YWx1ZTogZnVuY3Rpb24gY2hhbmdlRmF2b3JpdGVTdGF0ZUZvclJlc3RhdXJhbnQoaWQsIGlzRmF2b3JpdGUsIGNhbGxiYWNrKSB7XG5cdFx0XHRmZXRjaCgnaHR0cDovL2xvY2FsaG9zdDoxMzM3L3Jlc3RhdXJhbnRzLycgKyBpZCArICcvP2lzX2Zhdm9yaXRlPScgKyBpc0Zhdm9yaXRlLCB7XG5cdFx0XHRcdG1ldGhvZDogJ1BVVCdcblx0XHRcdH0pLnRoZW4oZnVuY3Rpb24gKHJlcykge1xuXHRcdFx0XHREQkhlbHBlci5vcGVuSWRiKCkudGhlbihmdW5jdGlvbiAoZGIpIHtcblx0XHRcdFx0XHR2YXIgdHggPSBkYi50cmFuc2FjdGlvbigncmVzdGF1cmFudHMtc3RvcmUnLCAncmVhZHdyaXRlJyk7XG5cdFx0XHRcdFx0dmFyIHJlc3RhdXJhbnRzU3RvcmUgPSB0eC5vYmplY3RTdG9yZSgncmVzdGF1cmFudHMtc3RvcmUnKTtcblx0XHRcdFx0XHRyZXN0YXVyYW50c1N0b3JlLmdldChpZCkudGhlbihmdW5jdGlvbiAocmVzdGF1cmFudCkge1xuXHRcdFx0XHRcdFx0cmVzdGF1cmFudC5pc19mYXZvcml0ZSA9IGlzRmF2b3JpdGU7XG5cdFx0XHRcdFx0XHRyZXN0YXVyYW50c1N0b3JlLnB1dChyZXN0YXVyYW50KTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fSk7XG5cdFx0XHRcdGNhbGxiYWNrKG51bGwsIFwiZmF2b3JpdGUgc3RhdHVzIHVwZGF0ZWQgc3VjY2Vzc2Z1bGx5XCIpO1xuXHRcdFx0fSkuY2F0Y2goZnVuY3Rpb24gKGVycikge1xuXHRcdFx0XHRjYWxsYmFjayhcImZhaWxlZCB0byB1cGRhdGUgZmF2b3JpdGUgc3RhdHVzXCIsIG51bGwpO1xuXHRcdFx0fSk7XG5cdFx0fVxuXHR9LCB7XG5cdFx0a2V5OiAnYWRkUmV2aWV3Jyxcblx0XHR2YWx1ZTogZnVuY3Rpb24gYWRkUmV2aWV3KHJldmlldykge1xuXG5cdFx0XHRpZiAoIW5hdmlnYXRvci5vbkxpbmUpIHtcblx0XHRcdFx0REJIZWxwZXIuc2VuZFdoZW5PbmxpbmUocmV2aWV3KTtcblx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0fVxuXHRcdFx0dmFyIHJldmlld1BhcmFtZXRlcnMgPSB7XG5cdFx0XHRcdFwicmVzdGF1cmFudF9pZFwiOiBwYXJzZUludChyZXZpZXcucmVzdGF1cmFudElkKSxcblx0XHRcdFx0XCJuYW1lXCI6IHJldmlldy5uYW1lLFxuXHRcdFx0XHRcInJhdGluZ1wiOiBwYXJzZUludChyZXZpZXcucmF0aW5nKSxcblx0XHRcdFx0XCJjb21tZW50c1wiOiByZXZpZXcuY29tbWVudHMsXG5cdFx0XHRcdFwiY3JlYXRlZEF0XCI6IHBhcnNlSW50KHJldmlldy5jcmVhdGVkQXQpXG5cdFx0XHR9O1xuXG5cdFx0XHRmZXRjaCgnaHR0cDovL2xvY2FsaG9zdDoxMzM3L3Jldmlld3MnLCB7XG5cdFx0XHRcdG1ldGhvZDogJ1BPU1QnLFxuXHRcdFx0XHRib2R5OiBKU09OLnN0cmluZ2lmeShyZXZpZXdQYXJhbWV0ZXJzKSxcblx0XHRcdFx0aGVhZGVyczogbmV3IEhlYWRlcnMoe1xuXHRcdFx0XHRcdCdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbidcblx0XHRcdFx0fSlcblx0XHRcdH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG5cdFx0XHRcdGNvbnNvbGUubG9nKFwicmV2aWV3IGFkZGVkIHN1Y2Nlc3NmdWxseSB0byB0aGUgc2VydmVyXCIpO1xuXHRcdFx0fSkuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7XG5cdFx0XHRcdGNvbnNvbGUubG9nKGVycm9yKTtcblx0XHRcdH0pO1xuXHRcdH1cblx0fSwge1xuXHRcdGtleTogJ3NlbmRXaGVuT25saW5lJyxcblx0XHR2YWx1ZTogZnVuY3Rpb24gc2VuZFdoZW5PbmxpbmUob2ZmbGluZVJldmlldykge1xuXHRcdFx0bG9jYWxTdG9yYWdlLnNldEl0ZW0oJ29mZmxpbmVSZXZpZXdEYXRhJywgSlNPTi5zdHJpbmdpZnkob2ZmbGluZVJldmlldykpO1xuXHRcdFx0d2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ29ubGluZScsIGZ1bmN0aW9uIChldmVudCkge1xuXHRcdFx0XHR2YXIgcmV2aWV3ID0gSlNPTi5wYXJzZShsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnb2ZmbGluZVJldmlld0RhdGEnKSk7XG5cdFx0XHRcdGlmIChyZXZpZXcgIT09IG51bGwpIHtcblx0XHRcdFx0XHREQkhlbHBlci5hZGRSZXZpZXcocmV2aWV3KTtcblx0XHRcdFx0XHRsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbSgnb2ZmbGluZVJldmlld0RhdGEnKTtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cdFx0fVxuXHR9LCB7XG5cdFx0a2V5OiAnREFUQUJBU0VfVVJMJyxcblxuXG5cdFx0LyoqXG4gICAqIERhdGFiYXNlIFVSTC5cbiAgICogQ2hhbmdlIHRoaXMgdG8gcmVzdGF1cmFudHMuanNvbiBmaWxlIGxvY2F0aW9uIG9uIHlvdXIgc2VydmVyLlxuICAgKi9cblx0XHRnZXQ6IGZ1bmN0aW9uIGdldCgpIHtcblx0XHRcdHZhciBwb3J0ID0gMTMzNztcblx0XHRcdHJldHVybiAnaHR0cDovL2xvY2FsaG9zdDonICsgcG9ydCArICcvJztcblx0XHR9XG5cdH1dKTtcblxuXHRyZXR1cm4gREJIZWxwZXI7XG59KCk7IiwiJ3VzZSBzdHJpY3QnO1xuXG52YXIgcmVzdGF1cmFudHMgPSB2b2lkIDAsXG4gICAgbmVpZ2hib3Job29kcyA9IHZvaWQgMCxcbiAgICBjdWlzaW5lcyA9IHZvaWQgMDtcbnZhciBtYXA7XG52YXIgbWFya2VycyA9IFtdO1xuXG53aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignb2ZmbGluZScsIGZ1bmN0aW9uIChldmVudCkge1xuICB3aW5kb3cuc2lpaW1wbGVUb2FzdC5hbGVydCgnTm8gSW50ZXJuZXQgQ29ubmVjdGlvbiEnKTtcbn0pO1xuXG4vKipcbiAqIEZldGNoIG5laWdoYm9yaG9vZHMgYW5kIGN1aXNpbmVzIGFzIHNvb24gYXMgdGhlIHBhZ2UgaXMgbG9hZGVkLlxuICovXG5kb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdET01Db250ZW50TG9hZGVkJywgZnVuY3Rpb24gKGV2ZW50KSB7XG4gIGluaXRNYXAoKTsgLy8gYWRkZWQgXG4gIGZldGNoTmVpZ2hib3Job29kcygpO1xuICBmZXRjaEN1aXNpbmVzKCk7XG59KTtcblxuLyoqXG4gKiBGZXRjaCBhbGwgbmVpZ2hib3Job29kcyBhbmQgc2V0IHRoZWlyIEhUTUwuXG4gKi9cbnZhciBmZXRjaE5laWdoYm9yaG9vZHMgPSBmdW5jdGlvbiBmZXRjaE5laWdoYm9yaG9vZHMoKSB7XG4gIERCSGVscGVyLmZldGNoTmVpZ2hib3Job29kcyhmdW5jdGlvbiAoZXJyb3IsIG5laWdoYm9yaG9vZHMpIHtcbiAgICBpZiAoZXJyb3IpIHtcbiAgICAgIC8vIEdvdCBhbiBlcnJvclxuICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7XG4gICAgfSBlbHNlIHtcbiAgICAgIHNlbGYubmVpZ2hib3Job29kcyA9IG5laWdoYm9yaG9vZHM7XG4gICAgICBmaWxsTmVpZ2hib3Job29kc0hUTUwoKTtcbiAgICB9XG4gIH0pO1xufTtcblxuLyoqXG4gKiBTZXQgbmVpZ2hib3Job29kcyBIVE1MLlxuICovXG52YXIgZmlsbE5laWdoYm9yaG9vZHNIVE1MID0gZnVuY3Rpb24gZmlsbE5laWdoYm9yaG9vZHNIVE1MKCkge1xuICB2YXIgbmVpZ2hib3Job29kcyA9IGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzBdIDogc2VsZi5uZWlnaGJvcmhvb2RzO1xuXG4gIHZhciBzZWxlY3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbmVpZ2hib3Job29kcy1zZWxlY3QnKTtcbiAgc2VsZWN0LmlubmVySFRNTCA9ICcnO1xuICB2YXIgb3B0aW9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnb3B0aW9uJyk7XG4gIG9wdGlvbi5pbm5lckhUTUwgPSAnQWxsIE5laWdoYm9yaG9vZHMnO1xuICBvcHRpb24udmFsdWUgPSAnYWxsJztcbiAgc2VsZWN0LmFwcGVuZChvcHRpb24pO1xuICBuZWlnaGJvcmhvb2RzLmZvckVhY2goZnVuY3Rpb24gKG5laWdoYm9yaG9vZCkge1xuICAgIHZhciBvcHRpb24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdvcHRpb24nKTtcbiAgICBvcHRpb24uaW5uZXJIVE1MID0gbmVpZ2hib3Job29kO1xuICAgIG9wdGlvbi52YWx1ZSA9IG5laWdoYm9yaG9vZDtcbiAgICBzZWxlY3QuYXBwZW5kKG9wdGlvbik7XG4gIH0pO1xufTtcblxuLyoqXG4gKiBGZXRjaCBhbGwgY3Vpc2luZXMgYW5kIHNldCB0aGVpciBIVE1MLlxuICovXG52YXIgZmV0Y2hDdWlzaW5lcyA9IGZ1bmN0aW9uIGZldGNoQ3Vpc2luZXMoKSB7XG4gIERCSGVscGVyLmZldGNoQ3Vpc2luZXMoZnVuY3Rpb24gKGVycm9yLCBjdWlzaW5lcykge1xuICAgIGlmIChlcnJvcikge1xuICAgICAgLy8gR290IGFuIGVycm9yIVxuICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7XG4gICAgfSBlbHNlIHtcbiAgICAgIHNlbGYuY3Vpc2luZXMgPSBjdWlzaW5lcztcbiAgICAgIGZpbGxDdWlzaW5lc0hUTUwoKTtcbiAgICB9XG4gIH0pO1xufTtcblxuLyoqXG4gKiBTZXQgY3Vpc2luZXMgSFRNTC5cbiAqL1xudmFyIGZpbGxDdWlzaW5lc0hUTUwgPSBmdW5jdGlvbiBmaWxsQ3Vpc2luZXNIVE1MKCkge1xuICB2YXIgY3Vpc2luZXMgPSBhcmd1bWVudHMubGVuZ3RoID4gMCAmJiBhcmd1bWVudHNbMF0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1swXSA6IHNlbGYuY3Vpc2luZXM7XG5cbiAgdmFyIHNlbGVjdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjdWlzaW5lcy1zZWxlY3QnKTtcbiAgc2VsZWN0LmlubmVySFRNTCA9ICcnO1xuICB2YXIgb3B0aW9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnb3B0aW9uJyk7XG4gIG9wdGlvbi5pbm5lckhUTUwgPSAnQWxsIEN1aXNpbmVzJztcbiAgb3B0aW9uLnZhbHVlID0gJ2FsbCc7XG4gIHNlbGVjdC5hcHBlbmQob3B0aW9uKTtcbiAgY3Vpc2luZXMuZm9yRWFjaChmdW5jdGlvbiAoY3Vpc2luZSkge1xuICAgIHZhciBvcHRpb24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdvcHRpb24nKTtcbiAgICBvcHRpb24uaW5uZXJIVE1MID0gY3Vpc2luZTtcbiAgICBvcHRpb24udmFsdWUgPSBjdWlzaW5lO1xuICAgIHNlbGVjdC5hcHBlbmQob3B0aW9uKTtcbiAgfSk7XG59O1xuXG4vKipcbiAqIEluaXRpYWxpemUgbGVhZmxldCBtYXAsIGNhbGxlZCBmcm9tIEhUTUwuXG4gKi9cbnZhciBpbml0TWFwID0gZnVuY3Rpb24gaW5pdE1hcCgpIHtcbiAgdmFyIGxvYyA9IHtcbiAgICBsYXQ6IDQwLjcyMjIxNixcbiAgICBsbmc6IC03My45ODc1MDFcbiAgfTtcbiAgc2VsZi5tYXAgPSBuZXcgZ29vZ2xlLm1hcHMuTWFwKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYXAnKSwge1xuICAgIHpvb206IDEyLFxuICAgIGNlbnRlcjogbG9jLFxuICAgIHNjcm9sbHdoZWVsOiBmYWxzZVxuICB9KTtcbiAgdXBkYXRlUmVzdGF1cmFudHMoKTtcbn07XG5cbi8qKlxuICogVXBkYXRlIHBhZ2UgYW5kIG1hcCBmb3IgY3VycmVudCByZXN0YXVyYW50cy5cbiAqL1xudmFyIHVwZGF0ZVJlc3RhdXJhbnRzID0gZnVuY3Rpb24gdXBkYXRlUmVzdGF1cmFudHMoKSB7XG4gIHZhciBjU2VsZWN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2N1aXNpbmVzLXNlbGVjdCcpO1xuICB2YXIgblNlbGVjdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCduZWlnaGJvcmhvb2RzLXNlbGVjdCcpO1xuXG4gIHZhciBjSW5kZXggPSBjU2VsZWN0LnNlbGVjdGVkSW5kZXg7XG4gIHZhciBuSW5kZXggPSBuU2VsZWN0LnNlbGVjdGVkSW5kZXg7XG5cbiAgdmFyIGN1aXNpbmUgPSBjU2VsZWN0W2NJbmRleF0udmFsdWU7XG4gIHZhciBuZWlnaGJvcmhvb2QgPSBuU2VsZWN0W25JbmRleF0udmFsdWU7XG5cbiAgREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50QnlDdWlzaW5lQW5kTmVpZ2hib3Job29kKGN1aXNpbmUsIG5laWdoYm9yaG9vZCwgZnVuY3Rpb24gKGVycm9yLCByZXN0YXVyYW50cykge1xuICAgIGlmIChlcnJvcikge1xuICAgICAgLy8gR290IGFuIGVycm9yIVxuICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJlc2V0UmVzdGF1cmFudHMocmVzdGF1cmFudHMpO1xuICAgICAgZmlsbFJlc3RhdXJhbnRzSFRNTCgpO1xuICAgIH1cbiAgfSk7XG59O1xuXG4vKipcbiAqIENsZWFyIGN1cnJlbnQgcmVzdGF1cmFudHMsIHRoZWlyIEhUTUwgYW5kIHJlbW92ZSB0aGVpciBtYXAgbWFya2Vycy5cbiAqL1xudmFyIHJlc2V0UmVzdGF1cmFudHMgPSBmdW5jdGlvbiByZXNldFJlc3RhdXJhbnRzKHJlc3RhdXJhbnRzKSB7XG4gIC8vIFJlbW92ZSBhbGwgcmVzdGF1cmFudHNcbiAgc2VsZi5yZXN0YXVyYW50cyA9IFtdO1xuICB2YXIgdWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdGF1cmFudHMtbGlzdCcpO1xuICB1bC5pbm5lckhUTUwgPSAnJztcblxuICAvLyBSZW1vdmUgYWxsIG1hcCBtYXJrZXJzXG4gIGlmIChzZWxmLm1hcmtlcnMpIHtcbiAgICBzZWxmLm1hcmtlcnMuZm9yRWFjaChmdW5jdGlvbiAobSkge1xuICAgICAgcmV0dXJuIG0uc2V0TWFwKG51bGwpO1xuICAgIH0pO1xuICB9XG4gIHNlbGYubWFya2VycyA9IFtdO1xuICBzZWxmLnJlc3RhdXJhbnRzID0gcmVzdGF1cmFudHM7XG59O1xuXG4vKipcbiAqIENyZWF0ZSBhbGwgcmVzdGF1cmFudHMgSFRNTCBhbmQgYWRkIHRoZW0gdG8gdGhlIHdlYnBhZ2UuXG4gKi9cbnZhciBmaWxsUmVzdGF1cmFudHNIVE1MID0gZnVuY3Rpb24gZmlsbFJlc3RhdXJhbnRzSFRNTCgpIHtcbiAgdmFyIHJlc3RhdXJhbnRzID0gYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMF0gOiBzZWxmLnJlc3RhdXJhbnRzO1xuXG4gIHZhciB1bCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN0YXVyYW50cy1saXN0Jyk7XG4gIHZhciBjb21tZW50ID0gZG9jdW1lbnQuY3JlYXRlQ29tbWVudChcIlwiKTtcbiAgcmVzdGF1cmFudHMuZm9yRWFjaChmdW5jdGlvbiAocmVzdGF1cmFudCkge1xuICAgIHVsLmFwcGVuZChjcmVhdGVSZXN0YXVyYW50SFRNTChyZXN0YXVyYW50KSk7XG4gICAgdWwuYXBwZW5kKGNvbW1lbnQpO1xuICB9KTtcbiAgYWRkTWFya2Vyc1RvTWFwKCk7XG59O1xuXG4vKipcbiAqIENyZWF0ZSByZXN0YXVyYW50IEhUTUwuXG4gKi9cbnZhciBjcmVhdGVSZXN0YXVyYW50SFRNTCA9IGZ1bmN0aW9uIGNyZWF0ZVJlc3RhdXJhbnRIVE1MKHJlc3RhdXJhbnQpIHtcbiAgdmFyIGxpID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnbGknKTtcblxuICB2YXIgZmF2QnV0dG9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYnV0dG9uJyk7XG4gIGZhdkJ1dHRvbi5pbm5lckhUTUwgPSAn4p2kJztcbiAgZmF2QnV0dG9uLmNsYXNzTGlzdC5hZGQoJ2ZhdkJ1dHRvbicpO1xuICBjaGFuZ2VGYXZTdGF0dXMoZmF2QnV0dG9uLCByZXN0YXVyYW50LmlzX2Zhdm9yaXRlKTtcbiAgZmF2QnV0dG9uLm9uY2xpY2sgPSBmdW5jdGlvbiAoKSB7XG4gICAgaWYgKHJlc3RhdXJhbnQuaXNfZmF2b3JpdGUgPT09ICd0cnVlJykge1xuICAgICAgcmVzdGF1cmFudC5pc19mYXZvcml0ZSA9ICdmYWxzZSc7XG4gICAgfSBlbHNlIGlmIChyZXN0YXVyYW50LmlzX2Zhdm9yaXRlID09PSAnZmFsc2UnKSB7XG4gICAgICByZXN0YXVyYW50LmlzX2Zhdm9yaXRlID0gJ3RydWUnO1xuICAgIH1cbiAgICBEQkhlbHBlci5jaGFuZ2VGYXZvcml0ZVN0YXRlRm9yUmVzdGF1cmFudChyZXN0YXVyYW50LmlkLCByZXN0YXVyYW50LmlzX2Zhdm9yaXRlLCBmdW5jdGlvbiAoZXJyb3IsIHN1Y2Nlc3MpIHtcbiAgICAgIGlmIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmxvZyhlcnJvcik7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb25zb2xlLmxvZyhzdWNjZXNzKTtcbiAgICAgICAgY2hhbmdlRmF2U3RhdHVzKGZhdkJ1dHRvbiwgcmVzdGF1cmFudC5pc19mYXZvcml0ZSk7XG4gICAgICB9XG4gICAgfSk7XG4gIH07XG4gIGxpLmFwcGVuZChmYXZCdXR0b24pO1xuXG4gIHZhciBpbWFnZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2ltZycpO1xuICBpbWFnZS5jbGFzc05hbWUgPSAncmVzdGF1cmFudC1pbWcnO1xuICB2YXIgaW1hZ2VVcmwgPSBEQkhlbHBlci5pbWFnZVVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCk7XG4gIHZhciBpbWFnZVVybE5hbWUgPSBpbWFnZVVybDtcbiAgdmFyIGltYWdlVHlwZSA9ICd3ZWJwJztcbiAgaW1hZ2Uuc3JjID0gaW1hZ2VVcmxOYW1lICsgJy04MDBfMnguJyArIGltYWdlVHlwZTtcbiAgaW1hZ2Uuc2V0QXR0cmlidXRlKCdzcmNzZXQnLCBpbWFnZVVybE5hbWUgKyAnLTgwMF8yeC4nICsgaW1hZ2VUeXBlICsgJyA4MDB3LCAnICsgaW1hZ2VVcmxOYW1lICsgJy00MDBfMXguJyArIGltYWdlVHlwZSArICcgNDAwdycpO1xuICBpbWFnZS5zZXRBdHRyaWJ1dGUoJ3NpemVzJywgJyhtYXgtd2lkdGg6IDUwMHB4KSA5MHZ3LCAobWF4LXdpZHRoOiA4ODBweCkgODB2dywgKG1heC13aWR0aDogMTIwNXB4KSA0MHZ3LCAobWluLXdpZHRoOiAxMjA2cHgpIDMwdncnKTtcbiAgaW1hZ2Uuc2V0QXR0cmlidXRlKCdhbHQnLCByZXN0YXVyYW50Lm5hbWUgKyAnIFJlc3RhdXJhbnQnKTtcbiAgbGkuYXBwZW5kKGltYWdlKTtcblxuICB2YXIgZGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gIGRpdi5jbGFzc05hbWUgPSAncmVzdGF1cmFudC10ZXh0LWFyZWEnO1xuICBsaS5hcHBlbmQoZGl2KTtcblxuICB2YXIgbmFtZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2gxJyk7XG4gIG5hbWUuaW5uZXJIVE1MID0gcmVzdGF1cmFudC5uYW1lO1xuICBkaXYuYXBwZW5kKG5hbWUpO1xuXG4gIHZhciBuZWlnaGJvcmhvb2QgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XG4gIG5laWdoYm9yaG9vZC5pbm5lckhUTUwgPSByZXN0YXVyYW50Lm5laWdoYm9yaG9vZDtcbiAgZGl2LmFwcGVuZChuZWlnaGJvcmhvb2QpO1xuXG4gIHZhciBhZGRyZXNzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xuICBhZGRyZXNzLmlubmVySFRNTCA9IHJlc3RhdXJhbnQuYWRkcmVzcztcbiAgZGl2LmFwcGVuZChhZGRyZXNzKTtcblxuICB2YXIgbW9yZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EnKTtcbiAgbW9yZS5pbm5lckhUTUwgPSAnVmlldyBEZXRhaWxzJztcbiAgbW9yZS5ocmVmID0gREJIZWxwZXIudXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KTtcbiAgbW9yZS5zZXRBdHRyaWJ1dGUoJ3JvbGUnLCAnYnV0dG9uJyk7XG4gIG1vcmUuc2V0QXR0cmlidXRlKCdhcmlhLWxhYmVsJywgJ1ZpZXcgUmVzdGF1cmFudCBEZXRhaWxzJyk7XG4gIGRpdi5hcHBlbmQobW9yZSk7XG5cbiAgcmV0dXJuIGxpO1xufTtcblxuLyoqXG4gKiBBZGQgbWFya2VycyBmb3IgY3VycmVudCByZXN0YXVyYW50cyB0byB0aGUgbWFwLlxuICovXG52YXIgYWRkTWFya2Vyc1RvTWFwID0gZnVuY3Rpb24gYWRkTWFya2Vyc1RvTWFwKCkge1xuICB2YXIgcmVzdGF1cmFudHMgPSBhcmd1bWVudHMubGVuZ3RoID4gMCAmJiBhcmd1bWVudHNbMF0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1swXSA6IHNlbGYucmVzdGF1cmFudHM7XG5cbiAgcmVzdGF1cmFudHMuZm9yRWFjaChmdW5jdGlvbiAocmVzdGF1cmFudCkge1xuICAgIC8vIEFkZCBtYXJrZXIgdG8gdGhlIG1hcFxuICAgIHZhciBtYXJrZXIgPSBEQkhlbHBlci5tYXBNYXJrZXJGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQsIHNlbGYubWFwKTtcbiAgICBnb29nbGUubWFwcy5ldmVudC5hZGRMaXN0ZW5lcihtYXJrZXIsICdjbGljaycsIGZ1bmN0aW9uICgpIHtcbiAgICAgIHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gbWFya2VyLnVybDtcbiAgICB9KTtcbiAgICBzZWxmLm1hcmtlcnMucHVzaChtYXJrZXIpO1xuICB9KTtcbn07XG5cbnZhciBjaGFuZ2VGYXZTdGF0dXMgPSBmdW5jdGlvbiBjaGFuZ2VGYXZTdGF0dXMoZmF2QnRuLCBpc0Zhdikge1xuICBpZiAoaXNGYXYgPT09ICd0cnVlJykge1xuICAgIGZhdkJ0bi5jbGFzc0xpc3QucmVtb3ZlKCdub3RGYXYnKTtcbiAgICBmYXZCdG4uY2xhc3NMaXN0LmFkZCgnZmF2Jyk7XG4gICAgZmF2QnRuLnNldEF0dHJpYnV0ZSgnYXJpYS1sYWJlbCcsICdtYXJrIGFzIGZhdm9yaXRlJyk7XG4gIH0gZWxzZSBpZiAoaXNGYXYgPT09ICdmYWxzZScpIHtcbiAgICBmYXZCdG4uY2xhc3NMaXN0LnJlbW92ZSgnZmF2Jyk7XG4gICAgZmF2QnRuLmNsYXNzTGlzdC5hZGQoJ25vdEZhdicpO1xuICAgIGZhdkJ0bi5zZXRBdHRyaWJ1dGUoJ2FyaWEtbGFiZWwnLCAncmVtb3ZlIGFzIGZhdm9yaXRlJyk7XG4gIH1cbn07Il19
