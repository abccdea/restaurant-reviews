"use strict";!function(){function i(n){return new Promise(function(e,t){n.onsuccess=function(){e(n.result)},n.onerror=function(){t(n.error)}})}function a(n,r,o){var a,e=new Promise(function(e,t){i(a=n[r].apply(n,o)).then(e,t)});return e.request=a,e}function e(e,n,t){t.forEach(function(t){Object.defineProperty(e.prototype,t,{get:function(){return this[n][t]},set:function(e){this[n][t]=e}})})}function t(t,n,r,e){e.forEach(function(e){e in r.prototype&&(t.prototype[e]=function(){return a(this[n],e,arguments)})})}function n(t,n,r,e){e.forEach(function(e){e in r.prototype&&(t.prototype[e]=function(){return this[n][e].apply(this[n],arguments)})})}function r(e,r,t,n){n.forEach(function(n){n in t.prototype&&(e.prototype[n]=function(){return e=this[r],(t=a(e,n,arguments)).then(function(e){if(e)return new u(e,t.request)});var e,t})})}function o(e){this._index=e}function u(e,t){this._cursor=e,this._request=t}function s(e){this._store=e}function c(n){this._tx=n,this.complete=new Promise(function(e,t){n.oncomplete=function(){e()},n.onerror=function(){t(n.error)},n.onabort=function(){t(n.error)}})}function l(e,t,n){this._db=e,this.oldVersion=t,this.transaction=new c(n)}function f(e){this._db=e}e(o,"_index",["name","keyPath","multiEntry","unique"]),t(o,"_index",IDBIndex,["get","getKey","getAll","getAllKeys","count"]),r(o,"_index",IDBIndex,["openCursor","openKeyCursor"]),e(u,"_cursor",["direction","key","primaryKey","value"]),t(u,"_cursor",IDBCursor,["update","delete"]),["advance","continue","continuePrimaryKey"].forEach(function(n){n in IDBCursor.prototype&&(u.prototype[n]=function(){var t=this,e=arguments;return Promise.resolve().then(function(){return t._cursor[n].apply(t._cursor,e),i(t._request).then(function(e){if(e)return new u(e,t._request)})})})}),s.prototype.createIndex=function(){return new o(this._store.createIndex.apply(this._store,arguments))},s.prototype.index=function(){return new o(this._store.index.apply(this._store,arguments))},e(s,"_store",["name","keyPath","indexNames","autoIncrement"]),t(s,"_store",IDBObjectStore,["put","add","delete","clear","get","getAll","getKey","getAllKeys","count"]),r(s,"_store",IDBObjectStore,["openCursor","openKeyCursor"]),n(s,"_store",IDBObjectStore,["deleteIndex"]),c.prototype.objectStore=function(){return new s(this._tx.objectStore.apply(this._tx,arguments))},e(c,"_tx",["objectStoreNames","mode"]),n(c,"_tx",IDBTransaction,["abort"]),l.prototype.createObjectStore=function(){return new s(this._db.createObjectStore.apply(this._db,arguments))},e(l,"_db",["name","version","objectStoreNames"]),n(l,"_db",IDBDatabase,["deleteObjectStore","close"]),f.prototype.transaction=function(){return new c(this._db.transaction.apply(this._db,arguments))},e(f,"_db",["name","version","objectStoreNames"]),n(f,"_db",IDBDatabase,["close"]),["openCursor","openKeyCursor"].forEach(function(a){[s,o].forEach(function(e){a in e.prototype&&(e.prototype[a.replace("open","iterate")]=function(){var e,t=(e=arguments,Array.prototype.slice.call(e)),n=t[t.length-1],r=this._store||this._index,o=r[a].apply(r,t.slice(0,-1));o.onsuccess=function(){n(o.result)}})})}),[o,s].forEach(function(e){e.prototype.getAll||(e.prototype.getAll=function(e,n){var r=this,o=[];return new Promise(function(t){r.iterateCursor(e,function(e){e?(o.push(e.value),void 0===n||o.length!=n?e.continue():t(o)):t(o)})})})});var d={open:function(e,t,n){var r=a(indexedDB,"open",[e,t]),o=r.request;return o&&(o.onupgradeneeded=function(e){n&&n(new l(o.result,e.oldVersion,o.transaction))}),r.then(function(e){return new f(e)})},delete:function(e){return a(indexedDB,"deleteDatabase",[e])}};"undefined"!=typeof module?(module.exports=d,module.exports.default=module.exports):self.idb=d}();var _createClass=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var newMap,DBHelper=function(){function i(){_classCallCheck(this,i)}return _createClass(i,null,[{key:"openIdb",value:function(){return idb.open("db",2,function(e){switch(e.oldVersion){case 0:e.createObjectStore("restaurants-store",{keyPath:"id"});case 1:e.createObjectStore("reviews-store",{keyPath:"id"}).createIndex("by-restaurant","restaurant_id")}})}},{key:"getCachedRestaurants",value:function(){return i.openIdb().then(function(e){if(e)return e.transaction("restaurants-store").objectStore("restaurants-store").getAll()})}},{key:"getCachedReviews",value:function(t){return i.openIdb().then(function(e){if(e)return e.transaction("reviews-store").objectStore("reviews-store").index("by-restaurant").getAll(t)})}},{key:"fetchRestaurants",value:function(t){i.getCachedRestaurants().then(function(e){if(0<e.length)return t(null,e)}),fetch(i.DATABASE_URL+"restaurants").then(function(e){return e.json()}).then(function(n){return i.openIdb().then(function(e){if(e){var t=e.transaction("restaurants-store","readwrite").objectStore("restaurants-store");n.forEach(function(e){t.put(e)})}}),t(null,n)}).catch(function(e){return t(e,null)})}},{key:"fetchReviews",value:function(e,t){i.getCachedReviews(e).then(function(e){if(0<e.length)return t(null,e.reverse())}),fetch(i.DATABASE_URL+"reviews/?restaurant_id="+e).then(function(e){return e.json()}).then(function(n){return i.openIdb().then(function(e){if(e){var t=e.transaction("reviews-store","readwrite").objectStore("reviews-store");n.forEach(function(e){t.put(e)})}}),t(null,n.reverse())}).catch(function(e){return t(e,null)})}},{key:"fetchRestaurantById",value:function(r,o){i.fetchRestaurants(function(e,t){if(e)o(e,null);else{var n=t.find(function(e){return e.id==r});n?o(null,n):o("Restaurant does not exist",null)}})}},{key:"fetchRestaurantByCuisine",value:function(r,o){i.fetchRestaurants(function(e,t){if(e)o(e,null);else{var n=t.filter(function(e){return e.cuisine_type==r});o(null,n)}})}},{key:"fetchRestaurantByNeighborhood",value:function(r,o){i.fetchRestaurants(function(e,t){if(e)o(e,null);else{var n=t.filter(function(e){return e.neighborhood==r});o(null,n)}})}},{key:"fetchRestaurantByCuisineAndNeighborhood",value:function(r,o,a){i.fetchRestaurants(function(e,t){if(e)a(e,null);else{var n=t;"all"!=r&&(n=n.filter(function(e){return e.cuisine_type==r})),"all"!=o&&(n=n.filter(function(e){return e.neighborhood==o})),a(null,n)}})}},{key:"fetchNeighborhoods",value:function(o){i.fetchRestaurants(function(e,n){if(e)o(e,null);else{var r=n.map(function(e,t){return n[t].neighborhood}),t=r.filter(function(e,t){return r.indexOf(e)==t});o(null,t)}})}},{key:"fetchCuisines",value:function(o){i.fetchRestaurants(function(e,n){if(e)o(e,null);else{var r=n.map(function(e,t){return n[t].cuisine_type}),t=r.filter(function(e,t){return r.indexOf(e)==t});o(null,t)}})}},{key:"urlForRestaurant",value:function(e){return"./restaurant.html?id="+e.id}},{key:"imageUrlForRestaurant",value:function(e){return"/img/"+e.photograph}},{key:"mapMarkerForRestaurant",value:function(e,t){return new google.maps.Marker({position:e.latlng,title:e.name,url:i.urlForRestaurant(e),map:t,animation:google.maps.Animation.DROP})}},{key:"changeFavoriteStateForRestaurant",value:function(n,r,t){fetch("http://localhost:1337/restaurants/"+n+"/?is_favorite="+r,{method:"PUT"}).then(function(e){i.openIdb().then(function(e){var t=e.transaction("restaurants-store","readwrite").objectStore("restaurants-store");t.get(n).then(function(e){e.is_favorite=r,t.put(e)})}),t(null,"favorite status updated successfully")}).catch(function(e){t("failed to update favorite status",null)})}},{key:"addReview",value:function(e){if(navigator.onLine){var t={restaurant_id:parseInt(e.restaurantId),name:e.name,rating:parseInt(e.rating),comments:e.comments,createdAt:parseInt(e.createdAt)};fetch("http://localhost:1337/reviews",{method:"POST",body:JSON.stringify(t),headers:new Headers({"Content-Type":"application/json"})}).then(function(e){console.log("review added successfully to the server")}).catch(function(e){console.log(e)})}else i.sendWhenOnline(e)}},{key:"sendWhenOnline",value:function(e){localStorage.setItem("offlineReviewData",JSON.stringify(e)),window.addEventListener("online",function(e){var t=JSON.parse(localStorage.getItem("offlineReviewData"));null!==t&&(i.addReview(t),localStorage.removeItem("offlineReviewData"))})}},{key:"DATABASE_URL",get:function(){return"http://localhost:1337/"}}]),i}(),restaurant=void 0;window.addEventListener("offline",function(e){window.siiimpleToast.alert("No Internet Connection!")}),document.addEventListener("DOMContentLoaded",function(e){initMap()});var initMap=function(){fetchRestaurantFromURL(function(e,t){e?console.error(e):(self.map=new google.maps.Map(document.getElementById("map"),{zoom:16,center:t.latlng,scrollwheel:!1}),fillBreadcrumb(),DBHelper.mapMarkerForRestaurant(self.restaurant,self.map))})},fetchRestaurantFromURL=function(n){if(self.restaurant)n(null,self.restaurant);else{var r=getParameterByName("id");r?DBHelper.fetchRestaurantById(r,function(e,t){(self.restaurant=t)?(resetRestaurant(),fillRestaurantHTML(r),n(null,t)):console.error(e)}):(error="No restaurant id in URL",n(error,null))}},fillRestaurantHTML=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:self.restaurant;document.getElementById("restaurant-name").innerHTML=t.name,document.getElementById("restaurant-address").innerHTML=t.address;var n=document.getElementById("restaurant-img");n.className="restaurant-img";var r=DBHelper.imageUrlForRestaurant(t),o="webp";n.src=r+"-800_2x."+o,n.setAttribute("srcset",r+"-800_2x."+o+" 800w, "+r+"-400_1x."+o+" 400w"),n.setAttribute("alt",t.name+" Restaurant"),document.getElementById("restaurant-cuisine").innerHTML=t.cuisine_type,t.operating_hours&&fillRestaurantHoursHTML(),DBHelper.fetchReviews(e,function(e,t){e?console.error(e):(resetReviews(),fillReviewsHTML(t))})},fillRestaurantHoursHTML=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.restaurant.operating_hours,t=document.getElementById("restaurant-hours");for(var n in e){var r=document.createElement("tr"),o=document.createElement("td");o.innerHTML=n,r.appendChild(o);var a=document.createElement("td");a.innerHTML=e[n],r.appendChild(a),t.appendChild(r)}},fillReviewsHTML=function(e){var t=document.getElementById("reviews-container"),n=document.createElement("h2");if(n.setAttribute("id","reviewsTitle"),n.innerHTML="Reviews",t.appendChild(n),!e){var r=document.createElement("p");return r.innerHTML="No reviews yet!",void t.appendChild(r)}var o=document.getElementById("reviews-list");e.forEach(function(e){o.appendChild(createReviewHTML(e))}),t.appendChild(o)},createReviewHTML=function(e){var t=document.createElement("li"),n=document.createElement("p");n.innerHTML=e.name,t.appendChild(n);var r=document.createElement("p");r.innerHTML=new Date(e.createdAt).toLocaleString(),t.appendChild(r);var o=document.createElement("p");o.innerHTML="Rating: "+e.rating,t.appendChild(o);var a=document.createElement("p");return a.innerHTML=e.comments,t.appendChild(a),t},fillBreadcrumb=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.restaurant,t=document.getElementById("breadcrumb"),n=document.createElement("li");n.innerHTML=e.name,t.appendChild(n)},getParameterByName=function(e,t){t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");var n=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)").exec(t);return n?n[2]?decodeURIComponent(n[2].replace(/\+/g," ")):"":null},resetRestaurant=function(){self.newMap&&self.newMap.remove();var e=document.getElementById("breadcrumb");e.innerHTML="";var t=document.createElement("li");t.innerHTML="<a href='/'>Home</a>",e.appendChild(t);var n=document.getElementById("restaurant-hours");n&&(n.innerHTML="")},resetReviews=function(){var e=document.getElementById("reviewsTitle");e&&e.remove();var t=document.getElementById("reviews-list");t.innerHTML&&(t.innerHTML="")},addReview=function(){var e=document.getElementById("reviewer-name").value,t=document.getElementById("rating-select").value,n=document.getElementById("reviewer-comment").value,r=document.getElementById("reviews-list");if(e&&n){event.preventDefault();var o={name:e,createdAt:(new Date).getTime(),rating:t,comments:n};r.insertBefore(createReviewHTML(o),r.childNodes[0]),o.restaurantId=self.restaurant.id,DBHelper.addReview(o),document.getElementById("review-form").reset()}};
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImlkYi5qcyIsImRiaGVscGVyLmpzIiwicmVzdGF1cmFudF9pbmZvLmpzIl0sIm5hbWVzIjpbInByb21pc2lmeVJlcXVlc3QiLCJyZXF1ZXN0IiwiUHJvbWlzZSIsInJlc29sdmUiLCJyZWplY3QiLCJvbnN1Y2Nlc3MiLCJyZXN1bHQiLCJvbmVycm9yIiwiZXJyb3IiLCJwcm9taXNpZnlSZXF1ZXN0Q2FsbCIsIm9iaiIsIm1ldGhvZCIsImFyZ3MiLCJwIiwiYXBwbHkiLCJ0aGVuIiwicHJveHlQcm9wZXJ0aWVzIiwiUHJveHlDbGFzcyIsInRhcmdldFByb3AiLCJwcm9wZXJ0aWVzIiwiZm9yRWFjaCIsInByb3AiLCJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsInByb3RvdHlwZSIsImdldCIsInRoaXMiLCJzZXQiLCJ2YWwiLCJwcm94eVJlcXVlc3RNZXRob2RzIiwiQ29uc3RydWN0b3IiLCJhcmd1bWVudHMiLCJwcm94eU1ldGhvZHMiLCJwcm94eUN1cnNvclJlcXVlc3RNZXRob2RzIiwidmFsdWUiLCJDdXJzb3IiLCJJbmRleCIsImluZGV4IiwiX2luZGV4IiwiY3Vyc29yIiwiX2N1cnNvciIsIl9yZXF1ZXN0IiwiT2JqZWN0U3RvcmUiLCJzdG9yZSIsIl9zdG9yZSIsIlRyYW5zYWN0aW9uIiwiaWRiVHJhbnNhY3Rpb24iLCJfdHgiLCJjb21wbGV0ZSIsIm9uY29tcGxldGUiLCJvbmFib3J0IiwiVXBncmFkZURCIiwiZGIiLCJvbGRWZXJzaW9uIiwidHJhbnNhY3Rpb24iLCJfZGIiLCJEQiIsIklEQkluZGV4IiwiSURCQ3Vyc29yIiwibWV0aG9kTmFtZSIsImNyZWF0ZUluZGV4IiwiSURCT2JqZWN0U3RvcmUiLCJvYmplY3RTdG9yZSIsIklEQlRyYW5zYWN0aW9uIiwiY3JlYXRlT2JqZWN0U3RvcmUiLCJJREJEYXRhYmFzZSIsImZ1bmNOYW1lIiwicmVwbGFjZSIsImFyciIsIkFycmF5Iiwic2xpY2UiLCJjYWxsIiwiY2FsbGJhY2siLCJsZW5ndGgiLCJuYXRpdmVPYmplY3QiLCJnZXRBbGwiLCJxdWVyeSIsImNvdW50IiwiaW5zdGFuY2UiLCJpdGVtcyIsIml0ZXJhdGVDdXJzb3IiLCJwdXNoIiwidW5kZWZpbmVkIiwiY29udGludWUiLCJleHAiLCJvcGVuIiwibmFtZSIsInZlcnNpb24iLCJ1cGdyYWRlQ2FsbGJhY2siLCJpbmRleGVkREIiLCJvbnVwZ3JhZGVuZWVkZWQiLCJldmVudCIsImRlbGV0ZSIsIm1vZHVsZSIsImV4cG9ydHMiLCJkZWZhdWx0Iiwic2VsZiIsImlkYiIsIl9jcmVhdGVDbGFzcyIsImRlZmluZVByb3BlcnRpZXMiLCJ0YXJnZXQiLCJwcm9wcyIsImkiLCJkZXNjcmlwdG9yIiwiZW51bWVyYWJsZSIsImNvbmZpZ3VyYWJsZSIsIndyaXRhYmxlIiwia2V5IiwicHJvdG9Qcm9wcyIsInN0YXRpY1Byb3BzIiwiX2NsYXNzQ2FsbENoZWNrIiwiVHlwZUVycm9yIiwibmV3TWFwIiwiREJIZWxwZXIiLCJ1cGdyYWRlRGIiLCJrZXlQYXRoIiwib3BlbklkYiIsImlkIiwiZ2V0Q2FjaGVkUmVzdGF1cmFudHMiLCJyZXN0YXVyYW50cyIsImZldGNoIiwiREFUQUJBU0VfVVJMIiwicmVzcG9uc2UiLCJqc29uIiwicmVzdGF1cmFudFN0b3JlIiwicmVzdGF1cmFudCIsInB1dCIsImNhdGNoIiwiZXJyIiwiZ2V0Q2FjaGVkUmV2aWV3cyIsInJldmlld3MiLCJyZXZlcnNlIiwicmV2aWV3IiwiZmV0Y2hSZXN0YXVyYW50cyIsImZpbmQiLCJyIiwiY3Vpc2luZSIsInJlc3VsdHMiLCJmaWx0ZXIiLCJjdWlzaW5lX3R5cGUiLCJuZWlnaGJvcmhvb2QiLCJuZWlnaGJvcmhvb2RzIiwibWFwIiwidiIsInVuaXF1ZU5laWdoYm9yaG9vZHMiLCJpbmRleE9mIiwiY3Vpc2luZXMiLCJ1bmlxdWVDdWlzaW5lcyIsInBob3RvZ3JhcGgiLCJnb29nbGUiLCJtYXBzIiwiTWFya2VyIiwicG9zaXRpb24iLCJsYXRsbmciLCJ0aXRsZSIsInVybCIsInVybEZvclJlc3RhdXJhbnQiLCJhbmltYXRpb24iLCJBbmltYXRpb24iLCJEUk9QIiwiaXNGYXZvcml0ZSIsInJlcyIsInJlc3RhdXJhbnRzU3RvcmUiLCJpc19mYXZvcml0ZSIsIm5hdmlnYXRvciIsIm9uTGluZSIsInJldmlld1BhcmFtZXRlcnMiLCJyZXN0YXVyYW50X2lkIiwicGFyc2VJbnQiLCJyZXN0YXVyYW50SWQiLCJyYXRpbmciLCJjb21tZW50cyIsImNyZWF0ZWRBdCIsImJvZHkiLCJKU09OIiwic3RyaW5naWZ5IiwiaGVhZGVycyIsIkhlYWRlcnMiLCJDb250ZW50LVR5cGUiLCJjb25zb2xlIiwibG9nIiwic2VuZFdoZW5PbmxpbmUiLCJvZmZsaW5lUmV2aWV3IiwibG9jYWxTdG9yYWdlIiwic2V0SXRlbSIsIndpbmRvdyIsImFkZEV2ZW50TGlzdGVuZXIiLCJwYXJzZSIsImdldEl0ZW0iLCJhZGRSZXZpZXciLCJyZW1vdmVJdGVtIiwic2lpaW1wbGVUb2FzdCIsImFsZXJ0IiwiZG9jdW1lbnQiLCJpbml0TWFwIiwiZmV0Y2hSZXN0YXVyYW50RnJvbVVSTCIsIk1hcCIsImdldEVsZW1lbnRCeUlkIiwiem9vbSIsImNlbnRlciIsInNjcm9sbHdoZWVsIiwiZmlsbEJyZWFkY3J1bWIiLCJtYXBNYXJrZXJGb3JSZXN0YXVyYW50IiwiZ2V0UGFyYW1ldGVyQnlOYW1lIiwiZmV0Y2hSZXN0YXVyYW50QnlJZCIsInJlc2V0UmVzdGF1cmFudCIsImZpbGxSZXN0YXVyYW50SFRNTCIsImlubmVySFRNTCIsImFkZHJlc3MiLCJpbWFnZSIsImNsYXNzTmFtZSIsImltYWdlVXJsTmFtZSIsImltYWdlVXJsRm9yUmVzdGF1cmFudCIsImltYWdlVHlwZSIsInNyYyIsInNldEF0dHJpYnV0ZSIsIm9wZXJhdGluZ19ob3VycyIsImZpbGxSZXN0YXVyYW50SG91cnNIVE1MIiwiZmV0Y2hSZXZpZXdzIiwicmVzZXRSZXZpZXdzIiwiZmlsbFJldmlld3NIVE1MIiwib3BlcmF0aW5nSG91cnMiLCJob3VycyIsInJvdyIsImNyZWF0ZUVsZW1lbnQiLCJkYXkiLCJhcHBlbmRDaGlsZCIsInRpbWUiLCJjb250YWluZXIiLCJub1Jldmlld3MiLCJ1bCIsImNyZWF0ZVJldmlld0hUTUwiLCJsaSIsImRhdGUiLCJEYXRlIiwidG9Mb2NhbGVTdHJpbmciLCJicmVhZGNydW1iIiwibG9jYXRpb24iLCJocmVmIiwiUmVnRXhwIiwiZXhlYyIsImRlY29kZVVSSUNvbXBvbmVudCIsInJlbW92ZSIsImhvdXJzVGFibGUiLCJyZXZpZXdzVGl0bGUiLCJyZXZpZXdzTGlzdCIsImNvbW1lbnQiLCJwcmV2ZW50RGVmYXVsdCIsImdldFRpbWUiLCJpbnNlcnRCZWZvcmUiLCJjaGlsZE5vZGVzIiwicmVzZXQiXSwibWFwcGluZ3MiOiJBQUFBLGNBRUEsV0FLQSxTQUFBQSxFQUFBQyxHQUNBLE9BQUEsSUFBQUMsUUFBQSxTQUFBQyxFQUFBQyxHQUNBSCxFQUFBSSxVQUFBLFdBQ0FGLEVBQUFGLEVBQUFLLFNBR0FMLEVBQUFNLFFBQUEsV0FDQUgsRUFBQUgsRUFBQU8sVUFLQSxTQUFBQyxFQUFBQyxFQUFBQyxFQUFBQyxHQUNBLElBQUFYLEVBQ0FZLEVBQUEsSUFBQVgsUUFBQSxTQUFBQyxFQUFBQyxHQUVBSixFQURBQyxFQUFBUyxFQUFBQyxHQUFBRyxNQUFBSixFQUFBRSxJQUNBRyxLQUFBWixFQUFBQyxLQUlBLE9BREFTLEVBQUFaLFFBQUFBLEVBQ0FZLEVBV0EsU0FBQUcsRUFBQUMsRUFBQUMsRUFBQUMsR0FDQUEsRUFBQUMsUUFBQSxTQUFBQyxHQUNBQyxPQUFBQyxlQUFBTixFQUFBTyxVQUFBSCxFQUFBLENBQ0FJLElBQUEsV0FDQSxPQUFBQyxLQUFBUixHQUFBRyxJQUVBTSxJQUFBLFNBQUFDLEdBQ0FGLEtBQUFSLEdBQUFHLEdBQUFPLE9BTUEsU0FBQUMsRUFBQVosRUFBQUMsRUFBQVksRUFBQVgsR0FDQUEsRUFBQUMsUUFBQSxTQUFBQyxHQUNBQSxLQUFBUyxFQUFBTixZQUNBUCxFQUFBTyxVQUFBSCxHQUFBLFdBQ0EsT0FBQVosRUFBQWlC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LGdCQUNBLEdBQUEvRyxHQUFBZ0ssRUFBQSxDQUNBM0osTUFBQTRKLGlCQUNBLElBQUFuSCxFQUFBLENBQ0E5QyxLQUFBQSxFQUNBc0YsV0FBQSxJQUFBOEQsTUFBQWMsVUFDQTlFLE9BQUFBLEVBQ0FDLFNBQUEyRSxHQUVBaEIsRUFBQW1CLGFBQUFsQixpQkFBQW5HLEdBQUFrRyxFQUFBb0IsV0FBQSxJQUNBdEgsRUFBQXFDLGFBQUF6RSxLQUFBNkIsV0FBQVIsR0FDQUosU0FBQTRFLFVBQUF6RCxHQUNBNkQsU0FBQUksZUFBQSxlQUFBc0QiLCJmaWxlIjoicmVzdGF1cmFudC5idW5kbGUuanMiLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG5cbihmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIHRvQXJyYXkoYXJyKSB7XG4gICAgcmV0dXJuIEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFycik7XG4gIH1cblxuICBmdW5jdGlvbiBwcm9taXNpZnlSZXF1ZXN0KHJlcXVlc3QpIHtcbiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgcmVxdWVzdC5vbnN1Y2Nlc3MgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJlc29sdmUocmVxdWVzdC5yZXN1bHQpO1xuICAgICAgfTtcblxuICAgICAgcmVxdWVzdC5vbmVycm9yID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZWplY3QocmVxdWVzdC5lcnJvcik7XG4gICAgICB9O1xuICAgIH0pO1xuICB9XG5cbiAgZnVuY3Rpb24gcHJvbWlzaWZ5UmVxdWVzdENhbGwob2JqLCBtZXRob2QsIGFyZ3MpIHtcbiAgICB2YXIgcmVxdWVzdDtcbiAgICB2YXIgcCA9IG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgIHJlcXVlc3QgPSBvYmpbbWV0aG9kXS5hcHBseShvYmosIGFyZ3MpO1xuICAgICAgcHJvbWlzaWZ5UmVxdWVzdChyZXF1ZXN0KS50aGVuKHJlc29sdmUsIHJlamVjdCk7XG4gICAgfSk7XG5cbiAgICBwLnJlcXVlc3QgPSByZXF1ZXN0O1xuICAgIHJldHVybiBwO1xuICB9XG5cbiAgZnVuY3Rpb24gcHJvbWlzaWZ5Q3Vyc29yUmVxdWVzdENhbGwob2JqLCBtZXRob2QsIGFyZ3MpIHtcbiAgICB2YXIgcCA9IHByb21pc2lmeVJlcXVlc3RDYWxsKG9iaiwgbWV0aG9kLCBhcmdzKTtcbiAgICByZXR1cm4gcC50aGVuKGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgaWYgKCF2YWx1ZSkgcmV0dXJuO1xuICAgICAgcmV0dXJuIG5ldyBDdXJzb3IodmFsdWUsIHAucmVxdWVzdCk7XG4gICAgfSk7XG4gIH1cblxuICBmdW5jdGlvbiBwcm94eVByb3BlcnRpZXMoUHJveHlDbGFzcywgdGFyZ2V0UHJvcCwgcHJvcGVydGllcykge1xuICAgIHByb3BlcnRpZXMuZm9yRWFjaChmdW5jdGlvbiAocHJvcCkge1xuICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KFByb3h5Q2xhc3MucHJvdG90eXBlLCBwcm9wLCB7XG4gICAgICAgIGdldDogZnVuY3Rpb24gZ2V0KCkge1xuICAgICAgICAgIHJldHVybiB0aGlzW3RhcmdldFByb3BdW3Byb3BdO1xuICAgICAgICB9LFxuICAgICAgICBzZXQ6IGZ1bmN0aW9uIHNldCh2YWwpIHtcbiAgICAgICAgICB0aGlzW3RhcmdldFByb3BdW3Byb3BdID0gdmFsO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHByb3h5UmVxdWVzdE1ldGhvZHMoUHJveHlDbGFzcywgdGFyZ2V0UHJvcCwgQ29uc3RydWN0b3IsIHByb3BlcnRpZXMpIHtcbiAgICBwcm9wZXJ0aWVzLmZvckVhY2goZnVuY3Rpb24gKHByb3ApIHtcbiAgICAgIGlmICghKHByb3AgaW4gQ29uc3RydWN0b3IucHJvdG90eXBlKSkgcmV0dXJuO1xuICAgICAgUHJveHlDbGFzcy5wcm90b3R5cGVbcHJvcF0gPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBwcm9taXNpZnlSZXF1ZXN0Q2FsbCh0aGlzW3RhcmdldFByb3BdLCBwcm9wLCBhcmd1bWVudHMpO1xuICAgICAgfTtcbiAgICB9KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHByb3h5TWV0aG9kcyhQcm94eUNsYXNzLCB0YXJnZXRQcm9wLCBDb25zdHJ1Y3RvciwgcHJvcGVydGllcykge1xuICAgIHByb3BlcnRpZXMuZm9yRWFjaChmdW5jdGlvbiAocHJvcCkge1xuICAgICAgaWYgKCEocHJvcCBpbiBDb25zdHJ1Y3Rvci5wcm90b3R5cGUpKSByZXR1cm47XG4gICAgICBQcm94eUNsYXNzLnByb3RvdHlwZVtwcm9wXSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXNbdGFyZ2V0UHJvcF1bcHJvcF0uYXBwbHkodGhpc1t0YXJnZXRQcm9wXSwgYXJndW1lbnRzKTtcbiAgICAgIH07XG4gICAgfSk7XG4gIH1cblxuICBmdW5jdGlvbiBwcm94eUN1cnNvclJlcXVlc3RNZXRob2RzKFByb3h5Q2xhc3MsIHRhcmdldFByb3AsIENvbnN0cnVjdG9yLCBwcm9wZXJ0aWVzKSB7XG4gICAgcHJvcGVydGllcy5mb3JFYWNoKGZ1bmN0aW9uIChwcm9wKSB7XG4gICAgICBpZiAoIShwcm9wIGluIENvbnN0cnVjdG9yLnByb3RvdHlwZSkpIHJldHVybjtcbiAgICAgIFByb3h5Q2xhc3MucHJvdG90eXBlW3Byb3BdID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gcHJvbWlzaWZ5Q3Vyc29yUmVxdWVzdENhbGwodGhpc1t0YXJnZXRQcm9wXSwgcHJvcCwgYXJndW1lbnRzKTtcbiAgICAgIH07XG4gICAgfSk7XG4gIH1cblxuICBmdW5jdGlvbiBJbmRleChpbmRleCkge1xuICAgIHRoaXMuX2luZGV4ID0gaW5kZXg7XG4gIH1cblxuICBwcm94eVByb3BlcnRpZXMoSW5kZXgsICdfaW5kZXgnLCBbJ25hbWUnLCAna2V5UGF0aCcsICdtdWx0aUVudHJ5JywgJ3VuaXF1ZSddKTtcblxuICBwcm94eVJlcXVlc3RNZXRob2RzKEluZGV4LCAnX2luZGV4JywgSURCSW5kZXgsIFsnZ2V0JywgJ2dldEtleScsICdnZXRBbGwnLCAnZ2V0QWxsS2V5cycsICdjb3VudCddKTtcblxuICBwcm94eUN1cnNvclJlcXVlc3RNZXRob2RzKEluZGV4LCAnX2luZGV4JywgSURCSW5kZXgsIFsnb3BlbkN1cnNvcicsICdvcGVuS2V5Q3Vyc29yJ10pO1xuXG4gIGZ1bmN0aW9uIEN1cnNvcihjdXJzb3IsIHJlcXVlc3QpIHtcbiAgICB0aGlzLl9jdXJzb3IgPSBjdXJzb3I7XG4gICAgdGhpcy5fcmVxdWVzdCA9IHJlcXVlc3Q7XG4gIH1cblxuICBwcm94eVByb3BlcnRpZXMoQ3Vyc29yLCAnX2N1cnNvcicsIFsnZGlyZWN0aW9uJywgJ2tleScsICdwcmltYXJ5S2V5JywgJ3ZhbHVlJ10pO1xuXG4gIHByb3h5UmVxdWVzdE1ldGhvZHMoQ3Vyc29yLCAnX2N1cnNvcicsIElEQkN1cnNvciwgWyd1cGRhdGUnLCAnZGVsZXRlJ10pO1xuXG4gIC8vIHByb3h5ICduZXh0JyBtZXRob2RzXG4gIFsnYWR2YW5jZScsICdjb250aW51ZScsICdjb250aW51ZVByaW1hcnlLZXknXS5mb3JFYWNoKGZ1bmN0aW9uIChtZXRob2ROYW1lKSB7XG4gICAgaWYgKCEobWV0aG9kTmFtZSBpbiBJREJDdXJzb3IucHJvdG90eXBlKSkgcmV0dXJuO1xuICAgIEN1cnNvci5wcm90b3R5cGVbbWV0aG9kTmFtZV0gPSBmdW5jdGlvbiAoKSB7XG4gICAgICB2YXIgY3Vyc29yID0gdGhpcztcbiAgICAgIHZhciBhcmdzID0gYXJndW1lbnRzO1xuICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSgpLnRoZW4oZnVuY3Rpb24gKCkge1xuICAgICAgICBjdXJzb3IuX2N1cnNvclttZXRob2ROYW1lXS5hcHBseShjdXJzb3IuX2N1cnNvciwgYXJncyk7XG4gICAgICAgIHJldHVybiBwcm9taXNpZnlSZXF1ZXN0KGN1cnNvci5fcmVxdWVzdCkudGhlbihmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgICAgICBpZiAoIXZhbHVlKSByZXR1cm47XG4gICAgICAgICAgcmV0dXJuIG5ldyBDdXJzb3IodmFsdWUsIGN1cnNvci5fcmVxdWVzdCk7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfTtcbiAgfSk7XG5cbiAgZnVuY3Rpb24gT2JqZWN0U3RvcmUoc3RvcmUpIHtcbiAgICB0aGlzLl9zdG9yZSA9IHN0b3JlO1xuICB9XG5cbiAgT2JqZWN0U3RvcmUucHJvdG90eXBlLmNyZWF0ZUluZGV4ID0gZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiBuZXcgSW5kZXgodGhpcy5fc3RvcmUuY3JlYXRlSW5kZXguYXBwbHkodGhpcy5fc3RvcmUsIGFyZ3VtZW50cykpO1xuICB9O1xuXG4gIE9iamVjdFN0b3JlLnByb3RvdHlwZS5pbmRleCA9IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gbmV3IEluZGV4KHRoaXMuX3N0b3JlLmluZGV4LmFwcGx5KHRoaXMuX3N0b3JlLCBhcmd1bWVudHMpKTtcbiAgfTtcblxuICBwcm94eVByb3BlcnRpZXMoT2JqZWN0U3RvcmUsICdfc3RvcmUnLCBbJ25hbWUnLCAna2V5UGF0aCcsICdpbmRleE5hbWVzJywgJ2F1dG9JbmNyZW1lbnQnXSk7XG5cbiAgcHJveHlSZXF1ZXN0TWV0aG9kcyhPYmplY3RTdG9yZSwgJ19zdG9yZScsIElEQk9iamVjdFN0b3JlLCBbJ3B1dCcsICdhZGQnLCAnZGVsZXRlJywgJ2NsZWFyJywgJ2dldCcsICdnZXRBbGwnLCAnZ2V0S2V5JywgJ2dldEFsbEtleXMnLCAnY291bnQnXSk7XG5cbiAgcHJveHlDdXJzb3JSZXF1ZXN0TWV0aG9kcyhPYmplY3RTdG9yZSwgJ19zdG9yZScsIElEQk9iamVjdFN0b3JlLCBbJ29wZW5DdXJzb3InLCAnb3BlbktleUN1cnNvciddKTtcblxuICBwcm94eU1ldGhvZHMoT2JqZWN0U3RvcmUsICdfc3RvcmUnLCBJREJPYmplY3RTdG9yZSwgWydkZWxldGVJbmRleCddKTtcblxuICBmdW5jdGlvbiBUcmFuc2FjdGlvbihpZGJUcmFuc2FjdGlvbikge1xuICAgIHRoaXMuX3R4ID0gaWRiVHJhbnNhY3Rpb247XG4gICAgdGhpcy5jb21wbGV0ZSA9IG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgIGlkYlRyYW5zYWN0aW9uLm9uY29tcGxldGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJlc29sdmUoKTtcbiAgICAgIH07XG4gICAgICBpZGJUcmFuc2FjdGlvbi5vbmVycm9yID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZWplY3QoaWRiVHJhbnNhY3Rpb24uZXJyb3IpO1xuICAgICAgfTtcbiAgICAgIGlkYlRyYW5zYWN0aW9uLm9uYWJvcnQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJlamVjdChpZGJUcmFuc2FjdGlvbi5lcnJvcik7XG4gICAgICB9O1xuICAgIH0pO1xuICB9XG5cbiAgVHJhbnNhY3Rpb24ucHJvdG90eXBlLm9iamVjdFN0b3JlID0gZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiBuZXcgT2JqZWN0U3RvcmUodGhpcy5fdHgub2JqZWN0U3RvcmUuYXBwbHkodGhpcy5fdHgsIGFyZ3VtZW50cykpO1xuICB9O1xuXG4gIHByb3h5UHJvcGVydGllcyhUcmFuc2FjdGlvbiwgJ190eCcsIFsnb2JqZWN0U3RvcmVOYW1lcycsICdtb2RlJ10pO1xuXG4gIHByb3h5TWV0aG9kcyhUcmFuc2FjdGlvbiwgJ190eCcsIElEQlRyYW5zYWN0aW9uLCBbJ2Fib3J0J10pO1xuXG4gIGZ1bmN0aW9uIFVwZ3JhZGVEQihkYiwgb2xkVmVyc2lvbiwgdHJhbnNhY3Rpb24pIHtcbiAgICB0aGlzLl9kYiA9IGRiO1xuICAgIHRoaXMub2xkVmVyc2lvbiA9IG9sZFZlcnNpb247XG4gICAgdGhpcy50cmFuc2FjdGlvbiA9IG5ldyBUcmFuc2FjdGlvbih0cmFuc2FjdGlvbik7XG4gIH1cblxuICBVcGdyYWRlREIucHJvdG90eXBlLmNyZWF0ZU9iamVjdFN0b3JlID0gZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiBuZXcgT2JqZWN0U3RvcmUodGhpcy5fZGIuY3JlYXRlT2JqZWN0U3RvcmUuYXBwbHkodGhpcy5fZGIsIGFyZ3VtZW50cykpO1xuICB9O1xuXG4gIHByb3h5UHJvcGVydGllcyhVcGdyYWRlREIsICdfZGInLCBbJ25hbWUnLCAndmVyc2lvbicsICdvYmplY3RTdG9yZU5hbWVzJ10pO1xuXG4gIHByb3h5TWV0aG9kcyhVcGdyYWRlREIsICdfZGInLCBJREJEYXRhYmFzZSwgWydkZWxldGVPYmplY3RTdG9yZScsICdjbG9zZSddKTtcblxuICBmdW5jdGlvbiBEQihkYikge1xuICAgIHRoaXMuX2RiID0gZGI7XG4gIH1cblxuICBEQi5wcm90b3R5cGUudHJhbnNhY3Rpb24gPSBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIG5ldyBUcmFuc2FjdGlvbih0aGlzLl9kYi50cmFuc2FjdGlvbi5hcHBseSh0aGlzLl9kYiwgYXJndW1lbnRzKSk7XG4gIH07XG5cbiAgcHJveHlQcm9wZXJ0aWVzKERCLCAnX2RiJywgWyduYW1lJywgJ3ZlcnNpb24nLCAnb2JqZWN0U3RvcmVOYW1lcyddKTtcblxuICBwcm94eU1ldGhvZHMoREIsICdfZGInLCBJREJEYXRhYmFzZSwgWydjbG9zZSddKTtcblxuICAvLyBBZGQgY3Vyc29yIGl0ZXJhdG9yc1xuICAvLyBUT0RPOiByZW1vdmUgdGhpcyBvbmNlIGJyb3dzZXJzIGRvIHRoZSByaWdodCB0aGluZyB3aXRoIHByb21pc2VzXG4gIFsnb3BlbkN1cnNvcicsICdvcGVuS2V5Q3Vyc29yJ10uZm9yRWFjaChmdW5jdGlvbiAoZnVuY05hbWUpIHtcbiAgICBbT2JqZWN0U3RvcmUsIEluZGV4XS5mb3JFYWNoKGZ1bmN0aW9uIChDb25zdHJ1Y3Rvcikge1xuICAgICAgLy8gRG9uJ3QgY3JlYXRlIGl0ZXJhdGVLZXlDdXJzb3IgaWYgb3BlbktleUN1cnNvciBkb2Vzbid0IGV4aXN0LlxuICAgICAgaWYgKCEoZnVuY05hbWUgaW4gQ29uc3RydWN0b3IucHJvdG90eXBlKSkgcmV0dXJuO1xuXG4gICAgICBDb25zdHJ1Y3Rvci5wcm90b3R5cGVbZnVuY05hbWUucmVwbGFjZSgnb3BlbicsICdpdGVyYXRlJyldID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgYXJncyA9IHRvQXJyYXkoYXJndW1lbnRzKTtcbiAgICAgICAgdmFyIGNhbGxiYWNrID0gYXJnc1thcmdzLmxlbmd0aCAtIDFdO1xuICAgICAgICB2YXIgbmF0aXZlT2JqZWN0ID0gdGhpcy5fc3RvcmUgfHwgdGhpcy5faW5kZXg7XG4gICAgICAgIHZhciByZXF1ZXN0ID0gbmF0aXZlT2JqZWN0W2Z1bmNOYW1lXS5hcHBseShuYXRpdmVPYmplY3QsIGFyZ3Muc2xpY2UoMCwgLTEpKTtcbiAgICAgICAgcmVxdWVzdC5vbnN1Y2Nlc3MgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgY2FsbGJhY2socmVxdWVzdC5yZXN1bHQpO1xuICAgICAgICB9O1xuICAgICAgfTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgLy8gcG9seWZpbGwgZ2V0QWxsXG4gIFtJbmRleCwgT2JqZWN0U3RvcmVdLmZvckVhY2goZnVuY3Rpb24gKENvbnN0cnVjdG9yKSB7XG4gICAgaWYgKENvbnN0cnVjdG9yLnByb3RvdHlwZS5nZXRBbGwpIHJldHVybjtcbiAgICBDb25zdHJ1Y3Rvci5wcm90b3R5cGUuZ2V0QWxsID0gZnVuY3Rpb24gKHF1ZXJ5LCBjb3VudCkge1xuICAgICAgdmFyIGluc3RhbmNlID0gdGhpcztcbiAgICAgIHZhciBpdGVtcyA9IFtdO1xuXG4gICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUpIHtcbiAgICAgICAgaW5zdGFuY2UuaXRlcmF0ZUN1cnNvcihxdWVyeSwgZnVuY3Rpb24gKGN1cnNvcikge1xuICAgICAgICAgIGlmICghY3Vyc29yKSB7XG4gICAgICAgICAgICByZXNvbHZlKGl0ZW1zKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9XG4gICAgICAgICAgaXRlbXMucHVzaChjdXJzb3IudmFsdWUpO1xuXG4gICAgICAgICAgaWYgKGNvdW50ICE9PSB1bmRlZmluZWQgJiYgaXRlbXMubGVuZ3RoID09IGNvdW50KSB7XG4gICAgICAgICAgICByZXNvbHZlKGl0ZW1zKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9XG4gICAgICAgICAgY3Vyc29yLmNvbnRpbnVlKCk7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfTtcbiAgfSk7XG5cbiAgdmFyIGV4cCA9IHtcbiAgICBvcGVuOiBmdW5jdGlvbiBvcGVuKG5hbWUsIHZlcnNpb24sIHVwZ3JhZGVDYWxsYmFjaykge1xuICAgICAgdmFyIHAgPSBwcm9taXNpZnlSZXF1ZXN0Q2FsbChpbmRleGVkREIsICdvcGVuJywgW25hbWUsIHZlcnNpb25dKTtcbiAgICAgIHZhciByZXF1ZXN0ID0gcC5yZXF1ZXN0O1xuXG4gICAgICBpZiAocmVxdWVzdCkge1xuICAgICAgICByZXF1ZXN0Lm9udXBncmFkZW5lZWRlZCA9IGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICAgIGlmICh1cGdyYWRlQ2FsbGJhY2spIHtcbiAgICAgICAgICAgIHVwZ3JhZGVDYWxsYmFjayhuZXcgVXBncmFkZURCKHJlcXVlc3QucmVzdWx0LCBldmVudC5vbGRWZXJzaW9uLCByZXF1ZXN0LnRyYW5zYWN0aW9uKSk7XG4gICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gcC50aGVuKGZ1bmN0aW9uIChkYikge1xuICAgICAgICByZXR1cm4gbmV3IERCKGRiKTtcbiAgICAgIH0pO1xuICAgIH0sXG4gICAgZGVsZXRlOiBmdW5jdGlvbiBfZGVsZXRlKG5hbWUpIHtcbiAgICAgIHJldHVybiBwcm9taXNpZnlSZXF1ZXN0Q2FsbChpbmRleGVkREIsICdkZWxldGVEYXRhYmFzZScsIFtuYW1lXSk7XG4gICAgfVxuICB9O1xuXG4gIGlmICh0eXBlb2YgbW9kdWxlICE9PSAndW5kZWZpbmVkJykge1xuICAgIG1vZHVsZS5leHBvcnRzID0gZXhwO1xuICAgIG1vZHVsZS5leHBvcnRzLmRlZmF1bHQgPSBtb2R1bGUuZXhwb3J0cztcbiAgfSBlbHNlIHtcbiAgICBzZWxmLmlkYiA9IGV4cDtcbiAgfVxufSkoKTsiLCIndXNlIHN0cmljdCc7XG5cbnZhciBfY3JlYXRlQ2xhc3MgPSBmdW5jdGlvbiAoKSB7IGZ1bmN0aW9uIGRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBwcm9wcykgeyBmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7IHZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07IGRlc2NyaXB0b3IuZW51bWVyYWJsZSA9IGRlc2NyaXB0b3IuZW51bWVyYWJsZSB8fCBmYWxzZTsgZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlOyBpZiAoXCJ2YWx1ZVwiIGluIGRlc2NyaXB0b3IpIGRlc2NyaXB0b3Iud3JpdGFibGUgPSB0cnVlOyBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBkZXNjcmlwdG9yLmtleSwgZGVzY3JpcHRvcik7IH0gfSByZXR1cm4gZnVuY3Rpb24gKENvbnN0cnVjdG9yLCBwcm90b1Byb3BzLCBzdGF0aWNQcm9wcykgeyBpZiAocHJvdG9Qcm9wcykgZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvci5wcm90b3R5cGUsIHByb3RvUHJvcHMpOyBpZiAoc3RhdGljUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IsIHN0YXRpY1Byb3BzKTsgcmV0dXJuIENvbnN0cnVjdG9yOyB9OyB9KCk7XG5cbmZ1bmN0aW9uIF9jbGFzc0NhbGxDaGVjayhpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHsgaWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvblwiKTsgfSB9XG5cbi8qKlxuICogQ29tbW9uIGRhdGFiYXNlIGhlbHBlciBmdW5jdGlvbnMuXG4gKi9cblxudmFyIERCSGVscGVyID0gZnVuY3Rpb24gKCkge1xuXHRmdW5jdGlvbiBEQkhlbHBlcigpIHtcblx0XHRfY2xhc3NDYWxsQ2hlY2sodGhpcywgREJIZWxwZXIpO1xuXHR9XG5cblx0X2NyZWF0ZUNsYXNzKERCSGVscGVyLCBudWxsLCBbe1xuXHRcdGtleTogJ29wZW5JZGInLFxuXHRcdHZhbHVlOiBmdW5jdGlvbiBvcGVuSWRiKCkge1xuXHRcdFx0cmV0dXJuIGlkYi5vcGVuKCdkYicsIDIsIGZ1bmN0aW9uICh1cGdyYWRlRGIpIHtcblx0XHRcdFx0c3dpdGNoICh1cGdyYWRlRGIub2xkVmVyc2lvbikge1xuXHRcdFx0XHRcdGNhc2UgMDpcblx0XHRcdFx0XHRcdHVwZ3JhZGVEYi5jcmVhdGVPYmplY3RTdG9yZSgncmVzdGF1cmFudHMtc3RvcmUnLCB7XG5cdFx0XHRcdFx0XHRcdGtleVBhdGg6ICdpZCdcblx0XHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdGNhc2UgMTpcblx0XHRcdFx0XHRcdHZhciByZXZpZXdzU3RvcmUgPSB1cGdyYWRlRGIuY3JlYXRlT2JqZWN0U3RvcmUoJ3Jldmlld3Mtc3RvcmUnLCB7XG5cdFx0XHRcdFx0XHRcdGtleVBhdGg6ICdpZCdcblx0XHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdFx0cmV2aWV3c1N0b3JlLmNyZWF0ZUluZGV4KCdieS1yZXN0YXVyYW50JywgJ3Jlc3RhdXJhbnRfaWQnKTtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cdFx0fVxuXHR9LCB7XG5cdFx0a2V5OiAnZ2V0Q2FjaGVkUmVzdGF1cmFudHMnLFxuXHRcdHZhbHVlOiBmdW5jdGlvbiBnZXRDYWNoZWRSZXN0YXVyYW50cygpIHtcblx0XHRcdHJldHVybiBEQkhlbHBlci5vcGVuSWRiKCkudGhlbihmdW5jdGlvbiAoZGIpIHtcblx0XHRcdFx0aWYgKCFkYikgcmV0dXJuO1xuXHRcdFx0XHR2YXIgcmVzdGF1cmFudHNTdG9yZSA9IGRiLnRyYW5zYWN0aW9uKCdyZXN0YXVyYW50cy1zdG9yZScpLm9iamVjdFN0b3JlKCdyZXN0YXVyYW50cy1zdG9yZScpO1xuXHRcdFx0XHRyZXR1cm4gcmVzdGF1cmFudHNTdG9yZS5nZXRBbGwoKTtcblx0XHRcdH0pO1xuXHRcdH1cblx0fSwge1xuXHRcdGtleTogJ2dldENhY2hlZFJldmlld3MnLFxuXHRcdHZhbHVlOiBmdW5jdGlvbiBnZXRDYWNoZWRSZXZpZXdzKGlkKSB7XG5cdFx0XHRyZXR1cm4gREJIZWxwZXIub3BlbklkYigpLnRoZW4oZnVuY3Rpb24gKGRiKSB7XG5cdFx0XHRcdGlmICghZGIpIHJldHVybjtcblx0XHRcdFx0dmFyIHJldmlld3NTdG9yZSA9IGRiLnRyYW5zYWN0aW9uKCdyZXZpZXdzLXN0b3JlJykub2JqZWN0U3RvcmUoJ3Jldmlld3Mtc3RvcmUnKTtcblx0XHRcdFx0dmFyIHJlc3RhdXJhbnRSZXZpZXdzID0gcmV2aWV3c1N0b3JlLmluZGV4KCdieS1yZXN0YXVyYW50Jyk7XG5cdFx0XHRcdHJldHVybiByZXN0YXVyYW50UmV2aWV3cy5nZXRBbGwoaWQpO1xuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0LyoqXG4gICAqIEZldGNoIGFsbCByZXN0YXVyYW50cy5cbiAgICovXG5cblx0fSwge1xuXHRcdGtleTogJ2ZldGNoUmVzdGF1cmFudHMnLFxuXHRcdHZhbHVlOiBmdW5jdGlvbiBmZXRjaFJlc3RhdXJhbnRzKGNhbGxiYWNrKSB7XG5cdFx0XHQvLyBnZXQgZGF0YSBmcm9tIGlkYiBpZiB0aGVyZSBhcmUgZGF0YVxuXHRcdFx0REJIZWxwZXIuZ2V0Q2FjaGVkUmVzdGF1cmFudHMoKS50aGVuKGZ1bmN0aW9uIChyZXN0YXVyYW50cykge1xuXHRcdFx0XHRpZiAocmVzdGF1cmFudHMubGVuZ3RoID4gMCkge1xuXHRcdFx0XHRcdHJldHVybiBjYWxsYmFjayhudWxsLCByZXN0YXVyYW50cyk7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXG5cdFx0XHQvLyBmZXRjaCBkYXRhIGZyb20gdGhlIG5ldHdvcmsgYW5kIHVwZGF0ZSB0aGUgaWRiXG5cdFx0XHRmZXRjaChEQkhlbHBlci5EQVRBQkFTRV9VUkwgKyAncmVzdGF1cmFudHMnKS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xuXHRcdFx0XHRyZXR1cm4gcmVzcG9uc2UuanNvbigpO1xuXHRcdFx0fSkudGhlbihmdW5jdGlvbiAocmVzdGF1cmFudHMpIHtcblx0XHRcdFx0REJIZWxwZXIub3BlbklkYigpLnRoZW4oZnVuY3Rpb24gKGRiKSB7XG5cdFx0XHRcdFx0aWYgKCFkYikgcmV0dXJuO1xuXHRcdFx0XHRcdHZhciB0eCA9IGRiLnRyYW5zYWN0aW9uKCdyZXN0YXVyYW50cy1zdG9yZScsICdyZWFkd3JpdGUnKTtcblx0XHRcdFx0XHR2YXIgcmVzdGF1cmFudFN0b3JlID0gdHgub2JqZWN0U3RvcmUoJ3Jlc3RhdXJhbnRzLXN0b3JlJyk7XG5cdFx0XHRcdFx0cmVzdGF1cmFudHMuZm9yRWFjaChmdW5jdGlvbiAocmVzdGF1cmFudCkge1xuXHRcdFx0XHRcdFx0cmVzdGF1cmFudFN0b3JlLnB1dChyZXN0YXVyYW50KTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fSk7XG5cdFx0XHRcdHJldHVybiBjYWxsYmFjayhudWxsLCByZXN0YXVyYW50cyk7XG5cdFx0XHR9KS5jYXRjaChmdW5jdGlvbiAoZXJyKSB7XG5cdFx0XHRcdHJldHVybiBjYWxsYmFjayhlcnIsIG51bGwpO1xuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0LyoqXG4gICAqIEZldGNoIHJlc3RhdXJhbnQgcmV2aWV3cy5cbiAgICovXG5cblx0fSwge1xuXHRcdGtleTogJ2ZldGNoUmV2aWV3cycsXG5cdFx0dmFsdWU6IGZ1bmN0aW9uIGZldGNoUmV2aWV3cyhpZCwgY2FsbGJhY2spIHtcblx0XHRcdC8vIGdldCBkYXRhIGZyb20gaWRiIGlmIHRoZXJlIGFyZSBkYXRhXG5cdFx0XHREQkhlbHBlci5nZXRDYWNoZWRSZXZpZXdzKGlkKS50aGVuKGZ1bmN0aW9uIChyZXZpZXdzKSB7XG5cdFx0XHRcdGlmIChyZXZpZXdzLmxlbmd0aCA+IDApIHtcblx0XHRcdFx0XHRyZXR1cm4gY2FsbGJhY2sobnVsbCwgcmV2aWV3cy5yZXZlcnNlKCkpO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblxuXHRcdFx0Ly8gZmV0Y2ggZGF0YSBmcm9tIHRoZSBuZXR3b3JrIGFuZCB1cGRhdGUgdGhlIGlkYlxuXHRcdFx0ZmV0Y2goREJIZWxwZXIuREFUQUJBU0VfVVJMICsgJ3Jldmlld3MvP3Jlc3RhdXJhbnRfaWQ9JyArIGlkKS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xuXHRcdFx0XHRyZXR1cm4gcmVzcG9uc2UuanNvbigpO1xuXHRcdFx0fSkudGhlbihmdW5jdGlvbiAocmV2aWV3cykge1xuXHRcdFx0XHREQkhlbHBlci5vcGVuSWRiKCkudGhlbihmdW5jdGlvbiAoZGIpIHtcblx0XHRcdFx0XHRpZiAoIWRiKSByZXR1cm47XG5cdFx0XHRcdFx0dmFyIHR4ID0gZGIudHJhbnNhY3Rpb24oJ3Jldmlld3Mtc3RvcmUnLCAncmVhZHdyaXRlJyk7XG5cdFx0XHRcdFx0dmFyIHN0b3JlID0gdHgub2JqZWN0U3RvcmUoJ3Jldmlld3Mtc3RvcmUnKTtcblx0XHRcdFx0XHRyZXZpZXdzLmZvckVhY2goZnVuY3Rpb24gKHJldmlldykge1xuXHRcdFx0XHRcdFx0c3RvcmUucHV0KHJldmlldyk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH0pO1xuXHRcdFx0XHRyZXR1cm4gY2FsbGJhY2sobnVsbCwgcmV2aWV3cy5yZXZlcnNlKCkpO1xuXHRcdFx0fSkuY2F0Y2goZnVuY3Rpb24gKGVycikge1xuXHRcdFx0XHRyZXR1cm4gY2FsbGJhY2soZXJyLCBudWxsKTtcblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdC8qKlxuICAgKiBGZXRjaCBhIHJlc3RhdXJhbnQgYnkgaXRzIElELlxuICAgKi9cblxuXHR9LCB7XG5cdFx0a2V5OiAnZmV0Y2hSZXN0YXVyYW50QnlJZCcsXG5cdFx0dmFsdWU6IGZ1bmN0aW9uIGZldGNoUmVzdGF1cmFudEJ5SWQoaWQsIGNhbGxiYWNrKSB7XG5cdFx0XHQvLyBmZXRjaCBhbGwgcmVzdGF1cmFudHMgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXG5cdFx0XHREQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRzKGZ1bmN0aW9uIChlcnJvciwgcmVzdGF1cmFudHMpIHtcblx0XHRcdFx0aWYgKGVycm9yKSB7XG5cdFx0XHRcdFx0Y2FsbGJhY2soZXJyb3IsIG51bGwpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHZhciByZXN0YXVyYW50ID0gcmVzdGF1cmFudHMuZmluZChmdW5jdGlvbiAocikge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuaWQgPT0gaWQ7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0aWYgKHJlc3RhdXJhbnQpIHtcblx0XHRcdFx0XHRcdC8vIEdvdCB0aGUgcmVzdGF1cmFudFxuXG5cdFx0XHRcdFx0XHRjYWxsYmFjayhudWxsLCByZXN0YXVyYW50KTtcblx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0Ly8gUmVzdGF1cmFudCBkb2VzIG5vdCBleGlzdCBpbiB0aGUgZGF0YWJhc2Vcblx0XHRcdFx0XHRcdGNhbGxiYWNrKCdSZXN0YXVyYW50IGRvZXMgbm90IGV4aXN0JywgbnVsbCk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblx0XHR9XG5cblx0XHQvKipcbiAgICogRmV0Y2ggcmVzdGF1cmFudHMgYnkgYSBjdWlzaW5lIHR5cGUgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXG4gICAqL1xuXG5cdH0sIHtcblx0XHRrZXk6ICdmZXRjaFJlc3RhdXJhbnRCeUN1aXNpbmUnLFxuXHRcdHZhbHVlOiBmdW5jdGlvbiBmZXRjaFJlc3RhdXJhbnRCeUN1aXNpbmUoY3Vpc2luZSwgY2FsbGJhY2spIHtcblx0XHRcdC8vIEZldGNoIGFsbCByZXN0YXVyYW50cyAgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmdcblx0XHRcdERCSGVscGVyLmZldGNoUmVzdGF1cmFudHMoZnVuY3Rpb24gKGVycm9yLCByZXN0YXVyYW50cykge1xuXHRcdFx0XHRpZiAoZXJyb3IpIHtcblx0XHRcdFx0XHRjYWxsYmFjayhlcnJvciwgbnVsbCk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Ly8gRmlsdGVyIHJlc3RhdXJhbnRzIHRvIGhhdmUgb25seSBnaXZlbiBjdWlzaW5lIHR5cGVcblx0XHRcdFx0XHR2YXIgcmVzdWx0cyA9IHJlc3RhdXJhbnRzLmZpbHRlcihmdW5jdGlvbiAocikge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuY3Vpc2luZV90eXBlID09IGN1aXNpbmU7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0Y2FsbGJhY2sobnVsbCwgcmVzdWx0cyk7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdC8qKlxuICAgKiBGZXRjaCByZXN0YXVyYW50cyBieSBhIG5laWdoYm9yaG9vZCB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZy5cbiAgICovXG5cblx0fSwge1xuXHRcdGtleTogJ2ZldGNoUmVzdGF1cmFudEJ5TmVpZ2hib3Job29kJyxcblx0XHR2YWx1ZTogZnVuY3Rpb24gZmV0Y2hSZXN0YXVyYW50QnlOZWlnaGJvcmhvb2QobmVpZ2hib3Job29kLCBjYWxsYmFjaykge1xuXHRcdFx0Ly8gRmV0Y2ggYWxsIHJlc3RhdXJhbnRzXG5cdFx0XHREQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRzKGZ1bmN0aW9uIChlcnJvciwgcmVzdGF1cmFudHMpIHtcblx0XHRcdFx0aWYgKGVycm9yKSB7XG5cdFx0XHRcdFx0Y2FsbGJhY2soZXJyb3IsIG51bGwpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdC8vIEZpbHRlciByZXN0YXVyYW50cyB0byBoYXZlIG9ubHkgZ2l2ZW4gbmVpZ2hib3Job29kXG5cdFx0XHRcdFx0dmFyIHJlc3VsdHMgPSByZXN0YXVyYW50cy5maWx0ZXIoZnVuY3Rpb24gKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLm5laWdoYm9yaG9vZCA9PSBuZWlnaGJvcmhvb2Q7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0Y2FsbGJhY2sobnVsbCwgcmVzdWx0cyk7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdC8qKlxuICAgKiBGZXRjaCByZXN0YXVyYW50cyBieSBhIGN1aXNpbmUgYW5kIGEgbmVpZ2hib3Job29kIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxuICAgKi9cblxuXHR9LCB7XG5cdFx0a2V5OiAnZmV0Y2hSZXN0YXVyYW50QnlDdWlzaW5lQW5kTmVpZ2hib3Job29kJyxcblx0XHR2YWx1ZTogZnVuY3Rpb24gZmV0Y2hSZXN0YXVyYW50QnlDdWlzaW5lQW5kTmVpZ2hib3Job29kKGN1aXNpbmUsIG5laWdoYm9yaG9vZCwgY2FsbGJhY2spIHtcblx0XHRcdC8vIEZldGNoIGFsbCByZXN0YXVyYW50c1xuXHRcdFx0REJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50cyhmdW5jdGlvbiAoZXJyb3IsIHJlc3RhdXJhbnRzKSB7XG5cdFx0XHRcdGlmIChlcnJvcikge1xuXHRcdFx0XHRcdGNhbGxiYWNrKGVycm9yLCBudWxsKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR2YXIgcmVzdWx0cyA9IHJlc3RhdXJhbnRzO1xuXHRcdFx0XHRcdGlmIChjdWlzaW5lICE9ICdhbGwnKSB7XG5cdFx0XHRcdFx0XHQvLyBmaWx0ZXIgYnkgY3Vpc2luZVxuXHRcdFx0XHRcdFx0cmVzdWx0cyA9IHJlc3VsdHMuZmlsdGVyKGZ1bmN0aW9uIChyKSB7XG5cdFx0XHRcdFx0XHRcdHJldHVybiByLmN1aXNpbmVfdHlwZSA9PSBjdWlzaW5lO1xuXHRcdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdGlmIChuZWlnaGJvcmhvb2QgIT0gJ2FsbCcpIHtcblx0XHRcdFx0XHRcdC8vIGZpbHRlciBieSBuZWlnaGJvcmhvb2Rcblx0XHRcdFx0XHRcdHJlc3VsdHMgPSByZXN1bHRzLmZpbHRlcihmdW5jdGlvbiAocikge1xuXHRcdFx0XHRcdFx0XHRyZXR1cm4gci5uZWlnaGJvcmhvb2QgPT0gbmVpZ2hib3Job29kO1xuXHRcdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdGNhbGxiYWNrKG51bGwsIHJlc3VsdHMpO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblx0XHR9XG5cblx0XHQvKipcbiAgICogRmV0Y2ggYWxsIG5laWdoYm9yaG9vZHMgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXG4gICAqL1xuXG5cdH0sIHtcblx0XHRrZXk6ICdmZXRjaE5laWdoYm9yaG9vZHMnLFxuXHRcdHZhbHVlOiBmdW5jdGlvbiBmZXRjaE5laWdoYm9yaG9vZHMoY2FsbGJhY2spIHtcblx0XHRcdC8vIEZldGNoIGFsbCByZXN0YXVyYW50c1xuXHRcdFx0REJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50cyhmdW5jdGlvbiAoZXJyb3IsIHJlc3RhdXJhbnRzKSB7XG5cdFx0XHRcdGlmIChlcnJvcikge1xuXHRcdFx0XHRcdGNhbGxiYWNrKGVycm9yLCBudWxsKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHQvLyBHZXQgYWxsIG5laWdoYm9yaG9vZHMgZnJvbSBhbGwgcmVzdGF1cmFudHNcblx0XHRcdFx0XHR2YXIgbmVpZ2hib3Job29kcyA9IHJlc3RhdXJhbnRzLm1hcChmdW5jdGlvbiAodiwgaSkge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHJlc3RhdXJhbnRzW2ldLm5laWdoYm9yaG9vZDtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHQvLyBSZW1vdmUgZHVwbGljYXRlcyBmcm9tIG5laWdoYm9yaG9vZHNcblx0XHRcdFx0XHR2YXIgdW5pcXVlTmVpZ2hib3Job29kcyA9IG5laWdoYm9yaG9vZHMuZmlsdGVyKGZ1bmN0aW9uICh2LCBpKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gbmVpZ2hib3Job29kcy5pbmRleE9mKHYpID09IGk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0Y2FsbGJhY2sobnVsbCwgdW5pcXVlTmVpZ2hib3Job29kcyk7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdC8qKlxuICAgKiBGZXRjaCBhbGwgY3Vpc2luZXMgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXG4gICAqL1xuXG5cdH0sIHtcblx0XHRrZXk6ICdmZXRjaEN1aXNpbmVzJyxcblx0XHR2YWx1ZTogZnVuY3Rpb24gZmV0Y2hDdWlzaW5lcyhjYWxsYmFjaykge1xuXHRcdFx0Ly8gRmV0Y2ggYWxsIHJlc3RhdXJhbnRzXG5cdFx0XHREQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRzKGZ1bmN0aW9uIChlcnJvciwgcmVzdGF1cmFudHMpIHtcblx0XHRcdFx0aWYgKGVycm9yKSB7XG5cdFx0XHRcdFx0Y2FsbGJhY2soZXJyb3IsIG51bGwpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdC8vIEdldCBhbGwgY3Vpc2luZXMgZnJvbSBhbGwgcmVzdGF1cmFudHNcblx0XHRcdFx0XHR2YXIgY3Vpc2luZXMgPSByZXN0YXVyYW50cy5tYXAoZnVuY3Rpb24gKHYsIGkpIHtcblx0XHRcdFx0XHRcdHJldHVybiByZXN0YXVyYW50c1tpXS5jdWlzaW5lX3R5cGU7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0Ly8gUmVtb3ZlIGR1cGxpY2F0ZXMgZnJvbSBjdWlzaW5lc1xuXHRcdFx0XHRcdHZhciB1bmlxdWVDdWlzaW5lcyA9IGN1aXNpbmVzLmZpbHRlcihmdW5jdGlvbiAodiwgaSkge1xuXHRcdFx0XHRcdFx0cmV0dXJuIGN1aXNpbmVzLmluZGV4T2YodikgPT0gaTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHRjYWxsYmFjayhudWxsLCB1bmlxdWVDdWlzaW5lcyk7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdC8qKlxuICAgKiBSZXN0YXVyYW50IHBhZ2UgVVJMLlxuICAgKi9cblxuXHR9LCB7XG5cdFx0a2V5OiAndXJsRm9yUmVzdGF1cmFudCcsXG5cdFx0dmFsdWU6IGZ1bmN0aW9uIHVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCkge1xuXHRcdFx0cmV0dXJuICcuL3Jlc3RhdXJhbnQuaHRtbD9pZD0nICsgcmVzdGF1cmFudC5pZDtcblx0XHR9XG5cblx0XHQvKipcbiAgICogUmVzdGF1cmFudCBpbWFnZSBVUkwuXG4gICAqL1xuXG5cdH0sIHtcblx0XHRrZXk6ICdpbWFnZVVybEZvclJlc3RhdXJhbnQnLFxuXHRcdHZhbHVlOiBmdW5jdGlvbiBpbWFnZVVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCkge1xuXHRcdFx0cmV0dXJuICcvaW1nLycgKyByZXN0YXVyYW50LnBob3RvZ3JhcGg7XG5cdFx0fVxuXG5cdFx0LyoqXG4gICAqIE1hcCBtYXJrZXIgZm9yIGEgcmVzdGF1cmFudC5cbiAgICovXG5cblx0fSwge1xuXHRcdGtleTogJ21hcE1hcmtlckZvclJlc3RhdXJhbnQnLFxuXHRcdHZhbHVlOiBmdW5jdGlvbiBtYXBNYXJrZXJGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQsIG1hcCkge1xuXHRcdFx0dmFyIG1hcmtlciA9IG5ldyBnb29nbGUubWFwcy5NYXJrZXIoe1xuXHRcdFx0XHRwb3NpdGlvbjogcmVzdGF1cmFudC5sYXRsbmcsXG5cdFx0XHRcdHRpdGxlOiByZXN0YXVyYW50Lm5hbWUsXG5cdFx0XHRcdHVybDogREJIZWxwZXIudXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KSxcblx0XHRcdFx0bWFwOiBtYXAsXG5cdFx0XHRcdGFuaW1hdGlvbjogZ29vZ2xlLm1hcHMuQW5pbWF0aW9uLkRST1Bcblx0XHRcdH0pO1xuXHRcdFx0cmV0dXJuIG1hcmtlcjtcblx0XHR9XG5cdH0sIHtcblx0XHRrZXk6ICdjaGFuZ2VGYXZvcml0ZVN0YXRlRm9yUmVzdGF1cmFudCcsXG5cdFx0dmFsdWU6IGZ1bmN0aW9uIGNoYW5nZUZhdm9yaXRlU3RhdGVGb3JSZXN0YXVyYW50KGlkLCBpc0Zhdm9yaXRlLCBjYWxsYmFjaykge1xuXHRcdFx0ZmV0Y2goJ2h0dHA6Ly9sb2NhbGhvc3Q6MTMzNy9yZXN0YXVyYW50cy8nICsgaWQgKyAnLz9pc19mYXZvcml0ZT0nICsgaXNGYXZvcml0ZSwge1xuXHRcdFx0XHRtZXRob2Q6ICdQVVQnXG5cdFx0XHR9KS50aGVuKGZ1bmN0aW9uIChyZXMpIHtcblx0XHRcdFx0REJIZWxwZXIub3BlbklkYigpLnRoZW4oZnVuY3Rpb24gKGRiKSB7XG5cdFx0XHRcdFx0dmFyIHR4ID0gZGIudHJhbnNhY3Rpb24oJ3Jlc3RhdXJhbnRzLXN0b3JlJywgJ3JlYWR3cml0ZScpO1xuXHRcdFx0XHRcdHZhciByZXN0YXVyYW50c1N0b3JlID0gdHgub2JqZWN0U3RvcmUoJ3Jlc3RhdXJhbnRzLXN0b3JlJyk7XG5cdFx0XHRcdFx0cmVzdGF1cmFudHNTdG9yZS5nZXQoaWQpLnRoZW4oZnVuY3Rpb24gKHJlc3RhdXJhbnQpIHtcblx0XHRcdFx0XHRcdHJlc3RhdXJhbnQuaXNfZmF2b3JpdGUgPSBpc0Zhdm9yaXRlO1xuXHRcdFx0XHRcdFx0cmVzdGF1cmFudHNTdG9yZS5wdXQocmVzdGF1cmFudCk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH0pO1xuXHRcdFx0XHRjYWxsYmFjayhudWxsLCBcImZhdm9yaXRlIHN0YXR1cyB1cGRhdGVkIHN1Y2Nlc3NmdWxseVwiKTtcblx0XHRcdH0pLmNhdGNoKGZ1bmN0aW9uIChlcnIpIHtcblx0XHRcdFx0Y2FsbGJhY2soXCJmYWlsZWQgdG8gdXBkYXRlIGZhdm9yaXRlIHN0YXR1c1wiLCBudWxsKTtcblx0XHRcdH0pO1xuXHRcdH1cblx0fSwge1xuXHRcdGtleTogJ2FkZFJldmlldycsXG5cdFx0dmFsdWU6IGZ1bmN0aW9uIGFkZFJldmlldyhyZXZpZXcpIHtcblxuXHRcdFx0aWYgKCFuYXZpZ2F0b3Iub25MaW5lKSB7XG5cdFx0XHRcdERCSGVscGVyLnNlbmRXaGVuT25saW5lKHJldmlldyk7XG5cdFx0XHRcdHJldHVybjtcblx0XHRcdH1cblx0XHRcdHZhciByZXZpZXdQYXJhbWV0ZXJzID0ge1xuXHRcdFx0XHRcInJlc3RhdXJhbnRfaWRcIjogcGFyc2VJbnQocmV2aWV3LnJlc3RhdXJhbnRJZCksXG5cdFx0XHRcdFwibmFtZVwiOiByZXZpZXcubmFtZSxcblx0XHRcdFx0XCJyYXRpbmdcIjogcGFyc2VJbnQocmV2aWV3LnJhdGluZyksXG5cdFx0XHRcdFwiY29tbWVudHNcIjogcmV2aWV3LmNvbW1lbnRzLFxuXHRcdFx0XHRcImNyZWF0ZWRBdFwiOiBwYXJzZUludChyZXZpZXcuY3JlYXRlZEF0KVxuXHRcdFx0fTtcblxuXHRcdFx0ZmV0Y2goJ2h0dHA6Ly9sb2NhbGhvc3Q6MTMzNy9yZXZpZXdzJywge1xuXHRcdFx0XHRtZXRob2Q6ICdQT1NUJyxcblx0XHRcdFx0Ym9keTogSlNPTi5zdHJpbmdpZnkocmV2aWV3UGFyYW1ldGVycyksXG5cdFx0XHRcdGhlYWRlcnM6IG5ldyBIZWFkZXJzKHtcblx0XHRcdFx0XHQnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nXG5cdFx0XHRcdH0pXG5cdFx0XHR9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xuXHRcdFx0XHRjb25zb2xlLmxvZyhcInJldmlldyBhZGRlZCBzdWNjZXNzZnVsbHkgdG8gdGhlIHNlcnZlclwiKTtcblx0XHRcdH0pLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikge1xuXHRcdFx0XHRjb25zb2xlLmxvZyhlcnJvcik7XG5cdFx0XHR9KTtcblx0XHR9XG5cdH0sIHtcblx0XHRrZXk6ICdzZW5kV2hlbk9ubGluZScsXG5cdFx0dmFsdWU6IGZ1bmN0aW9uIHNlbmRXaGVuT25saW5lKG9mZmxpbmVSZXZpZXcpIHtcblx0XHRcdGxvY2FsU3RvcmFnZS5zZXRJdGVtKCdvZmZsaW5lUmV2aWV3RGF0YScsIEpTT04uc3RyaW5naWZ5KG9mZmxpbmVSZXZpZXcpKTtcblx0XHRcdHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdvbmxpbmUnLCBmdW5jdGlvbiAoZXZlbnQpIHtcblx0XHRcdFx0dmFyIHJldmlldyA9IEpTT04ucGFyc2UobG9jYWxTdG9yYWdlLmdldEl0ZW0oJ29mZmxpbmVSZXZpZXdEYXRhJykpO1xuXHRcdFx0XHRpZiAocmV2aWV3ICE9PSBudWxsKSB7XG5cdFx0XHRcdFx0REJIZWxwZXIuYWRkUmV2aWV3KHJldmlldyk7XG5cdFx0XHRcdFx0bG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oJ29mZmxpbmVSZXZpZXdEYXRhJyk7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXHRcdH1cblx0fSwge1xuXHRcdGtleTogJ0RBVEFCQVNFX1VSTCcsXG5cblxuXHRcdC8qKlxuICAgKiBEYXRhYmFzZSBVUkwuXG4gICAqIENoYW5nZSB0aGlzIHRvIHJlc3RhdXJhbnRzLmpzb24gZmlsZSBsb2NhdGlvbiBvbiB5b3VyIHNlcnZlci5cbiAgICovXG5cdFx0Z2V0OiBmdW5jdGlvbiBnZXQoKSB7XG5cdFx0XHR2YXIgcG9ydCA9IDEzMzc7XG5cdFx0XHRyZXR1cm4gJ2h0dHA6Ly9sb2NhbGhvc3Q6JyArIHBvcnQgKyAnLyc7XG5cdFx0fVxuXHR9XSk7XG5cblx0cmV0dXJuIERCSGVscGVyO1xufSgpOyIsIid1c2Ugc3RyaWN0JztcblxudmFyIHJlc3RhdXJhbnQgPSB2b2lkIDA7XG52YXIgbmV3TWFwO1xuXG53aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignb2ZmbGluZScsIGZ1bmN0aW9uIChldmVudCkge1xuICB3aW5kb3cuc2lpaW1wbGVUb2FzdC5hbGVydCgnTm8gSW50ZXJuZXQgQ29ubmVjdGlvbiEnKTtcbn0pO1xuXG4vKipcbiAqIEluaXRpYWxpemUgbWFwIGFzIHNvb24gYXMgdGhlIHBhZ2UgaXMgbG9hZGVkLlxuICovXG5kb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdET01Db250ZW50TG9hZGVkJywgZnVuY3Rpb24gKGV2ZW50KSB7XG4gIGluaXRNYXAoKTtcbn0pO1xuXG4vKipcbiAqIEluaXRpYWxpemUgbGVhZmxldCBtYXBcbiAqL1xudmFyIGluaXRNYXAgPSBmdW5jdGlvbiBpbml0TWFwKCkge1xuICBmZXRjaFJlc3RhdXJhbnRGcm9tVVJMKGZ1bmN0aW9uIChlcnJvciwgcmVzdGF1cmFudCkge1xuICAgIGlmIChlcnJvcikge1xuICAgICAgLy8gR290IGFuIGVycm9yIVxuICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7XG4gICAgfSBlbHNlIHtcbiAgICAgIHNlbGYubWFwID0gbmV3IGdvb2dsZS5tYXBzLk1hcChkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcIm1hcFwiKSwge1xuICAgICAgICB6b29tOiAxNixcbiAgICAgICAgY2VudGVyOiByZXN0YXVyYW50LmxhdGxuZyxcbiAgICAgICAgc2Nyb2xsd2hlZWw6IGZhbHNlXG4gICAgICB9KTtcbiAgICAgIGZpbGxCcmVhZGNydW1iKCk7XG4gICAgICBEQkhlbHBlci5tYXBNYXJrZXJGb3JSZXN0YXVyYW50KHNlbGYucmVzdGF1cmFudCwgc2VsZi5tYXApO1xuICAgIH1cbiAgfSk7XG59O1xuXG4vKipcbiAqIEdldCBjdXJyZW50IHJlc3RhdXJhbnQgZnJvbSBwYWdlIFVSTC5cbiAqL1xudmFyIGZldGNoUmVzdGF1cmFudEZyb21VUkwgPSBmdW5jdGlvbiBmZXRjaFJlc3RhdXJhbnRGcm9tVVJMKGNhbGxiYWNrKSB7XG4gIGlmIChzZWxmLnJlc3RhdXJhbnQpIHtcbiAgICAvLyByZXN0YXVyYW50IGFscmVhZHkgZmV0Y2hlZCFcbiAgICBjYWxsYmFjayhudWxsLCBzZWxmLnJlc3RhdXJhbnQpO1xuICAgIHJldHVybjtcbiAgfVxuICB2YXIgaWQgPSBnZXRQYXJhbWV0ZXJCeU5hbWUoJ2lkJyk7XG4gIGlmICghaWQpIHtcbiAgICAvLyBubyBpZCBmb3VuZCBpbiBVUkxcbiAgICBlcnJvciA9ICdObyByZXN0YXVyYW50IGlkIGluIFVSTCc7XG4gICAgY2FsbGJhY2soZXJyb3IsIG51bGwpO1xuICB9IGVsc2Uge1xuICAgIERCSGVscGVyLmZldGNoUmVzdGF1cmFudEJ5SWQoaWQsIGZ1bmN0aW9uIChlcnJvciwgcmVzdGF1cmFudCkge1xuICAgICAgc2VsZi5yZXN0YXVyYW50ID0gcmVzdGF1cmFudDtcbiAgICAgIGlmICghcmVzdGF1cmFudCkge1xuICAgICAgICBjb25zb2xlLmVycm9yKGVycm9yKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgLy8gY2xlYXIgb2xkIHJlc3RhdXJhbnQgZGF0YVxuICAgICAgcmVzZXRSZXN0YXVyYW50KCk7XG4gICAgICBmaWxsUmVzdGF1cmFudEhUTUwoaWQpO1xuICAgICAgY2FsbGJhY2sobnVsbCwgcmVzdGF1cmFudCk7XG4gICAgfSk7XG4gIH1cbn07XG5cbi8qKlxuICogQ3JlYXRlIHJlc3RhdXJhbnQgSFRNTCBhbmQgYWRkIGl0IHRvIHRoZSB3ZWJwYWdlXG4gKi9cbnZhciBmaWxsUmVzdGF1cmFudEhUTUwgPSBmdW5jdGlvbiBmaWxsUmVzdGF1cmFudEhUTUwoaWQpIHtcbiAgdmFyIHJlc3RhdXJhbnQgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6IHNlbGYucmVzdGF1cmFudDtcblxuICB2YXIgbmFtZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN0YXVyYW50LW5hbWUnKTtcbiAgbmFtZS5pbm5lckhUTUwgPSByZXN0YXVyYW50Lm5hbWU7XG5cbiAgdmFyIGFkZHJlc3MgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdGF1cmFudC1hZGRyZXNzJyk7XG4gIGFkZHJlc3MuaW5uZXJIVE1MID0gcmVzdGF1cmFudC5hZGRyZXNzO1xuXG4gIHZhciBpbWFnZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN0YXVyYW50LWltZycpO1xuICBpbWFnZS5jbGFzc05hbWUgPSAncmVzdGF1cmFudC1pbWcnO1xuICB2YXIgaW1hZ2VVcmwgPSBEQkhlbHBlci5pbWFnZVVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCk7XG4gIHZhciBpbWFnZVVybE5hbWUgPSBpbWFnZVVybDtcbiAgdmFyIGltYWdlVHlwZSA9ICd3ZWJwJztcbiAgaW1hZ2Uuc3JjID0gaW1hZ2VVcmxOYW1lICsgJy04MDBfMnguJyArIGltYWdlVHlwZTtcbiAgaW1hZ2Uuc2V0QXR0cmlidXRlKCdzcmNzZXQnLCBpbWFnZVVybE5hbWUgKyAnLTgwMF8yeC4nICsgaW1hZ2VUeXBlICsgJyA4MDB3LCAnICsgaW1hZ2VVcmxOYW1lICsgJy00MDBfMXguJyArIGltYWdlVHlwZSArICcgNDAwdycpO1xuICBpbWFnZS5zZXRBdHRyaWJ1dGUoJ2FsdCcsIHJlc3RhdXJhbnQubmFtZSArICcgUmVzdGF1cmFudCcpO1xuICB2YXIgY3Vpc2luZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN0YXVyYW50LWN1aXNpbmUnKTtcbiAgY3Vpc2luZS5pbm5lckhUTUwgPSByZXN0YXVyYW50LmN1aXNpbmVfdHlwZTtcblxuICAvLyBmaWxsIG9wZXJhdGluZyBob3Vyc1xuICBpZiAocmVzdGF1cmFudC5vcGVyYXRpbmdfaG91cnMpIHtcbiAgICBmaWxsUmVzdGF1cmFudEhvdXJzSFRNTCgpO1xuICB9XG5cbiAgREJIZWxwZXIuZmV0Y2hSZXZpZXdzKGlkLCBmdW5jdGlvbiAoZXJyb3IsIHJldmlld3MpIHtcbiAgICBpZiAoZXJyb3IpIHtcbiAgICAgIC8vIEdvdCBhbiBlcnJvciFcbiAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xuICAgIH0gZWxzZSB7XG4gICAgICAvLyBjbGVhciBvbGQgcmV2aWV3cyBkYXRhXG4gICAgICByZXNldFJldmlld3MoKTtcbiAgICAgIC8vIGZpbGwgcmV2aWV3c1xuICAgICAgZmlsbFJldmlld3NIVE1MKHJldmlld3MpO1xuICAgIH1cbiAgfSk7XG59O1xuXG4vKipcbiAqIENyZWF0ZSByZXN0YXVyYW50IG9wZXJhdGluZyBob3VycyBIVE1MIHRhYmxlIGFuZCBhZGQgaXQgdG8gdGhlIHdlYnBhZ2UuXG4gKi9cbnZhciBmaWxsUmVzdGF1cmFudEhvdXJzSFRNTCA9IGZ1bmN0aW9uIGZpbGxSZXN0YXVyYW50SG91cnNIVE1MKCkge1xuICB2YXIgb3BlcmF0aW5nSG91cnMgPSBhcmd1bWVudHMubGVuZ3RoID4gMCAmJiBhcmd1bWVudHNbMF0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1swXSA6IHNlbGYucmVzdGF1cmFudC5vcGVyYXRpbmdfaG91cnM7XG5cbiAgdmFyIGhvdXJzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3RhdXJhbnQtaG91cnMnKTtcbiAgZm9yICh2YXIga2V5IGluIG9wZXJhdGluZ0hvdXJzKSB7XG4gICAgdmFyIHJvdyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RyJyk7XG5cbiAgICB2YXIgZGF5ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGQnKTtcbiAgICBkYXkuaW5uZXJIVE1MID0ga2V5O1xuICAgIHJvdy5hcHBlbmRDaGlsZChkYXkpO1xuXG4gICAgdmFyIHRpbWUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0ZCcpO1xuICAgIHRpbWUuaW5uZXJIVE1MID0gb3BlcmF0aW5nSG91cnNba2V5XTtcbiAgICByb3cuYXBwZW5kQ2hpbGQodGltZSk7XG5cbiAgICBob3Vycy5hcHBlbmRDaGlsZChyb3cpO1xuICB9XG59O1xuXG4vKipcbiAqIENyZWF0ZSBhbGwgcmV2aWV3cyBIVE1MIGFuZCBhZGQgdGhlbSB0byB0aGUgd2VicGFnZS5cbiAqL1xudmFyIGZpbGxSZXZpZXdzSFRNTCA9IGZ1bmN0aW9uIGZpbGxSZXZpZXdzSFRNTChyZXZpZXdzKSB7XG4gIHZhciBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmV2aWV3cy1jb250YWluZXInKTtcbiAgdmFyIHRpdGxlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaDInKTtcbiAgdGl0bGUuc2V0QXR0cmlidXRlKCdpZCcsICdyZXZpZXdzVGl0bGUnKTtcbiAgdGl0bGUuaW5uZXJIVE1MID0gJ1Jldmlld3MnO1xuICBjb250YWluZXIuYXBwZW5kQ2hpbGQodGl0bGUpO1xuXG4gIGlmICghcmV2aWV3cykge1xuICAgIHZhciBub1Jldmlld3MgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XG4gICAgbm9SZXZpZXdzLmlubmVySFRNTCA9ICdObyByZXZpZXdzIHlldCEnO1xuICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChub1Jldmlld3MpO1xuICAgIHJldHVybjtcbiAgfVxuICB2YXIgdWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmV2aWV3cy1saXN0Jyk7XG4gIHJldmlld3MuZm9yRWFjaChmdW5jdGlvbiAocmV2aWV3KSB7XG4gICAgdWwuYXBwZW5kQ2hpbGQoY3JlYXRlUmV2aWV3SFRNTChyZXZpZXcpKTtcbiAgfSk7XG4gIGNvbnRhaW5lci5hcHBlbmRDaGlsZCh1bCk7XG59O1xuXG4vKipcbiAqIENyZWF0ZSByZXZpZXcgSFRNTCBhbmQgYWRkIGl0IHRvIHRoZSB3ZWJwYWdlLlxuICovXG52YXIgY3JlYXRlUmV2aWV3SFRNTCA9IGZ1bmN0aW9uIGNyZWF0ZVJldmlld0hUTUwocmV2aWV3KSB7XG4gIHZhciBsaSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xpJyk7XG4gIHZhciBuYW1lID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xuICBuYW1lLmlubmVySFRNTCA9IHJldmlldy5uYW1lO1xuICBsaS5hcHBlbmRDaGlsZChuYW1lKTtcblxuICB2YXIgZGF0ZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcbiAgZGF0ZS5pbm5lckhUTUwgPSBuZXcgRGF0ZShyZXZpZXcuY3JlYXRlZEF0KS50b0xvY2FsZVN0cmluZygpO1xuICBsaS5hcHBlbmRDaGlsZChkYXRlKTtcblxuICB2YXIgcmF0aW5nID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xuICByYXRpbmcuaW5uZXJIVE1MID0gJ1JhdGluZzogJyArIHJldmlldy5yYXRpbmc7XG4gIGxpLmFwcGVuZENoaWxkKHJhdGluZyk7XG5cbiAgdmFyIGNvbW1lbnRzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xuICBjb21tZW50cy5pbm5lckhUTUwgPSByZXZpZXcuY29tbWVudHM7XG4gIGxpLmFwcGVuZENoaWxkKGNvbW1lbnRzKTtcblxuICByZXR1cm4gbGk7XG59O1xuXG4vKipcbiAqIEFkZCByZXN0YXVyYW50IG5hbWUgdG8gdGhlIGJyZWFkY3J1bWIgbmF2aWdhdGlvbiBtZW51XG4gKi9cbnZhciBmaWxsQnJlYWRjcnVtYiA9IGZ1bmN0aW9uIGZpbGxCcmVhZGNydW1iKCkge1xuICB2YXIgcmVzdGF1cmFudCA9IGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzBdIDogc2VsZi5yZXN0YXVyYW50O1xuXG4gIHZhciBicmVhZGNydW1iID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2JyZWFkY3J1bWInKTtcbiAgdmFyIGxpID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnbGknKTtcbiAgbGkuaW5uZXJIVE1MID0gcmVzdGF1cmFudC5uYW1lO1xuICBicmVhZGNydW1iLmFwcGVuZENoaWxkKGxpKTtcbn07XG5cbi8qKlxuICogR2V0IGEgcGFyYW1ldGVyIGJ5IG5hbWUgZnJvbSBwYWdlIFVSTC5cbiAqL1xudmFyIGdldFBhcmFtZXRlckJ5TmFtZSA9IGZ1bmN0aW9uIGdldFBhcmFtZXRlckJ5TmFtZShuYW1lLCB1cmwpIHtcbiAgaWYgKCF1cmwpIHVybCA9IHdpbmRvdy5sb2NhdGlvbi5ocmVmO1xuICBuYW1lID0gbmFtZS5yZXBsYWNlKC9bXFxbXFxdXS9nLCAnXFxcXCQmJyk7XG4gIHZhciByZWdleCA9IG5ldyBSZWdFeHAoJ1s/Jl0nICsgbmFtZSArICcoPShbXiYjXSopfCZ8I3wkKScpLFxuICAgICAgcmVzdWx0cyA9IHJlZ2V4LmV4ZWModXJsKTtcbiAgaWYgKCFyZXN1bHRzKSByZXR1cm4gbnVsbDtcbiAgaWYgKCFyZXN1bHRzWzJdKSByZXR1cm4gJyc7XG4gIHJldHVybiBkZWNvZGVVUklDb21wb25lbnQocmVzdWx0c1syXS5yZXBsYWNlKC9cXCsvZywgJyAnKSk7XG59O1xuXG4vKipcbiAqIHJlbW92ZSB0aGUgb2xkIHJlc3RhdXJhbnQgZGF0YVxuICovXG52YXIgcmVzZXRSZXN0YXVyYW50ID0gZnVuY3Rpb24gcmVzZXRSZXN0YXVyYW50KCkge1xuICAvLyByZW1vdmUgcmVzdGF1cmFudCBtYXAgZGF0YVxuICBpZiAoc2VsZi5uZXdNYXApIHtcbiAgICBzZWxmLm5ld01hcC5yZW1vdmUoKTtcbiAgfVxuXG4gIC8vIHJlbW92ZSByZXN0YXVyYW50IGJyZWFkY3J1bWIgYW5kIGNyZWF0ZSBIb21lIG9ubHkgaW4gYnJlYWRjcnVtYlxuICB2YXIgYnJlYWRjcnVtYiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdicmVhZGNydW1iJyk7XG4gIGJyZWFkY3J1bWIuaW5uZXJIVE1MID0gJyc7XG5cbiAgLy8gY2xlYXIgcmVzdGF1cmFudCBicmVhZGNydW1iIGFuZCBjcmVhdGUgSG9tZSBvbmx5IGluIGJyZWFkY3J1bWJcbiAgdmFyIGxpID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnbGknKTtcbiAgbGkuaW5uZXJIVE1MID0gJzxhIGhyZWY9XFwnL1xcJz5Ib21lPC9hPic7XG4gIGJyZWFkY3J1bWIuYXBwZW5kQ2hpbGQobGkpO1xuXG4gIC8vIGNsZWFyIHJlc3RhdXJhbnQgaG91cnMgZGF0YVxuICB2YXIgaG91cnNUYWJsZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN0YXVyYW50LWhvdXJzJyk7XG4gIGlmIChob3Vyc1RhYmxlKSB7XG4gICAgaG91cnNUYWJsZS5pbm5lckhUTUwgPSAnJztcbiAgfVxufTtcblxudmFyIHJlc2V0UmV2aWV3cyA9IGZ1bmN0aW9uIHJlc2V0UmV2aWV3cygpIHtcbiAgLy8gcmVtb3ZlIHJldmlld3MgdGl0bGVcbiAgdmFyIHJldmlld3NUaXRsZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXZpZXdzVGl0bGUnKTtcbiAgaWYgKHJldmlld3NUaXRsZSkge1xuICAgIHJldmlld3NUaXRsZS5yZW1vdmUoKTtcbiAgfVxuXG4gIC8vIHJlbW92ZSByZXZpZXdzIGxpc3QgZGF0YVxuICB2YXIgcmV2aWV3c0xpc3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmV2aWV3cy1saXN0Jyk7XG4gIGlmIChyZXZpZXdzTGlzdC5pbm5lckhUTUwpIHtcbiAgICByZXZpZXdzTGlzdC5pbm5lckhUTUwgPSAnJztcbiAgfVxufTtcblxudmFyIGFkZFJldmlldyA9IGZ1bmN0aW9uIGFkZFJldmlldygpIHtcbiAgdmFyIG5hbWUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmV2aWV3ZXItbmFtZScpLnZhbHVlO1xuICB2YXIgcmF0aW5nID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3JhdGluZy1zZWxlY3QnKS52YWx1ZTtcbiAgdmFyIGNvbW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmV2aWV3ZXItY29tbWVudCcpLnZhbHVlO1xuICB2YXIgdWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmV2aWV3cy1saXN0Jyk7XG4gIGlmIChuYW1lICYmIGNvbW1lbnQpIHtcbiAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIHZhciByZXZpZXcgPSB7XG4gICAgICBuYW1lOiBuYW1lLFxuICAgICAgY3JlYXRlZEF0OiBuZXcgRGF0ZSgpLmdldFRpbWUoKSxcbiAgICAgIHJhdGluZzogcmF0aW5nLFxuICAgICAgY29tbWVudHM6IGNvbW1lbnRcbiAgICB9O1xuICAgIHVsLmluc2VydEJlZm9yZShjcmVhdGVSZXZpZXdIVE1MKHJldmlldyksIHVsLmNoaWxkTm9kZXNbMF0pO1xuICAgIHJldmlldy5yZXN0YXVyYW50SWQgPSBzZWxmLnJlc3RhdXJhbnQuaWQ7XG4gICAgREJIZWxwZXIuYWRkUmV2aWV3KHJldmlldyk7XG4gICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJyZXZpZXctZm9ybVwiKS5yZXNldCgpO1xuICB9XG59OyJdfQ==
